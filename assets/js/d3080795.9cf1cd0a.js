"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[6369],{28453(e,i,n){n.d(i,{R:()=>o,x:()=>t});var s=n(96540);const r={},l=s.createContext(r);function o(e){const i=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function t(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(l.Provider,{value:i},e.children)}},87752(e,i,n){n.r(i),n.d(i,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"redis/Memory Optimization","title":"Memory Optimization","description":"Redis is an in-memory database, meaning performance and cost depend heavily on how efficiently memory is used.","source":"@site/docs/redis/14. Memory Optimization.md","sourceDirName":"redis","slug":"/redis/Memory Optimization","permalink":"/handbook/docs/redis/Memory Optimization","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":14,"frontMatter":{"sidebar_position":14},"sidebar":"redisApiSidebar","previous":{"title":"Geospatial Indexes","permalink":"/handbook/docs/redis/Geospatial Indexes"},"next":{"title":"Lua Scripting","permalink":"/handbook/docs/redis/Lua Scripting"}}');var r=n(74848),l=n(28453);const o={sidebar_position:14},t=void 0,d={},a=[{value:"Compression Using Listpacks / Ziplist Encoding",id:"compression-using-listpacks--ziplist-encoding",level:2},{value:"Bitmaps, Bitfields, and HyperLogLogs",id:"bitmaps-bitfields-and-hyperloglogs",level:2},{value:"Using Bitmaps Instead of Sets",id:"using-bitmaps-instead-of-sets",level:3},{value:"Storing user login status (1 million users)",id:"storing-user-login-status-1-million-users",level:4},{value:"Using HyperLogLog for Approximated Counting",id:"using-hyperloglog-for-approximated-counting",level:4},{value:"Memory Policies &amp; Eviction Strategy",id:"memory-policies--eviction-strategy",level:2}];function c(e){const i={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.p,{children:"Redis is an in-memory database, meaning performance and cost depend heavily on how efficiently memory is used.\r\nOptimizing memory helps you:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Reduce RAM usage"}),"\n",(0,r.jsx)(i.li,{children:"Improve throughput"}),"\n",(0,r.jsx)(i.li,{children:"Lower latency"}),"\n",(0,r.jsx)(i.li,{children:"Store more data on the same hardware"}),"\n",(0,r.jsx)(i.li,{children:"Prevent eviction due to memory limits"}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"Redis provides several built-in mechanisms and settings to control memory use."}),"\n",(0,r.jsx)(i.h2,{id:"compression-using-listpacks--ziplist-encoding",children:"Compression Using Listpacks / Ziplist Encoding"}),"\n",(0,r.jsx)(i.p,{children:"Redis automatically stores small data structures in compact forms:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Listpack (newer)"}),"\n",(0,r.jsx)(i.li,{children:"Ziplist (older)"}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"Used in:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Hashes"}),"\n",(0,r.jsx)(i.li,{children:"Lists"}),"\n",(0,r.jsx)(i.li,{children:"Sorted sets"}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"Example: Small Sorted Set"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-sh",children:'ZADD leaders 100 "Alice" 200 "Bob"\n'})}),"\n",(0,r.jsx)(i.p,{children:"Stored as a small optimized list, not a full skiplist + dictionary.\r\nThis drastically reduces memory."}),"\n",(0,r.jsx)(i.h2,{id:"bitmaps-bitfields-and-hyperloglogs",children:"Bitmaps, Bitfields, and HyperLogLogs"}),"\n",(0,r.jsx)(i.p,{children:"Redis provides specialized structures for massive memory savings."}),"\n",(0,r.jsx)(i.h3,{id:"using-bitmaps-instead-of-sets",children:"Using Bitmaps Instead of Sets"}),"\n",(0,r.jsx)(i.h4,{id:"storing-user-login-status-1-million-users",children:"Storing user login status (1 million users)"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Using a Set"})}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-sh",children:"SADD loggedIn 1 5 10 200000\n"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"A set entry \u2248 50\u201380 bytes \u2192 potentially tens of MB."}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Using a Bitmap"})}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-sh",children:"SETBIT loginBitmap 200000 1\n"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Bitmap uses 1 bit per user"}),"\n",(0,r.jsx)(i.li,{children:"1,000,000 bits \u2192 125 KB only"}),"\n",(0,r.jsx)(i.li,{children:"Huge savings compared to large sets"}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"using-hyperloglog-for-approximated-counting",children:"Using HyperLogLog for Approximated Counting"}),"\n",(0,r.jsx)(i.p,{children:"Counting unique visitors:"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Using a Set"})}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-sh",children:"SADD visitors user123\n"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Memory grows unbounded."}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Using HyperLogLog (fixed \u2248 12 KB)"})}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-sh",children:"PFADD uv user123\r\nPFCOUNT uv\n"})}),"\n",(0,r.jsx)(i.p,{children:"Perfect for:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Daily unique visitors"}),"\n",(0,r.jsx)(i.li,{children:"Counting unique IPs"}),"\n",(0,r.jsx)(i.li,{children:"Measuring cardinality at scale"}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"memory-policies--eviction-strategy",children:"Memory Policies & Eviction Strategy"}),"\n",(0,r.jsxs)(i.p,{children:["Redis can use different eviction policies when memory limit is reached (",(0,r.jsx)(i.code,{children:"maxmemory-policy"}),")."]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Common Policies:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"allkeys-lru"})," \u2192 evict least-recently used keys"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"volatile-lru"})," \u2192 LRU but only keys with TTL"]}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.code,{children:"allkeys-random"})}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"noeviction"})," (default)"]}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-sh",children:"maxmemory 512mb\r\nmaxmemory-policy allkeys-lru\n"})}),"\n",(0,r.jsx)(i.p,{children:"Redis automatically frees memory by removing the least-used keys when it reaches 512 MB."})]})}function h(e={}){const{wrapper:i}={...(0,l.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);