"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[90356],{25644(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"nginx/Default Server","title":"Default Server","description":"The default server is the fallback virtual host that NGINX uses when an incoming request does not match any other server block for the given IP address and port.","source":"@site/docs/nginx/24. Default Server.md","sourceDirName":"nginx","slug":"/nginx/Default Server","permalink":"/handbook/docs/nginx/Default Server","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":24,"frontMatter":{},"sidebar":"nginxApiSidebar","previous":{"title":"IP Based Virtual Hosting","permalink":"/handbook/docs/nginx/IP Based Virtual Hosting"},"next":{"title":"Prefix Match","permalink":"/handbook/docs/nginx/Prefix Match"}}');var i=r(74848),l=r(28453);const t={},d=void 0,c={},o=[{value:"When Does NGINX Use the Default Server?",id:"when-does-nginx-use-the-default-server",level:2},{value:"How NGINX Chooses the Default Server",id:"how-nginx-chooses-the-default-server",level:2},{value:"Basic Example: Name-Based Virtual Hosts",id:"basic-example-name-based-virtual-hosts",level:2},{value:"Explicit Default Server (Recommended)",id:"explicit-default-server-recommended",level:2},{value:"Secure Production Setup",id:"secure-production-setup",level:3},{value:"What Happens in This Setup?",id:"what-happens-in-this-setup",level:3},{value:"Default Server in IP-Based Virtual Hosting",id:"default-server-in-ip-based-virtual-hosting",level:3},{value:"Default Server with HTTPS (SNI)",id:"default-server-with-https-sni",level:3},{value:"Common Uses of a Default Server",id:"common-uses-of-a-default-server",level:2}];function a(e){const n={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["The default server is the fallback virtual host that NGINX uses when an incoming request does not match any other ",(0,i.jsx)(n.code,{children:"server"})," block for the given IP address and port."]}),"\n",(0,i.jsx)(n.p,{children:"Think of it as:"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u201cIf nothing else matches, serve this.\u201d"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"when-does-nginx-use-the-default-server",children:"When Does NGINX Use the Default Server?"}),"\n",(0,i.jsx)(n.p,{children:"NGINX selects the default server when:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["No ",(0,i.jsx)(n.code,{children:"server_name"})," matches the request\u2019s ",(0,i.jsx)(n.code,{children:"Host"})," header (name-based hosting)"]}),"\n",(0,i.jsx)(n.li,{children:"A request comes to an IP/port with no explicit match"}),"\n",(0,i.jsxs)(n.li,{children:["A client sends no ",(0,i.jsx)(n.code,{children:"Host"})," header (old clients or malformed requests)"]}),"\n",(0,i.jsx)(n.li,{children:"Someone accesses the server by IP address"}),"\n",(0,i.jsx)(n.li,{children:"A random or unknown domain points to your server"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"how-nginx-chooses-the-default-server",children:"How NGINX Chooses the Default Server"}),"\n",(0,i.jsx)(n.p,{children:"Priority rules (important!)"}),"\n",(0,i.jsxs)(n.p,{children:["For each ",(0,i.jsx)(n.code,{children:"listen IP:PORT"})," combination:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["A server with ",(0,i.jsx)(n.code,{children:"default_server"})," is chosen first"]}),"\n",(0,i.jsxs)(n.li,{children:["If none is marked:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The first server block defined becomes the default"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Default server is per IP + port, not global."}),"\n",(0,i.jsx)(n.h2,{id:"basic-example-name-based-virtual-hosts",children:"Basic Example: Name-Based Virtual Hosts"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"server {\r\n    listen 80;\r\n    server_name example.com;\r\n\r\n    root /var/www/example;\r\n}\r\n\r\nserver {\r\n    listen 80;\r\n    server_name blog.example.com;\r\n\r\n    root /var/www/blog;\r\n}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Both servers listen on :80"}),"\n",(0,i.jsx)(n.li,{children:"No explicit default_server"}),"\n",(0,i.jsx)(n.li,{children:"The first server block becomes the default"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"So requests like:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"http://192.0.2.10\r\nhttp://unknown-domain.com\n"})}),"\n",(0,i.jsx)(n.p,{children:"will be served by example.com"}),"\n",(0,i.jsx)(n.p,{children:"This is often not desired."}),"\n",(0,i.jsx)(n.h2,{id:"explicit-default-server-recommended",children:"Explicit Default Server (Recommended)"}),"\n",(0,i.jsx)(n.p,{children:"Proper default server setup"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"server {\r\n    listen 80 default_server;\r\n    server_name _;\r\n\r\n    root /var/www/default;\r\n    index index.html;\r\n}\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"default_server"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"listen 80 default_server;\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Explicitly marks this as the fallback server"}),"\n",(0,i.jsx)(n.li,{children:"Overrides ordering issues"}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"server_name _;"})}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"_"})," is a convention meaning \u201cmatch nothing\u201d"]}),"\n",(0,i.jsx)(n.li,{children:"Prevents accidental domain matching"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"secure-production-setup",children:"Secure Production Setup"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"http {\r\n\r\n    server {\r\n        listen 80 default_server;\r\n        server_name _;\r\n\r\n        return 444;\r\n    }\r\n\r\n    server {\r\n        listen 80;\r\n        server_name example.com www.example.com;\r\n\r\n        root /var/www/example;\r\n        index index.html;\r\n    }\r\n\r\n    server {\r\n        listen 80;\r\n        server_name blog.example.com;\r\n\r\n        root /var/www/blog;\r\n        index index.html;\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"what-happens-in-this-setup",children:"What Happens in This Setup?"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Request"}),(0,i.jsx)(n.th,{children:"Result"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"example.com"})}),(0,i.jsx)(n.td,{children:"Served by example.com server"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"blog.example.com"})}),(0,i.jsx)(n.td,{children:"Served by blog server"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"192.0.2.10"})}),(0,i.jsx)(n.td,{children:"Connection closed (444)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"randomdomain.com"})}),(0,i.jsx)(n.td,{children:"Connection closed (444)"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"default-server-in-ip-based-virtual-hosting",children:"Default Server in IP-Based Virtual Hosting"}),"\n",(0,i.jsx)(n.p,{children:"Each IP can have its own default server."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"server {\r\n    listen 192.0.2.10:80 default_server;\r\n    return 444;\r\n}\r\n\r\nserver {\r\n    listen 192.0.2.20:80 default_server;\r\n    return 444;\r\n}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Default server applies per IP"}),"\n",(0,i.jsx)(n.li,{children:"Different IPs = different defaults"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"default-server-with-https-sni",children:"Default Server with HTTPS (SNI)"}),"\n",(0,i.jsx)(n.p,{children:"For HTTPS, default server matters before TLS certificate selection."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"server {\r\n    listen 443 ssl default_server;\r\n    server_name _;\r\n\r\n    ssl_certificate /etc/ssl/default.crt;\r\n    ssl_certificate_key /etc/ssl/default.key;\r\n\r\n    return 444;\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Why this is important"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Handles unknown SNI names"}),"\n",(0,i.jsx)(n.li,{children:"Prevents certificate leakage"}),"\n",(0,i.jsx)(n.li,{children:"Avoids browser warnings"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"common-uses-of-a-default-server",children:"Common Uses of a Default Server"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Security hardening"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"return 444;\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Drops the connection silently"}),"\n",(0,i.jsx)(n.li,{children:"Blocks domain probing"}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Custom error or landing page"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"root /var/www/landing;\r\nindex index.html;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Useful for:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Maintenance pages"}),"\n",(0,i.jsx)(n.li,{children:"Holding pages"}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Redirect to main site"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"return 301 https://example.com;\n"})})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},28453(e,n,r){r.d(n,{R:()=>t,x:()=>d});var s=r(96540);const i={},l=s.createContext(i);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);