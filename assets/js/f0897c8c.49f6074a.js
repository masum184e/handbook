"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[83477],{28453(n,e,o){o.d(e,{R:()=>c,x:()=>i});var r=o(96540);const t={},s=r.createContext(t);function c(n){const e=r.useContext(s);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:c(n.components),r.createElement(s.Provider,{value:e},n.children)}},50208(n,e,o){o.r(e),o.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>c,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"nodejs/index","title":"index","description":"- async/await ensures the server doesn\u2019t start before the specified function","source":"@site/docs/nodejs/index.md","sourceDirName":"nodejs","slug":"/nodejs/","permalink":"/handbook/docs/nodejs/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"nodejsApiSidebar","previous":{"title":"Proxy Requests","permalink":"/handbook/docs/nodejs/Proxy Requests"}}');var t=o(74848),s=o(28453);const c={},i=void 0,l={},a=[{value:"MongoDB",id:"mongodb",level:2},{value:"Reusable Database Connection",id:"reusable-database-connection",level:3},{value:"Graceful shutdown (important for production)",id:"graceful-shutdown-important-for-production",level:3},{value:"Question",id:"question",level:2}];function d(n){const e={br:"br",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"async/await"})," ensures the server doesn\u2019t start before the specified function"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"mongodb",children:"MongoDB"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"const client = new MongoClient(url);"}),": This object manages the connection pool and communication with MongoDB."]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"await client.connect();"})," - Establishes a connection to the MongoDB server. Uses ",(0,t.jsx)(e.code,{children:"async"}),"/",(0,t.jsx)(e.code,{children:"await"})," because network calls are asynchronous"]}),"\n",(0,t.jsx)(e.li,{children:"MongoDB creates the database automatically if it doesn\u2019t exist. No explicit \u201cCREATE DATABASE\u201d command"}),"\n",(0,t.jsx)(e.li,{children:"Collection also created automatically when first used"}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"findOne"})," returns the first matching document, if no match it return ",(0,t.jsx)(e.code,{children:"null"})]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"reusable-database-connection",children:"Reusable Database Connection"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:'const { MongoClient } = require("mongodb");\r\n\r\nconst url = "mongodb://127.0.0.1:27017";\r\nconst dbName = "shopDB";\r\n\r\nlet client;\r\nlet db;\r\n\r\nasync function connectDB() {\r\n  try {\r\n    if (!client) {\r\n      client = new MongoClient(url);\r\n      await client.connect();\r\n      console.log("MongoDB connected");\r\n    }\r\n\r\n    if (!db) {\r\n      db = client.db(dbName);\r\n    }\r\n\r\n    return db;\r\n  } catch (error) {\r\n    console.error("Database connection failed:", error.message);\r\n    throw error;\r\n  }\r\n}\r\n\r\nmodule.exports = connectDB;\n'})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Ensures only one MongoDB connection"}),"\n",(0,t.jsxs)(e.li,{children:["Prevents reconnecting on every request",(0,t.jsx)(e.br,{}),"\n","Lazy connection initialization"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"if (!client) {\r\n  client = new MongoClient(url);\r\n  await client.connect();\r\n}\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Connects only once"}),"\n",(0,t.jsx)(e.li,{children:"Reuses connection afterward"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"Use the connections"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:'const db = await connectDB();\r\nconst products = await db.collection("products").find().toArray();\r\nconsole.log(products);\n'})}),"\n",(0,t.jsx)(e.h3,{id:"graceful-shutdown-important-for-production",children:"Graceful shutdown (important for production)"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:'process.on("SIGINT", async () => {\r\n  if (client) {\r\n    await client.close();\r\n    console.log("MongoDB connection closed");\r\n  }\r\n  process.exit(0);\r\n});\n'})}),"\n",(0,t.jsx)(e.p,{children:"Why this matters"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Prevents corrupted connections"}),"\n",(0,t.jsx)(e.li,{children:"Ensures clean app termination"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"question",children:"Question"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:"What happen when db called after server connection"}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}}}]);