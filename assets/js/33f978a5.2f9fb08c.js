"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[7649],{28453(e,r,n){n.d(r,{R:()=>d,x:()=>l});var s=n(96540);const i={},o=s.createContext(i);function d(e){const r=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(o.Provider,{value:r},e.children)}},93850(e,r,n){n.r(r),n.d(r,{assets:()=>t,contentTitle:()=>l,default:()=>x,frontMatter:()=>d,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"nginx/Reverse Proxy/proxay_pass","title":"proxay_pass","description":"proxypass is a directive from the ngxhttpproxymodule that tells NGINX to forward (proxy) client requests to an upstream backend server and return the backend\u2019s response to the client.","source":"@site/docs/nginx/8. Reverse Proxy/1. proxay_pass.md","sourceDirName":"nginx/8. Reverse Proxy","slug":"/nginx/Reverse Proxy/proxay_pass","permalink":"/handbook/docs/nginx/Reverse Proxy/proxay_pass","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"nginxApiSidebar","previous":{"title":"Include Directive","permalink":"/handbook/docs/nginx/Include Directive"},"next":{"title":"Proxy Headers","permalink":"/handbook/docs/nginx/Reverse Proxy/Proxy Headers"}}');var i=n(74848),o=n(28453);const d={},l=void 0,t={},c=[{value:"Context Where proxy_pass Is Allowed",id:"context-where-proxy_pass-is-allowed",level:2},{value:"Simple Reverse Proxy",id:"simple-reverse-proxy",level:2},{value:"How Request Flow Works",id:"how-request-flow-works",level:2},{value:"<code>proxy_pass</code> With URI",id:"proxy_pass-with-uri",level:2},{value:"Case 1: <code>proxy_pass</code> WITHOUT URI",id:"case-1-proxy_pass-without-uri",level:3},{value:"Case 2: proxy_pass WITH URI",id:"case-2-proxy_pass-with-uri",level:3},{value:"Rule to Remember",id:"rule-to-remember",level:2},{value:"Reverse Proxy Using Upstream (Load Balancing)",id:"reverse-proxy-using-upstream-load-balancing",level:2},{value:"Commonly Used Proxy Headers",id:"commonly-used-proxy-headers",level:2},{value:"Proxying to HTTPS Backend",id:"proxying-to-https-backend",level:2},{value:"Proxy to Unix Socket (High Performance)",id:"proxy-to-unix-socket-high-performance",level:2},{value:"WebSocket Proxying",id:"websocket-proxying",level:2},{value:"Timeout &amp; Buffer Controls",id:"timeout--buffer-controls",level:2},{value:"Common Mistakes",id:"common-mistakes",level:2},{value:"Debugging Tips",id:"debugging-tips",level:2},{value:"Real-World Example (Production Style)",id:"real-world-example-production-style",level:2}];function a(e){const r={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"proxy_pass"})," is a directive from the ngx_http_proxy_module that tells NGINX to forward (proxy) client requests to an upstream backend server and return the backend\u2019s response to the client."]}),"\n",(0,i.jsx)(r.p,{children:"In short:"}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"Client \u2192 NGINX (reverse proxy) \u2192 Backend server"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Why proxy_pass Is Used"})}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"proxy_pass"})," enables NGINX to act as a reverse proxy, providing:"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Load balancing"}),"\n",(0,i.jsx)(r.li,{children:"Security (hide backend servers)"}),"\n",(0,i.jsx)(r.li,{children:"SSL termination"}),"\n",(0,i.jsx)(r.li,{children:"Caching"}),"\n",(0,i.jsx)(r.li,{children:"Request routing"}),"\n",(0,i.jsx)(r.li,{children:"Centralized access control"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Basic Syntax"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"proxy_pass URL;\n"})}),"\n",(0,i.jsxs)(r.p,{children:["Where ",(0,i.jsx)(r.code,{children:"URL"})," can be:"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"http://"})," or ",(0,i.jsx)(r.code,{children:"https://"})]}),"\n",(0,i.jsx)(r.li,{children:"A hostname"}),"\n",(0,i.jsx)(r.li,{children:"An IP address"}),"\n",(0,i.jsx)(r.li,{children:"An upstream group"}),"\n",(0,i.jsx)(r.li,{children:"A Unix socket"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"context-where-proxy_pass-is-allowed",children:"Context Where proxy_pass Is Allowed"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Context"}),(0,i.jsx)(r.th,{children:"Allowed"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"location"})}),(0,i.jsx)(r.td,{children:"\u2705"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsxs)(r.td,{children:[(0,i.jsx)(r.code,{children:"if"})," (inside location)"]}),(0,i.jsx)(r.td,{children:"\u26a0\ufe0f limited"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"server"})}),(0,i.jsx)(r.td,{children:"\u274c"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"http"})}),(0,i.jsx)(r.td,{children:"\u274c"})]})]})]}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"proxy_pass"})," is almost always used inside a location block."]}),"\n",(0,i.jsx)(r.h2,{id:"simple-reverse-proxy",children:"Simple Reverse Proxy"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"server {\r\n    listen 80;\r\n\r\n    location / {\r\n        proxy_pass http://localhost:3000;\r\n    }\r\n}\n"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Client requests ",(0,i.jsx)(r.code,{children:"http://example.com/"})]}),"\n",(0,i.jsxs)(r.li,{children:["NGINX forwards request to ",(0,i.jsx)(r.code,{children:"http://localhost:3000"})]}),"\n",(0,i.jsx)(r.li,{children:"Backend response is returned to the client"}),"\n",(0,i.jsx)(r.li,{children:"Client never sees the backend address"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"how-request-flow-works",children:"How Request Flow Works"}),"\n",(0,i.jsx)(r.p,{children:"Request:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"GET /products?id=10 HTTP/1.1\r\nHost: example.com\n"})}),"\n",(0,i.jsx)(r.p,{children:"NGINX:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Receives request"}),"\n",(0,i.jsxs)(r.li,{children:["Matches ",(0,i.jsx)(r.code,{children:"location /"})]}),"\n",(0,i.jsx)(r.li,{children:"Proxies request to backend"}),"\n",(0,i.jsx)(r.li,{children:"Sends response back to client"}),"\n"]}),"\n",(0,i.jsxs)(r.h2,{id:"proxy_pass-with-uri",children:[(0,i.jsx)(r.code,{children:"proxy_pass"})," With URI"]}),"\n",(0,i.jsxs)(r.p,{children:["The presence or absence of a trailing slash (",(0,i.jsx)(r.code,{children:"/"}),") in ",(0,i.jsx)(r.code,{children:"proxy_pass"})," changes behavior."]}),"\n",(0,i.jsxs)(r.h3,{id:"case-1-proxy_pass-without-uri",children:["Case 1: ",(0,i.jsx)(r.code,{children:"proxy_pass"})," WITHOUT URI"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"location /api/ {\r\n    proxy_pass http://backend;\r\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:"Result"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"/api/users \u2192 http://backend/api/users\n"})}),"\n",(0,i.jsx)(r.p,{children:"Full original URI is preserved"}),"\n",(0,i.jsx)(r.h3,{id:"case-2-proxy_pass-with-uri",children:"Case 2: proxy_pass WITH URI"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"location /api/ {\r\n    proxy_pass http://backend/;\r\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:"Result"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"/api/users \u2192 http://backend/users\n"})}),"\n",(0,i.jsxs)(r.p,{children:["Matching part (",(0,i.jsx)(r.code,{children:"/api/"}),") is replaced"]}),"\n",(0,i.jsx)(r.h2,{id:"rule-to-remember",children:"Rule to Remember"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"proxy_pass"}),(0,i.jsx)(r.th,{children:"Behavior"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"No URI"}),(0,i.jsx)(r.td,{children:"URI is appended"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"With URI"}),(0,i.jsx)(r.td,{children:"Location prefix is replaced"})]})]})]}),"\n",(0,i.jsx)(r.h2,{id:"reverse-proxy-using-upstream-load-balancing",children:"Reverse Proxy Using Upstream (Load Balancing)"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"upstream backend_app {\r\n    server 10.0.0.11:8080;\r\n    server 10.0.0.12:8080;\r\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:"Usage"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"location / {\r\n    proxy_pass http://backend_app;\r\n}\n"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Requests distributed across multiple servers"}),"\n",(0,i.jsx)(r.li,{children:"Default algorithm: round-robin"}),"\n",(0,i.jsx)(r.li,{children:"Backend failures handled automatically"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"commonly-used-proxy-headers",children:"Commonly Used Proxy Headers"}),"\n",(0,i.jsxs)(r.p,{children:["When using ",(0,i.jsx)(r.code,{children:"proxy_pass"}),", you must forward important headers."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"location / {\r\n    proxy_pass http://backend;\r\n\r\n    proxy_set_header Host $host;\r\n    proxy_set_header X-Real-IP $remote_addr;\r\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n    proxy_set_header X-Forwarded-Proto $scheme;\r\n}\n"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"Host"})," \u2192 original domain"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"X-Real-IP"})," \u2192 client IP"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"X-Forwarded-For"})," \u2192 proxy chain"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"X-Forwarded-Proto"})," \u2192 http/https"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"proxying-to-https-backend",children:"Proxying to HTTPS Backend"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"location / {\r\n    proxy_pass https://backend.example.com;\r\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:"Optional SSL tuning:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"proxy_ssl_server_name on;\r\nproxy_ssl_verify off;\n"})}),"\n",(0,i.jsx)(r.h2,{id:"proxy-to-unix-socket-high-performance",children:"Proxy to Unix Socket (High Performance)"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"location / {\r\n    proxy_pass http://unix:/run/backend.sock;\r\n}\n"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Faster than TCP"}),"\n",(0,i.jsx)(r.li,{children:"Common for local services"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"websocket-proxying",children:"WebSocket Proxying"}),"\n",(0,i.jsx)(r.p,{children:"WebSockets require HTTP/1.1 and upgrade headers."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:'location /ws/ {\r\n    proxy_pass http://backend;\r\n\r\n    proxy_http_version 1.1;\r\n    proxy_set_header Upgrade $http_upgrade;\r\n    proxy_set_header Connection "upgrade";\r\n}\n'})}),"\n",(0,i.jsx)(r.h2,{id:"timeout--buffer-controls",children:"Timeout & Buffer Controls"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"location / {\r\n    proxy_pass http://backend;\r\n\r\n    proxy_connect_timeout 5s;\r\n    proxy_read_timeout 60s;\r\n    proxy_send_timeout 60s;\r\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:"Protects NGINX from slow or dead backends"}),"\n",(0,i.jsx)(r.h2,{id:"common-mistakes",children:"Common Mistakes"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Forgetting trailing slash behavior"}),"\n",(0,i.jsx)(r.li,{children:"Missing proxy headers"}),"\n",(0,i.jsx)(r.li,{children:"Using proxy_pass outside location"}),"\n",(0,i.jsx)(r.li,{children:"Proxying HTTPS without SNI"}),"\n",(0,i.jsx)(r.li,{children:"Using if incorrectly"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"debugging-tips",children:"Debugging Tips"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Test config: ",(0,i.jsx)(r.code,{children:"nginx -t"})]}),"\n",(0,i.jsxs)(r.li,{children:["Enable debug logs: ",(0,i.jsx)(r.code,{children:"error_log /var/log/nginx/error.log debug;"})]}),"\n",(0,i.jsxs)(r.li,{children:["Check upstream status: ",(0,i.jsx)(r.code,{children:"curl -v http://example.com"})]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"real-world-example-production-style",children:"Real-World Example (Production Style)"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"server {\r\n    listen 80;\r\n    server_name example.com;\r\n\r\n    location /api/ {\r\n        proxy_pass http://api_backend/;\r\n\r\n        proxy_set_header Host $host;\r\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n        proxy_set_header X-Forwarded-Proto $scheme;\r\n\r\n        proxy_read_timeout 30s;\r\n    }\r\n}\n"})})]})}function x(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);