"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[75397],{13714(e,s,t){t.r(s),t.d(s,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"system-design/Replication/Master-Master Architecture","title":"Master-Master Architecture","description":"Master-Master replication, also known as Peer-to-Peer replication, is a system design pattern where multiple nodes (or instances) are all capable of handling reads and writes. Each node is considered a master, and they synchronize data between each other to stay consistent.","source":"@site/docs/system-design/9. Replication/5. Master-Master Architecture.md","sourceDirName":"system-design/9. Replication","slug":"/system-design/Replication/Master-Master Architecture","permalink":"/handbook/docs/system-design/Replication/Master-Master Architecture","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"systemDesignSidebar","previous":{"title":"Master-Slave Architecture","permalink":"/handbook/docs/system-design/Replication/Master-Slave Architecture"},"next":{"title":"Performance","permalink":"/handbook/docs/system-design/Performance"}}');var n=t(74848),i=t(28453);const l={},a=void 0,d={},o=[{value:"Characteristics of Master-Master",id:"characteristics-of-master-master",level:2},{value:"How it work",id:"how-it-work",level:2},{value:"Use Cases of Master-Master",id:"use-cases-of-master-master",level:2},{value:"Technologies Supporting Master-Master",id:"technologies-supporting-master-master",level:2},{value:"Conflict Resolution",id:"conflict-resolution",level:2},{value:"Example of Master-Master",id:"example-of-master-master",level:2},{value:"Scenario",id:"scenario",level:3},{value:"Flow",id:"flow",level:3},{value:"Diagram",id:"diagram",level:3},{value:"Pros and Cons of Master-Master",id:"pros-and-cons-of-master-master",level:2},{value:"Master-Slave vs Master-Master",id:"master-slave-vs-master-master",level:2}];function c(e){const s={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.p,{children:"Master-Master replication, also known as Peer-to-Peer replication, is a system design pattern where multiple nodes (or instances) are all capable of handling reads and writes. Each node is considered a master, and they synchronize data between each other to stay consistent."}),"\n",(0,n.jsx)(s.p,{children:"Unlike master-slave, where only one node handles writes, in master-master all nodes can perform write operations."}),"\n",(0,n.jsx)(s.h2,{id:"characteristics-of-master-master",children:"Characteristics of Master-Master"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Characteristic"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.strong,{children:"Write at any node"})}),(0,n.jsx)(s.td,{children:"Any master node can handle client write requests"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.strong,{children:"Bi-directional sync"})}),(0,n.jsx)(s.td,{children:"All nodes replicate data to each other to stay in sync"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.strong,{children:"Conflict resolution"})}),(0,n.jsx)(s.td,{children:"Needed when the same data is modified at multiple nodes simultaneously"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.strong,{children:"High availability"})}),(0,n.jsx)(s.td,{children:"No single point of failure; all nodes are active"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.strong,{children:"Eventual consistency"})}),(0,n.jsx)(s.td,{children:"Ensures all replicas eventually converge to the same state"})]})]})]}),"\n",(0,n.jsx)(s.h2,{id:"how-it-work",children:"How it work"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:"Client sends write request to any master node."}),"\n",(0,n.jsx)(s.li,{children:"The node updates its local copy and then propagates the change to other master nodes."}),"\n",(0,n.jsx)(s.li,{children:"Other nodes apply the update, resolving any conflicts if needed."}),"\n",(0,n.jsx)(s.li,{children:"All nodes now reflect the same final state (eventually consistent)."}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"use-cases-of-master-master",children:"Use Cases of Master-Master"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Use Case"}),(0,n.jsx)(s.th,{children:"Reason for Master-Master"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Globally distributed databases"}),(0,n.jsx)(s.td,{children:"Handle local writes without latency from cross-region calls"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"High availability apps"}),(0,n.jsx)(s.td,{children:"Prevent downtime if one node fails"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Offline-first or mobile sync apps"}),(0,n.jsx)(s.td,{children:"Allow clients to write offline, sync later with conflict resolution"})]})]})]}),"\n",(0,n.jsx)(s.h2,{id:"technologies-supporting-master-master",children:"Technologies Supporting Master-Master"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Technology"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.strong,{children:"CouchDB"})}),(0,n.jsx)(s.td,{children:"Built-in multi-master with sync protocols"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.strong,{children:"Cassandra"})}),(0,n.jsx)(s.td,{children:"Peer-to-peer with eventual consistency"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.strong,{children:"MySQL (with Galera)"})}),(0,n.jsx)(s.td,{children:"Provides multi-master synchronous replication"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.strong,{children:"Redis Enterprise"})}),(0,n.jsx)(s.td,{children:"Active-active geo-distributed Redis"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.strong,{children:"Firebase Realtime DB"})}),(0,n.jsx)(s.td,{children:"Supports syncing across clients with conflict resolution"})]})]})]}),"\n",(0,n.jsx)(s.h2,{id:"conflict-resolution",children:"Conflict Resolution"}),"\n",(0,n.jsx)(s.p,{children:"When two masters write to the same key at the same time, a conflict arises."}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Solutions:"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Last Write Wins (LWW): Use timestamps to keep the latest update."}),"\n",(0,n.jsx)(s.li,{children:"Application-level merge logic: E.g., merging two versions of a document."}),"\n",(0,n.jsx)(s.li,{children:"Operational Transformation (OT) or CRDTs: Used in collaborative editing apps like Google Docs."}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"example-of-master-master",children:"Example of Master-Master"}),"\n",(0,n.jsx)(s.h3,{id:"scenario",children:"Scenario"}),"\n",(0,n.jsx)(s.p,{children:"A company runs a shopping app with users in Europe and Asia."}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["Data is stored in two MySQL nodes:","\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.code,{children:"EU_DB"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.code,{children:"ASIA_DB"})}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(s.li,{children:"Both are masters with Galera Cluster for synchronous replication."}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"flow",children:"Flow"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:"A user in Europe updates their shipping address \u2192 write goes to EU_DB."}),"\n",(0,n.jsx)(s.li,{children:"Galera replicates this update to ASIA_DB."}),"\n",(0,n.jsx)(s.li,{children:"A user in Asia updates their phone number \u2192 write goes to ASIA_DB."}),"\n",(0,n.jsx)(s.li,{children:"The change is replicated back to EU_DB."}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"All changes are synchronized in real-time across both regions."}),"\n",(0,n.jsx)(s.h3,{id:"diagram",children:"Diagram"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"                   +-----------+\r\n                   |  Client 1 |\r\n                   +-----------+\r\n                        |\r\n                   +----------+\r\n                   | Master A |\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n                   +----------+                          \u2502\r\n                        \u25b2                                \u2502\r\n                        \u2502 bi-directional replication     \u2502\r\n                        \u25bc                                \u2502\r\n                   +----------+                          \u2502\r\n                   | Master B |\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n                   +----------+\r\n                        |\r\n                   +-----------+\r\n                   |  Client 2 |\r\n                   +-----------+\n"})}),"\n",(0,n.jsx)(s.h2,{id:"pros-and-cons-of-master-master",children:"Pros and Cons of Master-Master"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"\u2705 Pros"}),(0,n.jsx)(s.th,{children:"\u274c Cons"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"High availability (no single point of failure)"}),(0,n.jsx)(s.td,{children:"Conflict resolution complexity"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Scalable for global apps"}),(0,n.jsx)(s.td,{children:"Harder to guarantee strict consistency"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Writes are locally fast (geo-distributed)"}),(0,n.jsxs)(s.td,{children:["Potential for ",(0,n.jsx)(s.strong,{children:"write-write conflicts"})]})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Load can be evenly distributed"}),(0,n.jsx)(s.td,{children:"More complex deployment and monitoring"})]})]})]}),"\n",(0,n.jsx)(s.h2,{id:"master-slave-vs-master-master",children:"Master-Slave vs Master-Master"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Feature"}),(0,n.jsx)(s.th,{children:"Master-Slave"}),(0,n.jsx)(s.th,{children:"Master-Master"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Write node(s)"}),(0,n.jsx)(s.td,{children:"Only master"}),(0,n.jsx)(s.td,{children:"Any node (all are writable)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Conflict possibility"}),(0,n.jsx)(s.td,{children:"No (single writer)"}),(0,n.jsx)(s.td,{children:"Yes (must be resolved)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Availability"}),(0,n.jsx)(s.td,{children:"Lower (if master fails)"}),(0,n.jsx)(s.td,{children:"Higher (no single point of failure)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Performance"}),(0,n.jsx)(s.td,{children:"Read-heavy workloads"}),(0,n.jsx)(s.td,{children:"Read/write-heavy & globally distributed"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:"Complexity"}),(0,n.jsx)(s.td,{children:"Lower"}),(0,n.jsx)(s.td,{children:"Higher"})]})]})]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},28453(e,s,t){t.d(s,{R:()=>l,x:()=>a});var r=t(96540);const n={},i=r.createContext(n);function l(e){const s=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:l(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);