"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[9089],{18451(e,n,r){r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>x,frontMatter:()=>c,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"nginx/Contexts","title":"Contexts","description":"NGINX configuration is hierarchical.","source":"@site/docs/nginx/5. Contexts.md","sourceDirName":"nginx","slug":"/nginx/Contexts","permalink":"/handbook/docs/nginx/Contexts","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"nginxApiSidebar","previous":{"title":"Configuration","permalink":"/handbook/docs/nginx/Configuration"},"next":{"title":"Directives vs Blocks","permalink":"/handbook/docs/nginx/Directives vs Blocks"}}');var i=r(74848),l=r(28453);const c={},d=void 0,t={},o=[{value:"Main Context (Global Context)",id:"main-context-global-context",level:2},{value:"HTTP Context",id:"http-context",level:2},{value:"Server Context",id:"server-context",level:2},{value:"Location Context",id:"location-context",level:2},{value:"Complete Example",id:"complete-example",level:2}];function h(e){const n={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"NGINX configuration is hierarchical.\r\nEach directive is valid only inside specific contexts."}),"\n",(0,i.jsx)(n.p,{children:"Hierarchy (simplified):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"main\r\n \u2514\u2500\u2500 http\r\n      \u2514\u2500\u2500 server\r\n           \u2514\u2500\u2500 location\n"})}),"\n",(0,i.jsx)(n.p,{children:"Each lower context inherits settings from the higher context unless overridden."}),"\n",(0,i.jsx)(n.h2,{id:"main-context-global-context",children:"Main Context (Global Context)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["What it is:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The top-level context"}),"\n",(0,i.jsx)(n.li,{children:"Defined outside of any blocks"}),"\n",(0,i.jsx)(n.li,{children:"Affects the entire NGINX instance"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["What it controls:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Worker processes"}),"\n",(0,i.jsx)(n.li,{children:"User/group"}),"\n",(0,i.jsx)(n.li,{children:"Error logging"}),"\n",(0,i.jsx)(n.li,{children:"Performance tuning"}),"\n",(0,i.jsx)(n.li,{children:"Global limits"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Common Directives"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Directive"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"user"})}),(0,i.jsx)(n.td,{children:"OS user for worker processes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"worker_processes"})}),(0,i.jsx)(n.td,{children:"Number of worker processes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"pid"})}),(0,i.jsx)(n.td,{children:"PID file location"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"error_log"})}),(0,i.jsx)(n.td,{children:"Global error log"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"worker_rlimit_nofile"})}),(0,i.jsx)(n.td,{children:"File descriptor limit"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"user nginx;\r\nworker_processes auto;\r\nerror_log /var/log/nginx/error.log warn;\r\npid /run/nginx.pid;\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Explanation"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"worker_processes auto;"})," \u2192 One worker per CPU core"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"user nginx;"})," \u2192 Workers run as ",(0,i.jsx)(n.code,{children:"nginx"})," user"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"error_log"})," \u2192 Global logging applies everywhere unless overridden"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"http-context",children:"HTTP Context"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["What it is","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Defined using the http "," block"]}),"\n",(0,i.jsx)(n.li,{children:"Required for web traffic (HTTP/HTTPS)"}),"\n",(0,i.jsx)(n.li,{children:"Contains server blocks"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["What it controls","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Web-related configuration"}),"\n",(0,i.jsx)(n.li,{children:"MIME types"}),"\n",(0,i.jsx)(n.li,{children:"Logging format"}),"\n",(0,i.jsx)(n.li,{children:"Compression"}),"\n",(0,i.jsx)(n.li,{children:"Default behavior for all servers"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Common directives"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Directive"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"include mime.types"})}),(0,i.jsx)(n.td,{children:"File type mapping"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"log_format"})}),(0,i.jsx)(n.td,{children:"Define access log format"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"access_log"})}),(0,i.jsx)(n.td,{children:"Enable access logging"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sendfile"})}),(0,i.jsx)(n.td,{children:"Efficient file transfer"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"keepalive_timeout"})}),(0,i.jsx)(n.td,{children:"Connection reuse"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"gzip"})}),(0,i.jsx)(n.td,{children:"Compression"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Directive"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"include mime.types"})}),(0,i.jsx)(n.td,{children:"File type mapping"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"log_format"})}),(0,i.jsx)(n.td,{children:"Define access log format"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"access_log"})}),(0,i.jsx)(n.td,{children:"Enable access logging"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sendfile"})}),(0,i.jsx)(n.td,{children:"Efficient file transfer"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"keepalive_timeout"})}),(0,i.jsx)(n.td,{children:"Connection reuse"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"gzip"})}),(0,i.jsx)(n.td,{children:"Compression"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Explanation"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"include mime.types;"})," \u2192 Maps ",(0,i.jsx)(n.code,{children:".html"}),", ",(0,i.jsx)(n.code,{children:".jpg"}),", etc."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"log_format"})," \u2192 Defines reusable logging format"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sendfile on;"})," \u2192 Faster static file serving"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"server-context",children:"Server Context"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["What it is","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Defined using server "," inside http"]}),"\n",(0,i.jsx)(n.li,{children:"Represents a virtual host"}),"\n",(0,i.jsx)(n.li,{children:"Handles requests for specific IPs/domains/ports"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["What it controls","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Domain names"}),"\n",(0,i.jsx)(n.li,{children:"Ports"}),"\n",(0,i.jsx)(n.li,{children:"SSL configuration"}),"\n",(0,i.jsx)(n.li,{children:"Root directories"}),"\n",(0,i.jsx)(n.li,{children:"Default request handling"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Common directives"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Directive"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"listen"})}),(0,i.jsx)(n.td,{children:"Port/IP to listen on"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"server_name"})}),(0,i.jsx)(n.td,{children:"Domain names"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"root"})}),(0,i.jsx)(n.td,{children:"Document root"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"index"})}),(0,i.jsx)(n.td,{children:"Default file"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"error_page"})}),(0,i.jsx)(n.td,{children:"Custom error pages"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"server {\r\n    listen 80;\r\n    server_name example.com www.example.com;\r\n\r\n    root /var/www/example;\r\n    index index.html;\r\n}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"listen 80;"})," \u2192 Accept HTTP traffic"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"server_name"})," \u2192 Domain matching"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"root"})," \u2192 Base directory for files"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"location-context",children:"Location Context"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["What it is","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Defined using location "," inside a server"]}),"\n",(0,i.jsx)(n.li,{children:"Matches URIs (paths) of requests"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["What it controls","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Routing logic"}),"\n",(0,i.jsx)(n.li,{children:"Static vs dynamic content"}),"\n",(0,i.jsx)(n.li,{children:"Proxying"}),"\n",(0,i.jsx)(n.li,{children:"Access control"}),"\n",(0,i.jsx)(n.li,{children:"Rewriting URLs"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Location matching types"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Meaning"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"location /"})}),(0,i.jsx)(n.td,{children:"Prefix match"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"location = /"})}),(0,i.jsx)(n.td,{children:"Exact match"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"location ~"})}),(0,i.jsx)(n.td,{children:"Regex (case-sensitive)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"location ~*"})}),(0,i.jsx)(n.td,{children:"Regex (case-insensitive)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"location ^~"})}),(0,i.jsx)(n.td,{children:"Priority prefix"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"location /images/ {\r\n    root /var/www/assets;\r\n}\r\n\r\nlocation ~ \\.php$ {\r\n    fastcgi_pass unix:/run/php/php-fpm.sock;\r\n}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/images/"})," \u2192 Matches ",(0,i.jsx)(n.code,{children:"/images/logo.png"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"~ \\.php$"})," \u2192 Regex match for PHP files"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"fastcgi_pass"})," \u2192 Sends PHP to PHP-FPM"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"user nginx;\r\nworker_processes auto;\r\n\r\nevents {\r\n    worker_connections 1024;\r\n}\r\n\r\nhttp {\r\n    include mime.types;\r\n    default_type text/plain;\r\n\r\n    server {\r\n        listen 80;\r\n        server_name example.com;\r\n\r\n        root /var/www/example;\r\n        index index.html;\r\n\r\n        location / {\r\n            try_files $uri $uri/ =404;\r\n        }\r\n\r\n        location /api/ {\r\n            proxy_pass http://backend_server;\r\n        }\r\n\r\n        location ~ \\.php$ {\r\n            fastcgi_pass unix:/run/php/php-fpm.sock;\r\n            include fastcgi_params;\r\n        }\r\n    }\r\n}\r\n\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Request Flow (How NGINX Uses Contexts)"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Main \u2192 Sets global worker behavior"}),"\n",(0,i.jsx)(n.li,{children:"HTTP \u2192 Enables web functionality"}),"\n",(0,i.jsx)(n.li,{children:"Server \u2192 Chooses correct virtual host"}),"\n",(0,i.jsx)(n.li,{children:"Location \u2192 Routes request to correct handler"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example request:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"GET http://example.com/api/users\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Matched ",(0,i.jsx)(n.code,{children:"server_name example.com"})]}),"\n",(0,i.jsxs)(n.li,{children:["Matched location ",(0,i.jsx)(n.code,{children:"/api/"})]}),"\n",(0,i.jsxs)(n.li,{children:["Forwarded to backend via ",(0,i.jsx)(n.code,{children:"proxy_pass"})]}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},28453(e,n,r){r.d(n,{R:()=>c,x:()=>d});var s=r(96540);const i={},l=s.createContext(i);function c(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);