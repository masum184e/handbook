"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[6093],{7100(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"javascript/Browser Execution/Runtime","title":"Runtime","description":"JavaScript Runtime","source":"@site/docs/javascript/Browser Execution/6. Runtime.md","sourceDirName":"javascript/Browser Execution","slug":"/javascript/Browser Execution/Runtime","permalink":"/handbook/docs/javascript/Browser Execution/Runtime","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{},"sidebar":"javascriptSidebar","previous":{"title":"Engine","permalink":"/handbook/docs/javascript/Browser Execution/Engine"},"next":{"title":"Execution Model","permalink":"/handbook/docs/javascript/Browser Execution/Execution Model"}}');var i=s(4848),t=s(8453);const c={},l=void 0,o={},d=[{value:"Heap",id:"heap",level:2},{value:"Callstack",id:"callstack",level:2},{value:"Stack vs Heap",id:"stack-vs-heap",level:3},{value:"Event Loop",id:"event-loop",level:2},{value:"Queue",id:"queue",level:2},{value:"Microtasks",id:"microtasks",level:3},{value:"Macrotasks",id:"macrotasks",level:3},{value:"Combined Example",id:"combined-example",level:3}];function a(e){const n={code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"JavaScript Runtime",src:s(8284).A+"",width:"1024",height:"490"})}),"\n",(0,i.jsx)(n.h2,{id:"heap",children:"Heap"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"it stores the value of the variables, functions."}),"\n",(0,i.jsx)(n.li,{children:"Stores dynamic, variable-size objects."}),"\n",(0,i.jsx)(n.li,{children:"Slower access."}),"\n",(0,i.jsx)(n.li,{children:"Used for non-primitives (objects, arrays, functions)."}),"\n",(0,i.jsx)(n.li,{children:"The references stored in the stack, but the actual object/array data lives in the heap."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-scss",children:'Stack:\r\nobj -> reference (pointer to heap)\r\narr -> reference (pointer to heap)\r\n\r\nHeap:\r\n{ name: "Masum" }\r\n[1,2,3]\n'})}),"\n",(0,i.jsx)(n.h2,{id:"callstack",children:"Callstack"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["its also called ",(0,i.jsx)(n.code,{children:"Execution Context Stack"})]}),"\n",(0,i.jsx)(n.li,{children:"whenever a new execution context is created(a function is invoked), it is pushed onto the stack"}),"\n",(0,i.jsx)(n.li,{children:"when a function is completes, its execution context is popped off the stack"}),"\n",(0,i.jsx)(n.li,{children:"Stores fixed-size, simple data."}),"\n",(0,i.jsx)(n.li,{children:"Fast access."}),"\n",(0,i.jsx)(n.li,{children:"Used for primitives and references to objects."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"stack-vs-heap",children:"Stack vs Heap"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Stack (fast, fixed size):\r\n+-------+\r\n| x = 10|\r\n| y = 20|\r\n| obj -> pointer to heap |\r\n+-------+\r\n\r\nHeap (dynamic, big):\r\n+---------------------+\r\n| { name: "Masum" }   |\r\n| [1,2,3]             |\r\n+---------------------+\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"When you copy a primitive, a new copy is made."}),"\n",(0,i.jsx)(n.li,{children:"When you copy a non-primitive, the reference is copied, not the object itself."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"var"}),", ",(0,i.jsx)(n.code,{children:"let"}),", and ",(0,i.jsx)(n.code,{children:"const"})," don\u2019t define where (heap or stack) a value is stored; they only define the variable\u2019s scope and, in the case of ",(0,i.jsx)(n.code,{children:"const"}),", the immutability of the binding. The actual storage depends on the type of value: primitives go on the stack, and objects/arrays/functions go on the heap."]}),"\n",(0,i.jsx)(n.h2,{id:"event-loop",children:"Event Loop"}),"\n",(0,i.jsx)(n.p,{children:"V8 only executes JavaScript \u2014 it doesn\u2019t include Web APIs or the event loop itself."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"In Chrome \u2192 V8 + Blink (browser runtime)"}),"\n",(0,i.jsx)(n.li,{children:"In Node.js \u2192 V8 + libuv (event loop + async I/O)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"So:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"V8 runs your JS synchronously."}),"\n",(0,i.jsx)(n.li,{children:"Asynchronous tasks (timers, fetch, I/O) are handled by the host environment and return results back to V8 via callback queues."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The Event Loop continuously checks:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"The Call Stack \u2192 runs synchronous code"}),"\n",(0,i.jsx)(n.li,{children:"The Microtask Queue \u2192 runs microtasks (Promises, async/await, etc.)"}),"\n",(0,i.jsxs)(n.li,{children:["The Macrotask Queue (also called the Task Queue) \u2192 runs tasks like ",(0,i.jsx)(n.code,{children:"setTimeout"}),", ",(0,i.jsx)(n.code,{children:"fetch"}),", and events"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"queue",children:"Queue"}),"\n",(0,i.jsx)(n.p,{children:"A queue is a general term for a list of tasks waiting to be executed in order (FIFO \u2014 First In, First Out)."}),"\n",(0,i.jsx)(n.p,{children:"In JavaScript:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["There are different queues for different types of asynchronous work:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Microtask Queue"}),"\n",(0,i.jsx)(n.li,{children:"Macrotask Queue (Task Queue)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"So when people say \u201cthe queue,\u201d they usually mean one of these two queues managed by the Event Loop."}),"\n",(0,i.jsx)(n.h3,{id:"microtasks",children:"Microtasks"}),"\n",(0,i.jsx)(n.p,{children:"Microtasks are small, high-priority asynchronous tasks that execute immediately after the current synchronous code \u2014 before the browser renders or any macrotasks run."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Promise.then()"}),", ",(0,i.jsx)(n.code,{children:"Promise.catch()"}),", ",(0,i.jsx)(n.code,{children:"Promise.finally()"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"async/await"})," (code after ",(0,i.jsx)(n.code,{children:"await"}),")"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"queueMicrotask()"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"MutationObserver"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"When They Run:"})}),"\n",(0,i.jsx)(n.p,{children:"After the current synchronous task finishes and before any macrotask starts."}),"\n",(0,i.jsx)(n.h3,{id:"macrotasks",children:"Macrotasks"}),"\n",(0,i.jsx)(n.p,{children:"Macrotasks (also called tasks) are larger asynchronous tasks that are scheduled to run after all microtasks have finished."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"setTimeout()"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"setInterval()"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"setImmediate()"})," (Node.js)"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"I/O callbacks"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"fetch().then()"})," (fetch callback itself is microtask)"]}),"\n",(0,i.jsxs)(n.li,{children:["DOM events like ",(0,i.jsx)(n.code,{children:"click"})," or ",(0,i.jsx)(n.code,{children:"scroll"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"When They Run:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"After all synchronous code and all microtasks are completed."}),"\n",(0,i.jsx)(n.li,{children:"Only one macrotask runs per event loop cycle."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"combined-example",children:"Combined Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'console.log("1");\r\n\r\nsetTimeout(() => console.log("2 (Macrotask)"), 0);\r\n\r\nPromise.resolve().then(() => console.log("3 (Microtask)"));\r\n\r\nconsole.log("4");\n'})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Step"}),(0,i.jsx)(n.th,{children:"Action"}),(0,i.jsx)(n.th,{children:"Queue"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"1"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:'"1"'})," logged"]}),(0,i.jsx)(n.td,{children:"Synchronous"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"2"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"setTimeout()"})," added to ",(0,i.jsx)(n.strong,{children:"Macrotask Queue"})]}),(0,i.jsx)(n.td,{children:"Macrotask"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"3"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"Promise.then()"})," added to ",(0,i.jsx)(n.strong,{children:"Microtask Queue"})]}),(0,i.jsx)(n.td,{children:"Microtask"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"4"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:'"4"'})," logged"]}),(0,i.jsx)(n.td,{children:"Synchronous"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"5"}),(0,i.jsxs)(n.td,{children:["Stack empty \u2192 run ",(0,i.jsx)(n.strong,{children:"Microtask Queue"})]}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:'"3"'})," logged"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"6"}),(0,i.jsxs)(n.td,{children:["Then run ",(0,i.jsx)(n.strong,{children:"Macrotask Queue"})]}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:'"2"'})," logged"]})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"The Microtask Queue and the Macrotask Queue in JavaScript are both regular FIFO (First-In, First-Out) queues in structure \u2014\r\nbut the Event Loop gives higher priority to the Microtask Queue when deciding what to execute next."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8284(e,n,s){s.d(n,{A:()=>r});const r=s.p+"assets/images/jsruntime-e706e154cd2944404ebd9996bf15b482.png"},8453(e,n,s){s.d(n,{R:()=>c,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function c(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);