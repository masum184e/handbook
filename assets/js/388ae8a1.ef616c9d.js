"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[2718],{28453(e,n,i){i.d(n,{R:()=>d,x:()=>c});var r=i(96540);const l={},s=r.createContext(l);function d(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),r.createElement(s.Provider,{value:n},e.children)}},78563(e,n,i){i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>a,frontMatter:()=>d,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"nginx/Include Directive","title":"Include Directive","description":"The include directive tells NGINX to read and insert configuration files from another location as if their contents were written directly at that place.","source":"@site/docs/nginx/7. Include Directive.md","sourceDirName":"nginx","slug":"/nginx/Include Directive","permalink":"/handbook/docs/nginx/Include Directive","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":7,"frontMatter":{},"sidebar":"nginxApiSidebar","previous":{"title":"Directives vs Blocks","permalink":"/handbook/docs/nginx/Directives vs Blocks"},"next":{"title":"proxay_pass","permalink":"/handbook/docs/nginx/Reverse Proxy/proxay_pass"}}');var l=i(74848),s=i(28453);const d={},c=void 0,t={},o=[{value:"Why include Exists",id:"why-include-exists",level:2},{value:"Where include Can Be Used (Contexts)",id:"where-include-can-be-used-contexts",level:2},{value:"How include Works Internally",id:"how-include-works-internally",level:2},{value:"Including a Single File",id:"including-a-single-file",level:2},{value:"Using Wildcards (Glob Patterns)",id:"using-wildcards-glob-patterns",level:2},{value:"Modular Virtual Hosts",id:"modular-virtual-hosts",level:2},{value:"Including Inside Server Context",id:"including-inside-server-context",level:2},{value:"Including Inside Location Context",id:"including-inside-location-context",level:2},{value:"Include Order &amp; Precedence",id:"include-order--precedence",level:2},{value:"Error Handling &amp; Validation",id:"error-handling--validation",level:2},{value:"Production Style Layout",id:"production-style-layout",level:2}];function h(e){const n={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"include"})," directive tells NGINX to read and insert configuration files from another location as if their contents were written directly at that place."]}),"\n",(0,l.jsx)(n.p,{children:"It is a core directive, not a module-specific feature."}),"\n",(0,l.jsx)(n.p,{children:"Syntax"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"include path;\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Ends with ",(0,l.jsx)(n.code,{children:";"})]}),"\n",(0,l.jsxs)(n.li,{children:["path can be:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"A single file"}),"\n",(0,l.jsx)(n.li,{children:"A wildcard (glob pattern)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"why-include-exists",children:"Why include Exists"}),"\n",(0,l.jsxs)(n.p,{children:["NGINX configs can become large and hard to manage.\r\n",(0,l.jsx)(n.code,{children:"include"})," enables:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Modular configuration"}),"\n",(0,l.jsx)(n.li,{children:"Reusability"}),"\n",(0,l.jsx)(n.li,{children:"Cleaner main config"}),"\n",(0,l.jsx)(n.li,{children:"Easier maintenance"}),"\n",(0,l.jsx)(n.li,{children:"Environment-based setups"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"where-include-can-be-used-contexts",children:"Where include Can Be Used (Contexts)"}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"include"})," directive is context-sensitive."]}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Context"}),(0,l.jsx)(n.th,{children:"Allowed"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"main"})}),(0,l.jsx)(n.td,{children:"\u2705"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"http"})}),(0,l.jsx)(n.td,{children:"\u2705"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"server"})}),(0,l.jsx)(n.td,{children:"\u2705"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"location"})}),(0,l.jsx)(n.td,{children:"\u2705"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"events"})}),(0,l.jsx)(n.td,{children:"\u2705"})]})]})]}),"\n",(0,l.jsx)(n.p,{children:"The included file must contain directives valid in the context where it is included"}),"\n",(0,l.jsx)(n.h2,{id:"how-include-works-internally",children:"How include Works Internally"}),"\n",(0,l.jsx)(n.p,{children:"When NGINX loads:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"It encounters include"}),"\n",(0,l.jsx)(n.li,{children:"Reads the target file(s)"}),"\n",(0,l.jsx)(n.li,{children:"Inserts the contents verbatim"}),"\n",(0,l.jsx)(n.li,{children:"Validates directives normally"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"include is not dynamic \u2014 changes require reload."}),"\n",(0,l.jsx)(n.h2,{id:"including-a-single-file",children:"Including a Single File"}),"\n",(0,l.jsxs)(n.p,{children:["Main Config (",(0,l.jsx)(n.code,{children:"nginx.conf"}),")"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-nginx",children:"http {\r\n    include /etc/nginx/mime.types;\r\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:"Included File (`mime.types)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-nginx",children:"types {\r\n    text/html html;\r\n    image/jpeg jpg jpeg;\r\n}\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"mime.types"})," is inserted into the http block"]}),"\n",(0,l.jsx)(n.li,{children:"Provides file extension \u2192 MIME mapping"}),"\n",(0,l.jsxs)(n.li,{children:["This is the most common use of ",(0,l.jsx)(n.code,{children:"include"})]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"using-wildcards-glob-patterns",children:"Using Wildcards (Glob Patterns)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"include /etc/nginx/conf.d/*.conf;\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Includes all .conf files in the directory"}),"\n",(0,l.jsx)(n.li,{children:"Order is alphabetical"}),"\n",(0,l.jsx)(n.li,{children:"Non-matching files are ignored silently"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Typical directory layout"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"/etc/nginx/\r\n\u251c\u2500\u2500 nginx.conf\r\n\u251c\u2500\u2500 conf.d/\r\n\u2502   \u251c\u2500\u2500 default.conf\r\n\u2502   \u251c\u2500\u2500 api.conf\r\n\u2502   \u2514\u2500\u2500 ssl.conf\n"})}),"\n",(0,l.jsx)(n.h2,{id:"modular-virtual-hosts",children:"Modular Virtual Hosts"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:"nginx.conf"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"http {\r\n    include /etc/nginx/conf.d/*.conf;\r\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:"conf.d/example.conf"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"server {\r\n    listen 80;\r\n    server_name example.com;\r\n\r\n    root /var/www/example;\r\n}\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Each file defines one virtual host"}),"\n",(0,l.jsx)(n.li,{children:"Easy to add/remove sites"}),"\n",(0,l.jsxs)(n.li,{children:["No need to edit ",(0,l.jsx)(n.code,{children:"nginx.conf"})]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"including-inside-server-context",children:"Including Inside Server Context"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"server {\r\n    listen 443 ssl;\r\n    server_name example.com;\r\n\r\n    include /etc/nginx/snippets/ssl.conf;\r\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:"snippets/ssl.conf"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"ssl_certificate /etc/ssl/certs/example.crt;\r\nssl_certificate_key /etc/ssl/private/example.key;\r\nssl_protocols TLSv1.2 TLSv1.3;\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Keeps SSL config reusable"}),"\n",(0,l.jsx)(n.li,{children:"Avoids duplication across servers"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"including-inside-location-context",children:"Including Inside Location Context"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"location /api/ {\r\n    include /etc/nginx/snippets/proxy.conf;\r\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:"proxy.conf"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"proxy_set_header Host $host;\r\nproxy_set_header X-Real-IP $remote_addr;\r\nproxy_pass http://backend;\n"})}),"\n",(0,l.jsxs)(n.p,{children:["-",(0,l.jsx)(n.code,{children:"Common proxy settings reused -"}),"Must contain only directives valid inside ",(0,l.jsx)(n.code,{children:"location"})]}),"\n",(0,l.jsx)(n.h2,{id:"include-order--precedence",children:"Include Order & Precedence"}),"\n",(0,l.jsx)(n.p,{children:"NGINX processes includes in place and in order."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"http {\r\n    sendfile off;\r\n    include tuning.conf;\r\n}\n"})}),"\n",(0,l.jsxs)(n.p,{children:["If ",(0,l.jsx)(n.code,{children:"tuning.conf"})," contains:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"sendfile on;\r\n\n"})}),"\n",(0,l.jsx)(n.p,{children:"Final value: sendfile on"}),"\n",(0,l.jsx)(n.h2,{id:"error-handling--validation",children:"Error Handling & Validation"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Situation"}),(0,l.jsx)(n.th,{children:"Result"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"File not found"}),(0,l.jsx)(n.td,{children:"\u274c NGINX fails to start"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"No files match wildcard"}),(0,l.jsx)(n.td,{children:"\u2705 No error"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Invalid directive inside file"}),(0,l.jsx)(n.td,{children:"\u274c Config test fails"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Wrong context"}),(0,l.jsx)(n.td,{children:"\u274c Startup error"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"production-style-layout",children:"Production Style Layout"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"/etc/nginx/\r\n\u251c\u2500\u2500 nginx.conf\r\n\u251c\u2500\u2500 conf.d/\r\n\u2502   \u251c\u2500\u2500 default.conf\r\n\u2502   \u2514\u2500\u2500 app.conf\r\n\u251c\u2500\u2500 snippets/\r\n\u2502   \u251c\u2500\u2500 ssl.conf\r\n\u2502   \u251c\u2500\u2500 proxy.conf\r\n\u2502   \u2514\u2500\u2500 security.conf\r\n\n"})})]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}}}]);