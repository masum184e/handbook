"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[3e3],{8453(e,n,s){s.d(n,{R:()=>l,x:()=>o});var t=s(6540);const r={},i=t.createContext(r);function l(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(i.Provider,{value:n},e.children)}},9454(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"nextjs/Testing","title":"Testing","description":"Jest is a popular JavaScript testing framework:","source":"@site/docs/nextjs/16. Testing.md","sourceDirName":"nextjs","slug":"/nextjs/Testing","permalink":"/handbook/docs/nextjs/Testing","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":18,"frontMatter":{"title":"Testing","sidebar_position":18},"sidebar":"nextjsSidebar","previous":{"title":"Custom Server","permalink":"/handbook/docs/nextjs/Custom Server"},"next":{"title":"Error Handling","permalink":"/handbook/docs/nextjs/Error Handling"}}');var r=s(4848),i=s(8453);const l={title:"Testing",sidebar_position:18},o=void 0,a={},c=[{value:"Utility Function Testing",id:"utility-function-testing",level:2},{value:"Installing Dependencies",id:"installing-dependencies",level:3},{value:"Configuring Jest",id:"configuring-jest",level:3},{value:"Utility Function",id:"utility-function",level:3},{value:"Component Testing",id:"component-testing",level:2},{value:"Installing Dependencies",id:"installing-dependencies-1",level:3},{value:"Configuring Jest",id:"configuring-jest-1",level:3},{value:"React Components",id:"react-components",level:3},{value:"End-to-End Testing",id:"end-to-end-testing",level:2},{value:"Why Puppeteer for E2E Testing?",id:"why-puppeteer-for-e2e-testing",level:3},{value:"Setting up Puppeteer",id:"setting-up-puppeteer",level:3},{value:"Install dependencies",id:"install-dependencies",level:4},{value:"Configure Jest for E2E tests",id:"configure-jest-for-e2e-tests",level:4},{value:"Writing an E2E Test",id:"writing-an-e2e-test",level:3},{value:"NPM Configuration",id:"npm-configuration",level:3},{value:"Running E2E Tests",id:"running-e2e-tests",level:3},{value:"API routes Testing",id:"api-routes-testing",level:2},{value:"Testing a Simple API Route",id:"testing-a-simple-api-route",level:3},{value:"Testing API Routes with <code>supertest</code>",id:"testing-api-routes-with-supertest",level:3},{value:"Best Practices for API Testing",id:"best-practices-for-api-testing",level:3}];function d(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Jest is a popular JavaScript testing framework:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Built-in test runner and assertion library."}),"\n",(0,r.jsx)(n.li,{children:"Excellent TypeScript support."}),"\n",(0,r.jsx)(n.li,{children:"Works seamlessly with React and Next.js."}),"\n",(0,r.jsx)(n.li,{children:"Can be extended with React Testing Library for user-focused component testing."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"utility-function-testing",children:"Utility Function Testing"}),"\n",(0,r.jsx)(n.h3,{id:"installing-dependencies",children:"Installing Dependencies"}),"\n",(0,r.jsx)(n.p,{children:"Install Jest and TypeScript helpers:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install --save-dev jest @types/jest ts-jest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"configuring-jest",children:"Configuring Jest"}),"\n",(0,r.jsxs)(n.p,{children:["Create a ",(0,r.jsx)(n.code,{children:"jest.config.ts"})," file at the root:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import nextJest from "next/jest.js";\r\n\r\nconst createJestConfig = nextJest({\r\n  dir: "./",\r\n});\r\n\r\nconst customJestConfig = {\r\n  setupFilesAfterEnv: ["<rootDir>/jest.setup.ts"],\r\n  testEnvironment: "jest-environment-jsdom",\r\n  moduleNameMapper: {\r\n    "^@/(.*)$": "<rootDir>/src/$1",\r\n  },\r\n};\r\n\r\nexport default createJestConfig(customJestConfig);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"utility-function",children:"Utility Function"}),"\n",(0,r.jsx)(n.h2,{id:"component-testing",children:"Component Testing"}),"\n",(0,r.jsx)(n.p,{children:"Suppose you have a simple math utility:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// src/utils/math.ts\r\nexport const add = (a: number, b: number): number => a + b;\r\nexport const subtract = (a: number, b: number): number => a - b;\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Create a test file: ",(0,r.jsx)(n.code,{children:"src/utils/math.test.ts"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import { add, subtract } from "./math";\r\n\r\ndescribe("Math Utilities", () => {\r\n  it("adds two numbers correctly", () => {\r\n    expect(add(2, 3)).toBe(5);\r\n    expect(add(-2, -3)).toBe(-5);\r\n  });\r\n\r\n  it("subtracts two numbers correctly", () => {\r\n    expect(subtract(5, 3)).toBe(2);\r\n    expect(subtract(-2, -3)).toBe(1);\r\n  });\r\n});\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"describe"})," groups related tests."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"it"})," (or ",(0,r.jsx)(n.code,{children:"test"}),") defines a single test case."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"expect(...).toBe(...)"})," asserts expected results."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Run Tests"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"npm test -- --runInBand\n"})}),"\n",(0,r.jsx)(n.h3,{id:"installing-dependencies-1",children:"Installing Dependencies"}),"\n",(0,r.jsx)(n.p,{children:"Install React Testing Library for component testing:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install --save-dev @testing-library/react @testing-library/jest-dom @testing-library/user-event jest-environment-jsdom\n"})}),"\n",(0,r.jsx)(n.h3,{id:"configuring-jest-1",children:"Configuring Jest"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"jest.setup.ts"})," to add RTL matchers:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import "@testing-library/jest-dom"; // Provides custom matchers like toBeInTheDocument()\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Add a test script in ",(0,r.jsx)(n.code,{children:"package.json"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'"scripts": {\r\n  "test": "jest --config jest.config.ts",\r\n}\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"jest"})," \u2192 runs tests once."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"jest --watch"})," \u2192 reruns tests when files change."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"react-components",children:"React Components"}),"\n",(0,r.jsx)(n.p,{children:"React Testing Library encourages testing components as a user would interact with them."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'// src/components/Title.tsx\r\ninterface TitleProps {\r\n  title: string;\r\n}\r\n\r\nconst Title = ({ title }: TitleProps) => {\r\n  return <h1 className="text-4xl font-bold">{title}</h1>;\r\n};\r\n\r\nexport default Title;\n'})}),"\n",(0,r.jsx)(n.p,{children:"Example Test"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'// src/components/__tests__/Title.test.tsx\r\nimport { render, screen } from "@testing-library/react";\r\nimport Title from "../Title";\r\n\r\ndescribe("Title Component", () => {\r\n  it("renders the provided title", () => {\r\n    render(<Title title="Hello World" />);\r\n    const heading = screen.getByRole("heading", { name: /hello world/i });\r\n\r\n    expect(heading).toBeInTheDocument();\r\n    expect(heading).toHaveClass("text-4xl", "font-bold");\r\n  });\r\n\r\n  it("renders different titles dynamically", () => {\r\n    render(<Title title="Next.js Testing" />);\r\n    expect(screen.getByText(/next\\.js testing/i)).toBeInTheDocument();\r\n  });\r\n});\n'})}),"\n",(0,r.jsx)(n.h2,{id:"end-to-end-testing",children:"End-to-End Testing"}),"\n",(0,r.jsx)(n.p,{children:"E2E testing simulates real user interactions with your application. Unlike unit or integration tests, which test small pieces of functionality, E2E tests verify the entire workflow from the front-end UI to the back-end server."}),"\n",(0,r.jsx)(n.p,{children:"For example, in a Next.js app, an E2E test might:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Open the browser."}),"\n",(0,r.jsx)(n.li,{children:"Navigate to a page."}),"\n",(0,r.jsx)(n.li,{children:"Click buttons or fill forms."}),"\n",(0,r.jsx)(n.li,{children:"Verify that the expected behavior occurs (like a redirect or a new element appearing)."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"why-puppeteer-for-e2e-testing",children:"Why Puppeteer for E2E Testing?"}),"\n",(0,r.jsx)(n.p,{children:"Puppeteer is a Node library that provides a high-level API to control Chrome/Chromium. It is perfect for E2E testing because:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Runs a real browser for accurate tests."}),"\n",(0,r.jsx)(n.li,{children:"Supports headless mode (faster CI/CD runs)."}),"\n",(0,r.jsx)(n.li,{children:"Can simulate user actions (click, type, scroll, etc.)."}),"\n",(0,r.jsx)(n.li,{children:"Can take screenshots or record performance metrics."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"setting-up-puppeteer",children:"Setting up Puppeteer"}),"\n",(0,r.jsx)(n.h4,{id:"install-dependencies",children:"Install dependencies"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install --save-dev puppeteer  @types/puppeteer\n"})}),"\n",(0,r.jsx)(n.h4,{id:"configure-jest-for-e2e-tests",children:"Configure Jest for E2E tests"}),"\n",(0,r.jsx)(n.p,{children:"You may want a separate folder for E2E tests:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"project-root/\r\n\u2502\r\n\u251c\u2500 e2e/\r\n\u2502   \u2514\u2500 homePage.e2e.test.ts\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Create a basic Jest config (",(0,r.jsx)(n.code,{children:"jest.e2e.config.ts"}),")"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import type { Config } from "@jest/types";\r\n\r\nconst config: Config.InitialOptions = {\r\n  preset: "ts-jest",\r\n  testEnvironment: "node", // Puppeteer runs in Node\r\n  testTimeout: 30000, // E2E tests can take longer\r\n  testMatch: ["<rootDir>/e2e/**/*.test.ts"],\r\n};\r\n\r\nexport default config;\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Do not use ",(0,r.jsx)(n.code,{children:"jest-environment-jsdom"})," for Puppeteer."]}),"\n",(0,r.jsx)(n.h3,{id:"writing-an-e2e-test",children:"Writing an E2E Test"}),"\n",(0,r.jsx)(n.p,{children:"Testing a Next.js homepage with a button that redirects."}),"\n",(0,r.jsxs)(n.p,{children:["File: ",(0,r.jsx)(n.code,{children:"e2e/homePage.e2e.test.ts"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import puppeteer, { Browser, Page } from "puppeteer";\r\n\r\nlet browser: Browser;\r\nlet page: Page;\r\n\r\nbeforeAll(async () => {\r\n  // Launch a real Chromium browser\r\n  browser = await puppeteer.launch({\r\n    headless: true, // set false if you want to see the browser\r\n    args: ["--no-sandbox", "--disable-setuid-sandbox"],\r\n  });\r\n  page = await browser.newPage();\r\n});\r\n\r\nafterAll(async () => {\r\n  if (browser) await browser.close();\r\n});\r\n\r\ndescribe("Home Page E2E Tests", () => {\r\n  it("should load the homepage and display the title", async () => {\r\n    await page.goto("http://localhost:3000"); // Make sure your Next.js app is running\r\n    await page.waitForSelector("h1");\r\n\r\n    const title = await page.$eval("h1", (el) => el.textContent);\r\n    expect(title).toBe("Welcome to My Next.js App");\r\n  });\r\n\r\n  it("should navigate to About page when button is clicked", async () => {\r\n    await page.goto("http://localhost:3000");\r\n\r\n    await page.click(\'a[href="/about"]\'); // App Router uses <Link>\r\n    await page.waitForNavigation(); // Wait for navigation\r\n\r\n    const url = page.url();\r\n    expect(url).toBe("http://localhost:3000/about");\r\n\r\n    const heading = await page.$eval("h1", (el) => el.textContent);\r\n    expect(heading).toBe("About Us");\r\n  }, 10000);\r\n});\n'})}),"\n",(0,r.jsxs)(n.p,{children:["File: ",(0,r.jsx)(n.code,{children:"/src/app/home.tsx"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import Link from "next/link";\r\nimport React from "react";\r\n\r\nconst HomePage: React.FC = () => {\r\n  return (\r\n    <main style={{ padding: "2rem", fontFamily: "sans-serif" }}>\r\n      <h1>Welcome to My Next.js App</h1>\r\n      <p>This is the homepage using the App Router.</p>\r\n\r\n      <Link href="/about">\r\n        <button\r\n          style={{\r\n            marginTop: "1rem",\r\n            padding: "0.5rem 1rem",\r\n            cursor: "pointer",\r\n          }}\r\n        >\r\n          Go to About Page\r\n        </button>\r\n      </Link>\r\n    </main>\r\n  );\r\n};\r\n\r\nexport default HomePage;\n'})}),"\n",(0,r.jsxs)(n.p,{children:["File: ",(0,r.jsx)(n.code,{children:"/src/app/about.tsx"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import Link from "next/link";\r\nimport React from "react";\r\n\r\nconst AboutPage: React.FC = () => {\r\n  return (\r\n    <main style={{ padding: "2rem", fontFamily: "sans-serif" }}>\r\n      <h1>About Us</h1>\r\n      <p>This is the About page of your app.</p>\r\n\r\n      <Link href="/">\r\n        <button\r\n          style={{\r\n            marginTop: "1rem",\r\n            padding: "0.5rem 1rem",\r\n            cursor: "pointer",\r\n          }}\r\n        >\r\n          Back to Home\r\n        </button>\r\n      </Link>\r\n    </main>\r\n  );\r\n};\r\n\r\nexport default AboutPage;\n'})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"puppeteer.launch"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Starts a new Chromium instance."}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"headless: true"})," runs the browser without a UI."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"args: ['--no-sandbox']"})," needed sometimes for CI environments."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"page.goto(url)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Opens a page in the browser."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"page.waitForSelector('h1')"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Waits until the element appears in the DOM, ensuring the page is fully loaded."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"page.$eval(selector, callback)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Extracts data from a DOM element."}),"\n",(0,r.jsxs)(n.li,{children:["Here, we get the text content of ",(0,r.jsx)(n.code,{children:"<h1>"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"page.click(selector)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Simulates a user click."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"page.waitForNavigation()"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Waits until navigation is complete (useful for links and form submissions)."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"expect()"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Jest assertion to verify the test results."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"npm-configuration",children:"NPM Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\r\n  "scripts": {\r\n    "test:e2e": "jest --config jest.e2e.config.ts --watch"\r\n  }\r\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"running-e2e-tests",children:"Running E2E Tests"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Start your Next.js app:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm run dev\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"Run Jest with your E2E test:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm run test:e2e\n"})}),"\n",(0,r.jsx)(n.p,{children:"You should see the test opening a headless browser, navigating pages, and checking your elements."}),"\n",(0,r.jsx)(n.h2,{id:"api-routes-testing",children:"API routes Testing"}),"\n",(0,r.jsxs)(n.p,{children:["Next.js allows you to write API routes inside the ",(0,r.jsx)(n.code,{children:"pages/api"})," or ",(0,r.jsx)(n.code,{children:"app/api"})," folder, for server-side logic such as fetching data, handling forms, or performing authentication."]}),"\n",(0,r.jsx)(n.p,{children:"Testing these routes is essential to ensure:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Correct HTTP responses (status codes, body content)"}),"\n",(0,r.jsx)(n.li,{children:"Proper handling of errors"}),"\n",(0,r.jsx)(n.li,{children:"Integration with databases or external APIs"}),"\n",(0,r.jsx)(n.li,{children:"Server-side logic correctness (functions, validations, etc.)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Unlike React components, API routes are pure Node.js functions, so we can test them as unit tests or integration tests using Jest and supertest."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Setting Up for API Testing"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Install dependencies"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install --save-dev jest supertest\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"jest"})," \u2192 test runner"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"supertest"})," \u2192 helps test HTTP endpoints programmatically"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Setup Jest: Make sure ",(0,r.jsx)(n.code,{children:"jest.config.ts"})," is ready (as in unit testing setup)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"testing-a-simple-api-route",children:"Testing a Simple API Route"}),"\n",(0,r.jsxs)(n.p,{children:["Suppose we have an API route: ",(0,r.jsx)(n.code,{children:"app/api/hello/route.ts"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import { NextRequest, NextResponse } from "next/server";\r\n\r\nexport async function GET(req: NextRequest) {\r\n  return NextResponse.json({ message: "Hello World" });\r\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Test: ",(0,r.jsx)(n.code,{children:"__tests__/api/hello.test.js"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import { GET } from "@/app/api/hello/route";\r\nimport { NextRequest } from "next/server";\r\n\r\ndescribe("/api/hello App Router API Endpoint", () => {\r\n  test("returns 200 and a message on GET", async () => {\r\n    const request = new NextRequest("http://localhost/api/hello"); // must use NextRequest\r\n    const response = await GET(request);\r\n\r\n    expect(response.status).toBe(200);\r\n    const data = await response.json();\r\n    expect(data).toEqual({ message: "Hello World" });\r\n  });\r\n\r\n  test("response has JSON content-type header", async () => {\r\n    const request = new NextRequest("http://localhost/api/hello");\r\n    const response = await GET(request);\r\n\r\n    expect(response.headers.get("content-type")).toMatch(/application\\/json/);\r\n  });\r\n\r\n  test("response body has a \'message\' key of type string", async () => {\r\n    const request = new NextRequest("http://localhost/api/hello");\r\n    const response = await GET(request);\r\n\r\n    const data = await response.json();\r\n    expect(data).toHaveProperty("message");\r\n    expect(typeof data.message).toBe("string");\r\n  });\r\n});\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"node-mocks-http"})," or similar libraries allow us to mock ",(0,r.jsx)(n.code,{children:"req"})," and ",(0,r.jsx)(n.code,{children:"res"})," objects."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"_getStatusCode()"})," returns the response status."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"_getJSONData()"})," parses JSON response body."]}),"\n",(0,r.jsx)(n.li,{children:"This test doesn\u2019t need a running server, making it fast and isolated."}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"testing-api-routes-with-supertest",children:["Testing API Routes with ",(0,r.jsx)(n.code,{children:"supertest"})]}),"\n",(0,r.jsx)(n.p,{children:"If you want to test the API with a running server:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Install ",(0,r.jsx)(n.code,{children:"supertest"})," if not already:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install --save-dev supertest\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Suppose you have a Next.js custom server (using Express) or use ",(0,r.jsx)(n.code,{children:"next-connect"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'// server.ts\r\nimport express from "express";\r\nimport { GET } from "./app/api/hello/route";\r\n\r\nconst server = express();\r\n\r\n// Wrap App Router GET handler to work with Express\r\nserver.get("/api/hello", async (req, res) => {\r\n  try {\r\n    // Convert Express req to a minimal NextRequest-like object\r\n    const nextReq = new Request(`http://localhost${req.url}`, {\r\n      method: req.method,\r\n      headers: req.headers as any,\r\n    });\r\n\r\n    const response = await GET(nextReq as any); // cast for simplicity\r\n    const data = await response.json();\r\n\r\n    res.status(response.status).json(data);\r\n  } catch (err) {\r\n    res.status(500).json({ error: "Internal Server Error" });\r\n  }\r\n});\r\n\r\nexport default server;\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Test: ",(0,r.jsx)(n.code,{children:"__tests__/api/hello.supertest.test.js"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import request from "supertest";\r\nimport server from "../server"; // path to server.ts\r\n\r\ndescribe("GET /api/hello", () => {\r\n  it("returns 200 and a JSON message", async () => {\r\n    const res = await request(server).get("/api/hello");\r\n\r\n    expect(res.status).toBe(200);\r\n    expect(res.body).toEqual({ message: "Hello World" });\r\n  });\r\n\r\n  it("response has JSON content-type header", async () => {\r\n    const res = await request(server).get("/api/hello");\r\n    expect(res.headers["content-type"]).toMatch(/application\\/json/);\r\n  });\r\n\r\n  it("response body has a \'message\' key of type string", async () => {\r\n    const res = await request(server).get("/api/hello");\r\n    expect(res.body).toHaveProperty("message");\r\n    expect(typeof res.body.message).toBe("string");\r\n  });\r\n});\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"supertest"})," sends real HTTP requests to your server."]}),"\n",(0,r.jsx)(n.li,{children:"Useful for integration testing, e.g., when testing middleware, authentication, or database interaction."}),"\n",(0,r.jsx)(n.li,{children:"The test mimics a real user request."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"best-practices-for-api-testing",children:"Best Practices for API Testing"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Separate logic from the handler","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Move core business logic to plain functions and call them in API routes."}),"\n",(0,r.jsx)(n.li,{children:"Makes unit testing easier."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Use mocks for external services","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Databases, APIs, authentication can be mocked to isolate tests."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Test status codes and payloads","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Ensure correct HTTP status for all possible methods and errors."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Unit test first, E2E later","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Unit tests catch most logic errors quickly."}),"\n",(0,r.jsx)(n.li,{children:"E2E tests can verify full API flow."}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);