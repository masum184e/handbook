"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[19898],{28453(e,s,n){n.d(s,{R:()=>t,x:()=>l});var i=n(96540);const r={},d=i.createContext(r);function t(e){const s=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(d.Provider,{value:s},e.children)}},47484(e,s,n){n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>o,frontMatter:()=>t,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"nginx/IP Based Virtual Hosting","title":"IP Based Virtual Hosting","description":"IP-based virtual hosting means hosting multiple websites on the same server, where each website has its own IP address.","source":"@site/docs/nginx/23. IP Based Virtual Hosting.md","sourceDirName":"nginx","slug":"/nginx/IP Based Virtual Hosting","permalink":"/handbook/docs/nginx/IP Based Virtual Hosting","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":23,"frontMatter":{},"sidebar":"nginxApiSidebar","previous":{"title":"Name Based Virtual Hosting","permalink":"/handbook/docs/nginx/Name Based Virtual Hosting"},"next":{"title":"Default Server","permalink":"/handbook/docs/nginx/Default Server"}}');var r=n(74848),d=n(28453);const t={},l=void 0,c={},h=[{value:"How IP-Based Virtual Hosting Works",id:"how-ip-based-virtual-hosting-works",level:2},{value:"Request flow",id:"request-flow",level:3},{value:"Key Directives Used",id:"key-directives-used",level:3},{value:"Basic Example: Two Websites, Two IPs",id:"basic-example-two-websites-two-ips",level:3},{value:"IP-Based Virtual Hosting with HTTPS",id:"ip-based-virtual-hosting-with-https",level:2},{value:"Combining IP-Based and Name-Based Hosting",id:"combining-ip-based-and-name-based-hosting",level:2},{value:"Default Server in IP-Based Hosting",id:"default-server-in-ip-based-hosting",level:2},{value:"Advantages of IP-Based Virtual Hosting",id:"advantages-of-ip-based-virtual-hosting",level:2},{value:"Disadvantages",id:"disadvantages",level:2},{value:"When to Use IP-Based Virtual Hosting",id:"when-to-use-ip-based-virtual-hosting",level:2},{value:"Name-Based vs IP-Based",id:"name-based-vs-ip-based",level:2}];function a(e){const s={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.p,{children:"IP-based virtual hosting means hosting multiple websites on the same server, where each website has its own IP address."}),"\n",(0,r.jsxs)(s.p,{children:["NGINX decides which site to serve based on the destination IP address of the request, not the domain name (",(0,r.jsx)(s.code,{children:"Host"})," header)."]}),"\n",(0,r.jsx)(s.p,{children:"One IP = One website (or one main virtual host)"}),"\n",(0,r.jsx)(s.h2,{id:"how-ip-based-virtual-hosting-works",children:"How IP-Based Virtual Hosting Works"}),"\n",(0,r.jsx)(s.h3,{id:"request-flow",children:"Request flow"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["User types: ",(0,r.jsx)(s.code,{children:"http://example.com"})]}),"\n",(0,r.jsxs)(s.li,{children:["DNS resolution: ",(0,r.jsx)(s.code,{children:"example.com \u2192 192.0.2.10"})]}),"\n",(0,r.jsxs)(s.li,{children:["Browser connects to: ",(0,r.jsx)(s.code,{children:"192.0.2.10:80"})]}),"\n",(0,r.jsxs)(s.li,{children:["NGINX:","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Checks which server block is listening on 192.0.2.10"}),"\n",(0,r.jsx)(s.li,{children:"Serves the matching virtual host"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Another site might use:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"shop.com \u2192 192.0.2.20\n"})}),"\n",(0,r.jsx)(s.p,{children:"Same server, different IP, different site."}),"\n",(0,r.jsx)(s.h3,{id:"key-directives-used",children:"Key Directives Used"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Directive"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"server {}"})}),(0,r.jsx)(s.td,{children:"Defines a virtual host"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"listen IP:PORT"})}),(0,r.jsx)(s.td,{children:"Binds server block to a specific IP"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"server_name"})}),(0,r.jsx)(s.td,{children:"Optional (not required for routing)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"root"})}),(0,r.jsx)(s.td,{children:"Website document root"})]})]})]}),"\n",(0,r.jsx)(s.p,{children:"In IP-based hosting, listen is the key directive, not server_name."}),"\n",(0,r.jsx)(s.h3,{id:"basic-example-two-websites-two-ips",children:"Basic Example: Two Websites, Two IPs"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Website"}),(0,r.jsx)(s.th,{children:"IP Address"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"example.com"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"192.0.2.10"})})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"shop.com"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"192.0.2.20"})})]})]})]}),"\n",(0,r.jsx)(s.p,{children:"Both sites run on the same NGINX server, but each has its own IP."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"http {\r\n\r\n    server {\r\n        listen 192.0.2.10:80;\r\n\r\n        root /var/www/example;\r\n        index index.html;\r\n\r\n        location / {\r\n            try_files $uri $uri/ =404;\r\n        }\r\n    }\r\n\r\n    server {\r\n        listen 192.0.2.20:80;\r\n\r\n        root /var/www/shop;\r\n        index index.html;\r\n\r\n        location / {\r\n            try_files $uri $uri/ =404;\r\n        }\r\n    }\r\n}\n"})}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.code,{children:"listen IP:PORT"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"listen 192.0.2.10:80;\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"NGINX listens only on this IP"}),"\n",(0,r.jsx)(s.li,{children:"Requests to any other IP will not match this server block"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"listen 192.0.2.20:80;\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Separate IP \u2192 separate virtual host"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"server_name"})," (Optional)\r\nIn IP-based hosting, ",(0,r.jsx)(s.code,{children:"server_name"})," is not required:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"server_name example.com;\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Can still be added for:","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Logging clarity"}),"\n",(0,r.jsx)(s.li,{children:"HTTPS SNI"}),"\n",(0,r.jsx)(s.li,{children:"Readability"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.li,{children:"But routing is done by IP"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Request Routing"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Request"}),(0,r.jsx)(s.th,{children:"IP Used"}),(0,r.jsx)(s.th,{children:"Served From"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"http://example.com"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"192.0.2.10"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"/var/www/example"})})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"http://shop.com"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"192.0.2.20"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"/var/www/shop"})})]})]})]}),"\n",(0,r.jsx)(s.p,{children:"Even if both domains are typed, IP determines the site."}),"\n",(0,r.jsx)(s.h2,{id:"ip-based-virtual-hosting-with-https",children:"IP-Based Virtual Hosting with HTTPS"}),"\n",(0,r.jsx)(s.p,{children:"Before SNI, SSL required one IP per certificate, making IP-based hosting necessary."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"server {\r\nlisten 192.0.2.10:443 ssl;\r\n\r\n    ssl_certificate /etc/ssl/example.crt;\r\n    ssl_certificate_key /etc/ssl/example.key;\r\n\r\n    root /var/www/example;\r\n\r\n}\n"})}),"\n",(0,r.jsx)(s.p,{children:"Each site:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Has its own IP"}),"\n",(0,r.jsx)(s.li,{children:"Has its own SSL certificate"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"combining-ip-based-and-name-based-hosting",children:"Combining IP-Based and Name-Based Hosting"}),"\n",(0,r.jsx)(s.p,{children:"You can mix both approaches."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"server {\r\nlisten 192.0.2.10:80;\r\nserver_name example.com www.example.com;\r\n\r\n    root /var/www/example;\r\n\r\n}\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"IP chooses the server"}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"server_name"})," refines domain handling"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"default-server-in-ip-based-hosting",children:"Default Server in IP-Based Hosting"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"server {\r\nlisten 192.0.2.10:80 default_server;\r\nreturn 444;\r\n}\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Handles unmatched requests on that IP"}),"\n",(0,r.jsx)(s.li,{children:"Improves security and clarity"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"advantages-of-ip-based-virtual-hosting",children:"Advantages of IP-Based Virtual Hosting"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Complete isolation between sites"}),"\n",(0,r.jsx)(s.li,{children:"Required for legacy SSL clients"}),"\n",(0,r.jsx)(s.li,{children:"Easier firewall and access control"}),"\n",(0,r.jsx)(s.li,{children:"Useful for compliance and security"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"disadvantages",children:"Disadvantages"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Requires multiple IP addresses"}),"\n",(0,r.jsx)(s.li,{children:"Higher cost in cloud environments"}),"\n",(0,r.jsx)(s.li,{children:"Less scalable than name-based hosting"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"when-to-use-ip-based-virtual-hosting",children:"When to Use IP-Based Virtual Hosting"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Use Case"}),(0,r.jsx)(s.th,{children:"Recommendation"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Legacy SSL support"}),(0,r.jsx)(s.td,{children:"\u2705 IP-based"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Strong isolation/security"}),(0,r.jsx)(s.td,{children:"\u2705 IP-based"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Shared hosting"}),(0,r.jsx)(s.td,{children:"\u274c Avoid"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Cloud servers"}),(0,r.jsx)(s.td,{children:"\u26a0\ufe0f Use only if needed"})]})]})]}),"\n",(0,r.jsx)(s.h2,{id:"name-based-vs-ip-based",children:"Name-Based vs IP-Based"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Use Case"}),(0,r.jsx)(s.th,{children:"Recommendation"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Legacy SSL support"}),(0,r.jsx)(s.td,{children:"\u2705 IP-based"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Strong isolation/security"}),(0,r.jsx)(s.td,{children:"\u2705 IP-based"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Shared hosting"}),(0,r.jsx)(s.td,{children:"\u274c Avoid"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Cloud servers"}),(0,r.jsx)(s.td,{children:"\u26a0\ufe0f Use only if needed"})]})]})]})]})}function o(e={}){const{wrapper:s}={...(0,d.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);