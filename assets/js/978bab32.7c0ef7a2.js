"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[98055],{28453(e,n,s){s.d(n,{R:()=>d,x:()=>t});var r=s(96540);const i={},l=r.createContext(i);function d(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(l.Provider,{value:n},e.children)}},31781(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"nginx/Name Based Virtual Hosting","title":"Name Based Virtual Hosting","description":"Name-based virtual hosting allows multiple websites (domains) to be hosted on a single IP address.","source":"@site/docs/nginx/22. Name Based Virtual Hosting.md","sourceDirName":"nginx","slug":"/nginx/Name Based Virtual Hosting","permalink":"/handbook/docs/nginx/Name Based Virtual Hosting","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":22,"frontMatter":{},"sidebar":"nginxApiSidebar","previous":{"title":"Monitoring Tools","permalink":"/handbook/docs/nginx/Logging/Monitoring Tools"},"next":{"title":"IP Based Virtual Hosting","permalink":"/handbook/docs/nginx/IP Based Virtual Hosting"}}');var i=s(74848),l=s(28453);const d={},t=void 0,o={},c=[{value:"How Name-Based Virtual Hosting Works",id:"how-name-based-virtual-hosting-works",level:2},{value:"Step-by-step request flow",id:"step-by-step-request-flow",level:3},{value:"Key Directives Used",id:"key-directives-used",level:3},{value:"Basic Example: Two Domains, One IP",id:"basic-example-two-domains-one-ip",level:3},{value:"Default Server in Name-Based Hosting",id:"default-server-in-name-based-hosting",level:2},{value:"Default server example",id:"default-server-example",level:3},{value:"Using Wildcards in <code>server_name</code>",id:"using-wildcards-in-server_name",level:3},{value:"Using Regex in <code>server_name</code>",id:"using-regex-in-server_name",level:3},{value:"Name-Based Virtual Hosting with HTTPS (SNI)",id:"name-based-virtual-hosting-with-https-sni",level:2},{value:"When to Use Name-Based vs IP-Based Hosting",id:"when-to-use-name-based-vs-ip-based-hosting",level:2}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Name-based virtual hosting allows multiple websites (domains) to be hosted on a single IP address.\r\nNGINX decides which website to serve based on the domain name requested by the client (the ",(0,i.jsx)(n.code,{children:"Host"})," header in the HTTP request)."]}),"\n",(0,i.jsx)(n.p,{children:"This is the most common hosting method today, especially when using shared servers or cloud VMs."}),"\n",(0,i.jsx)(n.h2,{id:"how-name-based-virtual-hosting-works",children:"How Name-Based Virtual Hosting Works"}),"\n",(0,i.jsx)(n.h3,{id:"step-by-step-request-flow",children:"Step-by-step request flow"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["A user types a URL: ",(0,i.jsx)(n.a,{href:"http://example.com",children:"http://example.com"})]}),"\n",(0,i.jsxs)(n.li,{children:["DNS resolves example.com \u2192 same server IP: ",(0,i.jsx)(n.code,{children:"example.com \u2192 203.0.113.10"})]}),"\n",(0,i.jsxs)(n.li,{children:["The browser sends an HTTP request including: ",(0,i.jsx)(n.code,{children:"Host: example.com"})]}),"\n",(0,i.jsxs)(n.li,{children:["NGINX:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Reads the ",(0,i.jsx)(n.code,{children:"Host"})," header"]}),"\n",(0,i.jsxs)(n.li,{children:["Matches it against the ",(0,i.jsx)(n.code,{children:"server_name"})," directive"]}),"\n",(0,i.jsxs)(n.li,{children:["Selects the correct ",(0,i.jsx)(n.code,{children:"server"})," block"]}),"\n",(0,i.jsx)(n.li,{children:"Serves the corresponding website"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"key-directives-used",children:"Key Directives Used"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Directive"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"server {}"})}),(0,i.jsx)(n.td,{children:"Defines a virtual host"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"listen"})}),(0,i.jsx)(n.td,{children:"IP and port to listen on"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"server_name"})}),(0,i.jsx)(n.td,{children:"Domain(s) this server block responds to"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"root"})}),(0,i.jsx)(n.td,{children:"Document root for the website"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"index"})}),(0,i.jsx)(n.td,{children:"Default index file"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"basic-example-two-domains-one-ip",children:"Basic Example: Two Domains, One IP"}),"\n",(0,i.jsx)(n.p,{children:"Scenario"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Domain"}),(0,i.jsx)(n.th,{children:"Website"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"example.com"})}),(0,i.jsx)(n.td,{children:"Company website"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"blog.example.com"})}),(0,i.jsx)(n.td,{children:"Blog"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"Both are hosted on one server IP."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"http {\r\n\r\n    server {\r\n        listen 80;\r\n        server_name example.com www.example.com;\r\n\r\n        root /var/www/example;\r\n        index index.html;\r\n\r\n        location / {\r\n            try_files $uri $uri/ =404;\r\n        }\r\n    }\r\n\r\n    server {\r\n        listen 80;\r\n        server_name blog.example.com;\r\n\r\n        root /var/www/blog;\r\n        index index.html;\r\n\r\n        location / {\r\n            try_files $uri $uri/ =404;\r\n        }\r\n    }\r\n}\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"listen 80;"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Both sites listen on port 80"}),"\n",(0,i.jsx)(n.li,{children:"Same IP, same port \u2192 name-based hosting"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"server_name example.com www.example.com;"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Matches requests where:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Host: example.com\r\nHost: www.example.com\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["You can list multiple domain aliases: ",(0,i.jsx)(n.code,{children:"server_name blog.example.com;"})]}),"\n",(0,i.jsx)(n.li,{children:"Matches only the blog subdomain"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"root /var/www/example;"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Files served from: ",(0,i.jsx)(n.code,{children:"/var/www/example/index.html"})]}),"\n",(0,i.jsx)(n.li,{children:"Each server block has its own document root."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Request Matching Behavior\r\n| Request                   | Served From        |\r\n| ------------------------- | ------------------ |\r\n| ",(0,i.jsx)(n.code,{children:"http://example.com"}),"      | ",(0,i.jsx)(n.code,{children:"/var/www/example"})," |\r\n| ",(0,i.jsx)(n.code,{children:"http://www.example.com"}),"  | ",(0,i.jsx)(n.code,{children:"/var/www/example"})," |\r\n| ",(0,i.jsx)(n.code,{children:"http://blog.example.com"})," | ",(0,i.jsx)(n.code,{children:"/var/www/blog"}),"    |"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"All requests go to the same IP, but different server blocks."}),"\n",(0,i.jsx)(n.h2,{id:"default-server-in-name-based-hosting",children:"Default Server in Name-Based Hosting"}),"\n",(0,i.jsxs)(n.p,{children:["If no ",(0,i.jsx)(n.code,{children:"server_name"})," matches, NGINX serves the default server."]}),"\n",(0,i.jsx)(n.h3,{id:"default-server-example",children:"Default server example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"server {\r\n    listen 80 default_server;\r\n    server_name _;\r\n\r\n    return 444;\r\n}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Prevents unknown domains from being served"}),"\n",(0,i.jsx)(n.li,{children:"Improves security"}),"\n",(0,i.jsx)(n.li,{children:"Common in production setups"}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"using-wildcards-in-server_name",children:["Using Wildcards in ",(0,i.jsx)(n.code,{children:"server_name"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"server {\r\n    listen 80;\r\n    server_name *.example.com;\r\n\r\n    root /var/www/subdomains;\r\n}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Matches: ",(0,i.jsx)(n.code,{children:"blog.example.com"}),", ",(0,i.jsx)(n.code,{children:"shop.example.com"})]}),"\n",(0,i.jsxs)(n.li,{children:["Does NOT match: ",(0,i.jsx)(n.code,{children:"example.com"})]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"using-regex-in-server_name",children:["Using Regex in ",(0,i.jsx)(n.code,{children:"server_name"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"server {\r\n    listen 80;\r\n    server_name ~^www\\d+\\.example\\.com$;\r\n\r\n    root /var/www/regex;\r\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Matches: ",(0,i.jsx)(n.code,{children:"www1.example.com"}),", ",(0,i.jsx)(n.code,{children:"www2.example.com"})]}),"\n",(0,i.jsx)(n.h2,{id:"name-based-virtual-hosting-with-https-sni",children:"Name-Based Virtual Hosting with HTTPS (SNI)"}),"\n",(0,i.jsx)(n.p,{children:"Modern browsers support SNI (Server Name Indication), allowing name-based hosting with SSL."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"server {\r\n    listen 443 ssl;\r\n    server_name example.com;\r\n\r\n    ssl_certificate /etc/ssl/example.crt;\r\n    ssl_certificate_key /etc/ssl/example.key;\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Each domain can have its own certificate, even on the same IP."}),"\n",(0,i.jsx)(n.h2,{id:"when-to-use-name-based-vs-ip-based-hosting",children:"When to Use Name-Based vs IP-Based Hosting"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"When to Use"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Name-based"}),(0,i.jsx)(n.td,{children:"Most websites, shared servers"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"IP-based"}),(0,i.jsx)(n.td,{children:"Legacy SSL, strict isolation needs"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);