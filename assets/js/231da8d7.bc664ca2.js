"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[88273],{28453(e,n,i){i.d(n,{R:()=>a,x:()=>t});var l=i(96540);const s={},r=l.createContext(s);function a(e){const n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),l.createElement(r.Provider,{value:n},e.children)}},92443(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"mysql/Replication","title":"Replication","description":"Replication in MySQL is the process of copying data from one database server (the master / primary) to one or more other servers (slaves / replicas).","source":"@site/docs/mysql/22. Replication.md","sourceDirName":"mysql","slug":"/mysql/Replication","permalink":"/handbook/docs/mysql/Replication","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":23,"frontMatter":{"sidebar_position":23},"sidebar":"mysqlSidebar","previous":{"title":"JSON","permalink":"/handbook/docs/mysql/Advance Features/JSON"},"next":{"title":"Partitioning","permalink":"/handbook/docs/mysql/Large Datasets/Partitioning"}}');var s=i(74848),r=i(28453);const a={sidebar_position:23},t=void 0,o={},c=[{value:"How MySQL Replication Works",id:"how-mysql-replication-works",level:2},{value:"Master-Slave Replication",id:"master-slave-replication",level:2},{value:"Setting Up Master-Slave Replication",id:"setting-up-master-slave-replication",level:3},{value:"Initial Setup",id:"initial-setup",level:4},{value:"Step 1: On the Master",id:"step-1-on-the-master",level:4},{value:"Step 2: On the Slave",id:"step-2-on-the-slave",level:4},{value:"Step 3: Test",id:"step-3-test",level:4},{value:"Multi-Source Replication",id:"multi-source-replication",level:2},{value:"Setting Up Multi-Source Replication",id:"setting-up-multi-source-replication",level:3},{value:"Step 1: Configure Master1 and Master2",id:"step-1-configure-master1-and-master2",level:4},{value:"Step 2: Configure Slave",id:"step-2-configure-slave",level:4},{value:"Step 3: Connect Slave to Master1 and Master2",id:"step-3-connect-slave-to-master1-and-master2",level:4},{value:"Replication in the Cloud",id:"replication-in-the-cloud",level:2},{value:"Load Balancing",id:"load-balancing",level:2},{value:"Load Balancing Reads",id:"load-balancing-reads",level:3},{value:"High Availability",id:"high-availability",level:2},{value:"High Availability Approaches in MySQL",id:"high-availability-approaches-in-mysql",level:3},{value:"High Availability with Replication",id:"high-availability-with-replication",level:3}];function d(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Replication in MySQL is the process of copying data from one database server (the master / primary) to one or more other servers (slaves / replicas)."}),"\n",(0,s.jsx)(n.p,{children:"The goal is to keep the replica servers synchronized with the master."}),"\n",(0,s.jsx)(n.p,{children:"Limitations of Replication"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Replication Lag \u2192 Slaves may not be up-to-date."}),"\n",(0,s.jsx)(n.li,{children:"Writes still go to master \u2192 not good for heavy write workloads."}),"\n",(0,s.jsx)(n.li,{children:"Conflict risk in multi-source replication \u2192 if both masters write to the same table."}),"\n",(0,s.jsx)(n.li,{children:"Not a full backup \u2192 accidental deletes on master replicate to slaves."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"how-mysql-replication-works",children:"How MySQL Replication Works"}),"\n",(0,s.jsx)(n.p,{children:"Replication happens in 3 steps:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Master writes changes to binary log (binlog)."}),"\n",(0,s.jsx)(n.li,{children:"Replica reads master\u2019s binlog into its relay log."}),"\n",(0,s.jsx)(n.li,{children:"Replica SQL thread applies changes to its own database."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Replication is usually asynchronous (replicas might lag), but can also be semi-synchronous (master waits for at least one replica acknowledgment)."}),"\n",(0,s.jsx)(n.h2,{id:"master-slave-replication",children:"Master-Slave Replication"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"One master server handles all writes (INSERT/UPDATE/DELETE)."}),"\n",(0,s.jsx)(n.li,{children:"One or more slave servers handle reads (SELECT)."}),"\n",(0,s.jsx)(n.li,{children:"Slaves replicate data from the master continuously."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"setting-up-master-slave-replication",children:"Setting Up Master-Slave Replication"}),"\n",(0,s.jsx)(n.h4,{id:"initial-setup",children:"Initial Setup"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Create Docker Network"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker network create mysqlnet\n"})}),"\n",(0,s.jsx)(n.h4,{id:"step-1-on-the-master",children:"Step 1: On the Master"}),"\n",(0,s.jsxs)(n.p,{children:["Create a custom configuration file at ",(0,s.jsx)(n.code,{children:"T:\\project\\master.cnf"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"[mysqld]\r\nserver-id=1\r\nlog_bin=mysql-bin\r\nbinlog_format=ROW\n"})}),"\n",(0,s.jsx)(n.p,{children:"Run the Master Container"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run -d ^ --name mysql-master ^ --network mysqlnet ^ -e MYSQL_ROOT_PASSWORD=rootpass ^ -v T:\\project\\master.cnf:/etc/mysql/conf.d/master.cnf ^ -v master_data:/var/lib/mysql ^ -p 3308:3306 ^ mysql:latest\r\n\r\ndocker exec -it mysql-master bash\r\n\r\nmysql -uroot -p\n"})}),"\n",(0,s.jsx)(n.p,{children:"Verify Installation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mysql",children:"SHOW VARIABLES LIKE 'log_bin';\r\nSHOW VARIABLES LIKE 'server_id';\n"})}),"\n",(0,s.jsx)(n.p,{children:"Restart MySQL:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker restart mysql-master\n"})}),"\n",(0,s.jsx)(n.p,{children:"Create a replication user:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE USER 'replica'@'%' IDENTIFIED WITH mysql_native_password BY 'replicapass';\r\nGRANT REPLICATION SLAVE ON *.* TO 'replica'@'%';\r\nFLUSH PRIVILEGES;\n"})}),"\n",(0,s.jsx)(n.p,{children:"Check master status:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SHOW BINARY LOG STATUS;\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"+---------------+----------+--------------+------------------+-------------------+\r\n| File          | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |\r\n+---------------+----------+--------------+------------------+-------------------+\r\n| binlog.000004 |      863 |              |                  |                   |\r\n+---------------+----------+--------------+------------------+-------------------+\r\n1 row in set (0.006 sec)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Note these values; they\u2019ll be used on the slave."}),"\n",(0,s.jsx)(n.h4,{id:"step-2-on-the-slave",children:"Step 2: On the Slave"}),"\n",(0,s.jsx)(n.p,{children:"Run the Slave Container"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run -d --name mysql-slave --network mysqlnet -e MYSQL_ROOT_PASSWORD=rootpass -v slave_data:/var/lib/mysql -p 3309:3306 mysql:latest --server-id=2 --relay-log=relay-bin --log-bin=mysql-bin --read-only=1\r\n\r\ndocker exec -it mysql-slave bash\r\n\r\nmysql -uroot -p\n"})}),"\n",(0,s.jsx)(n.p,{children:"Verify Installation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mysql",children:"SHOW VARIABLES LIKE 'log_bin';\r\nSHOW VARIABLES LIKE 'server_id';\n"})}),"\n",(0,s.jsx)(n.p,{children:"Connect slave to master:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"RESET REPLICA ALL;\r\nCHANGE REPLICATION SOURCE TO\r\n  SOURCE_HOST='mysql-master',\r\n  SOURCE_USER='replica',\r\n  SOURCE_PASSWORD='replicapass',\r\n  SOURCE_LOG_FILE='binlog.000005',\r\n  SOURCE_LOG_POS=548,\r\n  GET_SOURCE_PUBLIC_KEY=1;\r\n\r\nSTART REPLICA;\n"})}),"\n",(0,s.jsx)(n.p,{children:"Check status:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SHOW REPLICA STATUS\\G\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If both ",(0,s.jsx)(n.code,{children:"Replica_IO_Running"})," and ",(0,s.jsx)(n.code,{children:"Replica_SQL_Running"})," are Yes, replication is successful."]}),"\n",(0,s.jsx)(n.h4,{id:"step-3-test",children:"Step 3: Test"}),"\n",(0,s.jsx)(n.p,{children:"On master:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"INSERT INTO employees (name, department, salary) VALUES ('Alice', 'IT', 70000);\n"})}),"\n",(0,s.jsx)(n.p,{children:"On slave:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM employees WHERE name = 'Alice';\n"})}),"\n",(0,s.jsx)(n.p,{children:"You\u2019ll see the row replicated."}),"\n",(0,s.jsx)(n.h2,{id:"multi-source-replication",children:"Multi-Source Replication"}),"\n",(0,s.jsx)(n.p,{children:"Multi-source replication allows one slave to replicate data from multiple masters."}),"\n",(0,s.jsx)(n.p,{children:"Useful for merging data from different databases into a central server."}),"\n",(0,s.jsx)(n.h3,{id:"setting-up-multi-source-replication",children:"Setting Up Multi-Source Replication"}),"\n",(0,s.jsx)(n.p,{children:"Suppose we have:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Master1 = HR database"}),"\n",(0,s.jsx)(n.li,{children:"Master2 = Sales database"}),"\n",(0,s.jsx)(n.li,{children:"Slave = Central analytics server"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"step-1-configure-master1-and-master2",children:"Step 1: Configure Master1 and Master2"}),"\n",(0,s.jsx)(n.p,{children:"Enable binary logs on both:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",children:"[mysqld]\r\nserver-id=1   # On Master1\r\nlog_bin=mysql-bin\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",children:"[mysqld]\r\nserver-id=2   # On Master2\r\nlog_bin=mysql-bin\n"})}),"\n",(0,s.jsx)(n.p,{children:"Create replication users on both masters."}),"\n",(0,s.jsx)(n.h4,{id:"step-2-configure-slave",children:"Step 2: Configure Slave"}),"\n",(0,s.jsxs)(n.p,{children:["Enable multi-source replication in ",(0,s.jsx)(n.code,{children:"my.cnf"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ini",children:"[mysqld]\r\nserver-id=3\n"})}),"\n",(0,s.jsx)(n.h4,{id:"step-3-connect-slave-to-master1-and-master2",children:"Step 3: Connect Slave to Master1 and Master2"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- For Master1\r\nCHANGE MASTER TO\r\n  MASTER_HOST='master1_ip',\r\n  MASTER_USER='replica',\r\n  MASTER_PASSWORD='password',\r\n  MASTER_LOG_FILE='mysql-bin.000001',\r\n  MASTER_LOG_POS=154\r\nFOR CHANNEL 'master1';\r\n\r\nSTART SLAVE FOR CHANNEL 'master1';\r\n\r\n-- For Master2\r\nCHANGE MASTER TO\r\n  MASTER_HOST='master2_ip',\r\n  MASTER_USER='replica',\r\n  MASTER_PASSWORD='password',\r\n  MASTER_LOG_FILE='mysql-bin.000001',\r\n  MASTER_LOG_POS=200\r\nFOR CHANNEL 'master2';\r\n\r\nSTART SLAVE FOR CHANNEL 'master2';\n"})}),"\n",(0,s.jsx)(n.p,{children:"Check replication channels:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SHOW SLAVE STATUS FOR CHANNEL 'master1'\\G\r\nSHOW SLAVE STATUS FOR CHANNEL 'master2'\\G\n"})}),"\n",(0,s.jsx)(n.h2,{id:"replication-in-the-cloud",children:"Replication in the Cloud"}),"\n",(0,s.jsx)(n.p,{children:"Cloud providers (like AWS RDS, Google Cloud SQL, Azure Database for MySQL) provide managed replication:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"You don\u2019t need to manually configure binlogs."}),"\n",(0,s.jsx)(n.li,{children:"They offer read replicas for scaling reads."}),"\n",(0,s.jsx)(n.li,{children:"Failover and monitoring are automated."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example in AWS RDS:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Create a primary MySQL instance."}),"\n",(0,s.jsx)(n.li,{children:"Add a read replica via AWS console."}),"\n",(0,s.jsx)(n.li,{children:"AWS handles replication setup automatically"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"load-balancing",children:"Load Balancing"}),"\n",(0,s.jsx)(n.p,{children:"Load balancing means distributing client requests across multiple database servers to improve performance and scalability."}),"\n",(0,s.jsx)(n.p,{children:"In MySQL, this is usually done in replication setups:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Master (Primary) \u2192 handles writes (INSERT, UPDATE, DELETE)"}),"\n",(0,s.jsx)(n.li,{children:"Slaves (Replicas) \u2192 handle reads (SELECT)"}),"\n",(0,s.jsx)(n.li,{children:"A load balancer (proxy or middleware) distributes queries."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Benefits of Load Balancing"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Better performance (scale reads across replicas)."}),"\n",(0,s.jsx)(n.li,{children:"Prevents a single server from being overloaded."}),"\n",(0,s.jsx)(n.li,{children:"Enables horizontal scaling (add more replicas)."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"load-balancing-reads",children:"Load Balancing Reads"}),"\n",(0,s.jsx)(n.p,{children:"Suppose we have:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["1 Master: ",(0,s.jsx)(n.code,{children:"master-db"})," (for writes)."]}),"\n",(0,s.jsxs)(n.li,{children:["2 Slaves: ",(0,s.jsx)(n.code,{children:"slave1-db"}),", ",(0,s.jsx)(n.code,{children:"slave2-db"})," (for reads)."]}),"\n",(0,s.jsx)(n.li,{children:"Load Balancer: ProxySQL (or HAProxy, MySQL Router)."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Without Load Balancer:"})," Applications must manually connect to master for writes and slaves for reads."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Application connects directly to master for writes\r\nINSERT INTO employees (name, department, salary) VALUES ('Alice', 'HR', 60000);\r\n\r\n-- Application connects directly to a slave for reads\r\nSELECT * FROM employees WHERE department = 'HR';\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Problem:"})," Application must handle logic for routing queries."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"With Load Balancer"})}),"\n",(0,s.jsx)(n.p,{children:"Applications connect to ProxySQL/MySQL Router \u2192 it automatically sends writes to master and reads to slaves."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Application just connects to the proxy\r\nSELECT * FROM employees;   -- Proxy routes to slave1 or slave2\r\nINSERT INTO employees VALUES ('Bob', 'IT', 70000); -- Proxy routes to master\n"})}),"\n",(0,s.jsx)(n.p,{children:"Load balancer ensures read queries are spread across replicas, and write queries always go to master."}),"\n",(0,s.jsx)(n.h2,{id:"high-availability",children:"High Availability"}),"\n",(0,s.jsx)(n.p,{children:"High Availability means the database remains available even if a server crashes."}),"\n",(0,s.jsx)(n.p,{children:"This is achieved with:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Replication"})," \u2192 Having multiple copies of the database."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Automatic failover"})," \u2192 If the master fails, a slave is promoted to master."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Monitoring"})," \u2192 To detect failures and trigger failover."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"high-availability-approaches-in-mysql",children:"High Availability Approaches in MySQL"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Master-Slave with Failover","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"One master, multiple slaves."}),"\n",(0,s.jsx)(n.li,{children:"A monitoring tool (MHA, Orchestrator, or cloud service) promotes a slave if the master fails."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["MySQL Group Replication / InnoDB Cluster","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Multiple servers form a group."}),"\n",(0,s.jsx)(n.li,{children:"Supports multi-master writes."}),"\n",(0,s.jsx)(n.li,{children:"Provides built-in failover and HA."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Cloud Provider HA","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"AWS RDS / Aurora: Automated failover to replica."}),"\n",(0,s.jsx)(n.li,{children:"Google Cloud SQL: Multi-zone replication with automatic failover."}),"\n",(0,s.jsx)(n.li,{children:"Azure Database for MySQL: Geo-replication for HA."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"high-availability-with-replication",children:"High Availability with Replication"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Without HA"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Master fails \u2192 application cannot process writes until manually fixed."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"With HA (Orchestrator / MHA)"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Monitoring detects master failure."}),"\n",(0,s.jsxs)(n.li,{children:["A replica (",(0,s.jsx)(n.code,{children:"slave1-db"}),") is promoted to master."]}),"\n",(0,s.jsx)(n.li,{children:"Load balancer (ProxySQL/MySQL Router) automatically reroutes writes to new master."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Application continues to work with minimal downtime."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);