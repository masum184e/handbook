"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[67252],{28453(e,n,i){i.d(n,{R:()=>t,x:()=>l});var s=i(96540);const c={},r=s.createContext(c);function t(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:t(e.components),s.createElement(r.Provider,{value:n},e.children)}},53232(e,n,i){i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"nginx/Restricting Access","title":"Restricting Access","description":"Restricting access means controlling who can access your application, what they can access, and from where.","source":"@site/docs/nginx/20. Restricting Access.md","sourceDirName":"nginx","slug":"/nginx/Restricting Access","permalink":"/handbook/docs/nginx/Restricting Access","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":20,"frontMatter":{},"sidebar":"nginxApiSidebar","previous":{"title":"Connection Limiting","permalink":"/handbook/docs/nginx/Connection Limiting"},"next":{"title":"Basic Authentication","permalink":"/handbook/docs/nginx/Basic Authentication"}}');var c=i(74848),r=i(28453);const t={},l=void 0,d={},a=[{value:"Why Access Restriction Is Important (Security Perspective)",id:"why-access-restriction-is-important-security-perspective",level:2},{value:"IP-Based Access Control (<code>allow</code> / <code>deny</code>)",id:"ip-based-access-control-allow--deny",level:2},{value:"Basic IP Restriction",id:"basic-ip-restriction",level:3},{value:"Allow Specific IPs Only",id:"allow-specific-ips-only",level:3},{value:"Restricting Access by Country (GeoIP)",id:"restricting-access-by-country-geoip",level:3},{value:"Authentication-Based Access Control",id:"authentication-based-access-control",level:2},{value:"HTTP Basic Authentication",id:"http-basic-authentication",level:3},{value:"Create <code>.htpasswd</code>",id:"create-htpasswd",level:3},{value:"Restricting Access Using Request Methods",id:"restricting-access-using-request-methods",level:2},{value:"Restricting Access Using Headers (API Keys)",id:"restricting-access-using-headers-api-keys",level:2},{value:"Restricting Access by Time (Maintenance Window)",id:"restricting-access-by-time-maintenance-window",level:2},{value:"Restricting Access to Files &amp; Paths",id:"restricting-access-to-files--paths",level:2},{value:"Protect Sensitive Files",id:"protect-sensitive-files",level:3},{value:"Block Hidden Files",id:"block-hidden-files",level:3},{value:"Restricting Access Using Rate &amp; Connection Limits",id:"restricting-access-using-rate--connection-limits",level:2},{value:"Rate Limit Sensitive Paths",id:"rate-limit-sensitive-paths",level:3},{value:"Combining Multiple Restrictions (Best Practice)",id:"combining-multiple-restrictions-best-practice",level:2},{value:"Secure Admin Panel Example",id:"secure-admin-panel-example",level:3},{value:"Restrict Access Behind Load Balancers",id:"restrict-access-behind-load-balancers",level:2},{value:"Common Security Mistakes",id:"common-security-mistakes",level:2},{value:"Logging Restricted Access Attempts",id:"logging-restricted-access-attempts",level:2}];function o(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.p,{children:"Restricting access means controlling who can access your application, what they can access, and from where."}),"\n",(0,c.jsx)(n.p,{children:"In NGINX, access restrictions are typically enforced at the edge (before traffic reaches your application), which provides:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Strong security"}),"\n",(0,c.jsx)(n.li,{children:"Better performance"}),"\n",(0,c.jsx)(n.li,{children:"Reduced backend load"}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"why-access-restriction-is-important-security-perspective",children:"Why Access Restriction Is Important (Security Perspective)"}),"\n",(0,c.jsx)(n.p,{children:"Restricting access helps prevent:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Unauthorized access"}),"\n",(0,c.jsx)(n.li,{children:"Data leakage"}),"\n",(0,c.jsx)(n.li,{children:"Brute-force attacks"}),"\n",(0,c.jsx)(n.li,{children:"Internal admin panel exposure"}),"\n",(0,c.jsx)(n.li,{children:"Abuse from unknown networks"}),"\n",(0,c.jsx)(n.li,{children:"Compliance violations"}),"\n"]}),"\n",(0,c.jsxs)(n.h2,{id:"ip-based-access-control-allow--deny",children:["IP-Based Access Control (",(0,c.jsx)(n.code,{children:"allow"})," / ",(0,c.jsx)(n.code,{children:"deny"}),")"]}),"\n",(0,c.jsx)(n.h3,{id:"basic-ip-restriction",children:"Basic IP Restriction"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"location /admin/ {\r\n    allow 192.168.1.0/24;\r\n    deny all;\r\n}\n"})}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"Rule"}),(0,c.jsx)(n.th,{children:"Meaning"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"allow 192.168.1.0/24"})}),(0,c.jsx)(n.td,{children:"Permit internal network"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"deny all"})}),(0,c.jsx)(n.td,{children:"Block everyone else"})]})]})]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Not suitable for public users"}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"allow-specific-ips-only",children:"Allow Specific IPs Only"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"location /secure-api/ {\r\n    allow 203.0.113.10;\r\n    allow 203.0.113.11;\r\n    deny all;\r\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"Works well for internal services or partners"}),"\n",(0,c.jsx)(n.h3,{id:"restricting-access-by-country-geoip",children:"Restricting Access by Country (GeoIP)"}),"\n",(0,c.jsx)(n.p,{children:"Example: Block All Except One Country"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"geo $allowed_country {\r\n    default no;\r\n    BD yes;\r\n}\r\n\r\nserver {\r\n    if ($allowed_country = no) {\r\n        return 403;\r\n    }\r\n}\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Useful for region-restricted services"}),"\n",(0,c.jsx)(n.li,{children:"Requires GeoIP database"}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"authentication-based-access-control",children:"Authentication-Based Access Control"}),"\n",(0,c.jsx)(n.h3,{id:"http-basic-authentication",children:"HTTP Basic Authentication"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'location /private/ {\r\n    auth_basic "Restricted Area";\r\n    auth_basic_user_file /etc/nginx/.htpasswd;\r\n}\n'})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Browser prompts for username/password"}),"\n",(0,c.jsx)(n.li,{children:"Credentials stored in .htpasswd"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"Simple, Good for internal tools, Not ideal for public apps"}),"\n",(0,c.jsxs)(n.h3,{id:"create-htpasswd",children:["Create ",(0,c.jsx)(n.code,{children:".htpasswd"})]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"htpasswd -c /etc/nginx/.htpasswd admin\n"})}),"\n",(0,c.jsx)(n.h2,{id:"restricting-access-using-request-methods",children:"Restricting Access Using Request Methods"}),"\n",(0,c.jsx)(n.p,{children:"Example: Allow Only GET & POST"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"location /api/ {\r\n    limit_except GET POST {\r\n        deny all;\r\n    }\r\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"restricting-access-using-headers-api-keys",children:"Restricting Access Using Headers (API Keys)"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'location /api/ {\r\n    if ($http_x_api_key != "SECRET123") {\r\n        return 403;\r\n    }\r\n}\n'})}),"\n",(0,c.jsx)(n.h2,{id:"restricting-access-by-time-maintenance-window",children:"Restricting Access by Time (Maintenance Window)"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"map $time_hour $allowed_time {\r\n    default 0;\r\n    09 1;\r\n    10 1;\r\n    11 1;\r\n    12 1;\r\n}\r\n\r\nserver {\r\n    if ($allowed_time = 0) {\r\n        return 403;\r\n    }\r\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"Useful for admin systems"}),"\n",(0,c.jsx)(n.h2,{id:"restricting-access-to-files--paths",children:"Restricting Access to Files & Paths"}),"\n",(0,c.jsx)(n.h3,{id:"protect-sensitive-files",children:"Protect Sensitive Files"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"location ~* \\.(env|log|sql|bak)$ {\r\n    deny all;\r\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"Prevents data leaks"}),"\n",(0,c.jsx)(n.h3,{id:"block-hidden-files",children:"Block Hidden Files"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"location ~ /\\. {\r\n    deny all;\r\n}\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Protects ",(0,c.jsx)(n.code,{children:".git"}),", ",(0,c.jsx)(n.code,{children:".env"}),", ",(0,c.jsx)(n.code,{children:".htaccess"})]}),"\n",(0,c.jsx)(n.h2,{id:"restricting-access-using-rate--connection-limits",children:"Restricting Access Using Rate & Connection Limits"}),"\n",(0,c.jsx)(n.h3,{id:"rate-limit-sensitive-paths",children:"Rate Limit Sensitive Paths"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"location /login {\r\n    limit_req zone=login burst=3 nodelay;\r\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"Connection Limit"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"limit_conn conn_limit 5;\n"})}),"\n",(0,c.jsx)(n.p,{children:"Prevents brute-force, Stops DoS attacks"}),"\n",(0,c.jsx)(n.h2,{id:"combining-multiple-restrictions-best-practice",children:"Combining Multiple Restrictions (Best Practice)"}),"\n",(0,c.jsx)(n.h3,{id:"secure-admin-panel-example",children:"Secure Admin Panel Example"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'location /admin/ {\r\n    allow 192.168.1.0/24;\r\n    deny all;\r\n\r\n    auth_basic "Admin Area";\r\n    auth_basic_user_file /etc/nginx/.htpasswd;\r\n\r\n    limit_req zone=admin burst=2 nodelay;\r\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"Security Layers Used"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"Layer"}),(0,c.jsx)(n.th,{children:"Purpose"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"IP restriction"}),(0,c.jsx)(n.td,{children:"Network trust"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"Auth"}),(0,c.jsx)(n.td,{children:"Identity"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"Rate limit"}),(0,c.jsx)(n.td,{children:"Abuse prevention"})]})]})]}),"\n",(0,c.jsx)(n.h2,{id:"restrict-access-behind-load-balancers",children:"Restrict Access Behind Load Balancers"}),"\n",(0,c.jsx)(n.p,{children:"Get Real Client IP"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"set_real_ip_from 10.0.0.0/8;\r\nreal_ip_header X-Forwarded-For;\n"})}),"\n",(0,c.jsx)(n.p,{children:"Prevents bypassing IP rules"}),"\n",(0,c.jsx)(n.h2,{id:"common-security-mistakes",children:"Common Security Mistakes"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"Mistake"}),(0,c.jsx)(n.th,{children:"Risk"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"Only using auth"}),(0,c.jsx)(n.td,{children:"Brute-force risk"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"Only IP restriction"}),(0,c.jsx)(n.td,{children:"VPN bypass"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsxs)(n.td,{children:["Using ",(0,c.jsx)(n.code,{children:"if"})," incorrectly"]}),(0,c.jsx)(n.td,{children:"Config bugs"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"No HTTPS"}),(0,c.jsx)(n.td,{children:"Credential theft"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"No logging"}),(0,c.jsx)(n.td,{children:"Blind attacks"})]})]})]}),"\n",(0,c.jsx)(n.h2,{id:"logging-restricted-access-attempts",children:"Logging Restricted Access Attempts"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"access_log /var/log/nginx/restricted.log main;\r\nerror_log  /var/log/nginx/restricted_error.log warn;\n"})}),"\n",(0,c.jsx)(n.p,{children:"Helps incident analysis"})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(o,{...e})}):o(e)}}}]);