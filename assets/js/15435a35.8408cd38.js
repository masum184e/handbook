"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[28e3],{28453(e,n,r){r.d(n,{R:()=>o,x:()=>c});var s=r(96540);const t={},i=s.createContext(t);function o(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(i.Provider,{value:n},e.children)}},84095(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"nginx/Logging/Log Format","title":"Log Format","description":"The access log records every HTTP request handled by NGINX.","source":"@site/docs/nginx/22. Logging/1. Log Format.md","sourceDirName":"nginx/22. Logging","slug":"/nginx/Logging/Log Format","permalink":"/handbook/docs/nginx/Logging/Log Format","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"nginxApiSidebar","previous":{"title":"Basic Authentication","permalink":"/handbook/docs/nginx/Basic Authentication"},"next":{"title":"Error Logs","permalink":"/handbook/docs/nginx/Logging/Error Logs"}}');var t=r(74848),i=r(28453);const o={},c=void 0,l={},d=[{value:"How Access Logging Works Internally",id:"how-access-logging-works-internally",level:2},{value:"Core Directives for Access Logs",id:"core-directives-for-access-logs",level:2},{value:"<code>log_format</code> (Define Log Structure)",id:"log_format-define-log-structure",level:3},{value:"<code>access_log</code> (Enable Logging)",id:"access_log-enable-logging",level:3},{value:"Default NGINX Access Log Format (Combined)",id:"default-nginx-access-log-format-combined",level:2},{value:"Explanation of Common Access Log Variables",id:"explanation-of-common-access-log-variables",level:2},{value:"Security-Focused Access Log Format (Recommended)",id:"security-focused-access-log-format-recommended",level:2},{value:"Performance &amp; Latency Monitoring Format",id:"performance--latency-monitoring-format",level:2},{value:"JSON Access Log Format (Best for Modern Monitoring)",id:"json-access-log-format-best-for-modern-monitoring",level:2},{value:"Conditional Access Logging (Reduce Noise)",id:"conditional-access-logging-reduce-noise",level:2},{value:"Disable Access Logging (Static Content)",id:"disable-access-logging-static-content",level:2},{value:"Logging Real Client IP (Behind Proxy)",id:"logging-real-client-ip-behind-proxy",level:2},{value:"Common Logging Mistakes",id:"common-logging-mistakes",level:2},{value:"Log Rotation (Essential)",id:"log-rotation-essential",level:2},{value:"Security-Recommended Access Log Format",id:"security-recommended-access-log-format",level:2}];function a(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"The access log records every HTTP request handled by NGINX."}),"\n",(0,t.jsx)(n.p,{children:"It is essential for:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Security monitoring (attacks, scans, abuse)"}),"\n",(0,t.jsx)(n.li,{children:"Performance analysis (latency, bottlenecks)"}),"\n",(0,t.jsx)(n.li,{children:"Debugging application issues"}),"\n",(0,t.jsx)(n.li,{children:"Traffic analytics"}),"\n",(0,t.jsx)(n.li,{children:"Compliance and auditing"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Each log entry represents one completed request."}),"\n",(0,t.jsx)(n.h2,{id:"how-access-logging-works-internally",children:"How Access Logging Works Internally"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Client sends request"}),"\n",(0,t.jsx)(n.li,{children:"NGINX processes request"}),"\n",(0,t.jsx)(n.li,{children:"Response is sent"}),"\n",(0,t.jsxs)(n.li,{children:["After response, NGINX writes a log line using:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"A log format"}),"\n",(0,t.jsx)(n.li,{children:"A log destination (file/syslog/stdout)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"core-directives-for-access-logs",children:"Core Directives for Access Logs"}),"\n",(0,t.jsxs)(n.h3,{id:"log_format-define-log-structure",children:[(0,t.jsx)(n.code,{children:"log_format"})," (Define Log Structure)"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"log_format main '$remote_addr - $remote_user [$time_local] '\r\n                '\"$request\" $status $body_bytes_sent '\r\n                '\"$http_referer\" \"$http_user_agent\"';\n"})}),"\n",(0,t.jsx)(n.p,{children:"Defines what data is logged and how it is structured"}),"\n",(0,t.jsxs)(n.h3,{id:"access_log-enable-logging",children:[(0,t.jsx)(n.code,{children:"access_log"})," (Enable Logging)"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"access_log /var/log/nginx/access.log main;\n"})}),"\n",(0,t.jsx)(n.p,{children:"Uses:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Log file path"}),"\n",(0,t.jsx)(n.li,{children:"Log format name"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"default-nginx-access-log-format-combined",children:"Default NGINX Access Log Format (Combined)"}),"\n",(0,t.jsx)(n.p,{children:"NGINX\u2019s default format is similar to Apache\u2019s combined format:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"log_format combined '$remote_addr - $remote_user [$time_local] '\r\n                    '\"$request\" $status $body_bytes_sent '\r\n                    '\"$http_referer\" \"$http_user_agent\"';\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example Log Entry"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'203.0.113.10 - - [22/Jan/2026:10:15:43 +0000]\r\n"GET /login HTTP/1.1" 200 532\r\n"https://example.com" "Mozilla/5.0"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"explanation-of-common-access-log-variables",children:"Explanation of Common Access Log Variables"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Variable"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Security / Monitoring Use"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"$remote_addr"})}),(0,t.jsx)(n.td,{children:"Client IP address"}),(0,t.jsx)(n.td,{children:"Identify attackers"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"$remote_user"})}),(0,t.jsx)(n.td,{children:"Authenticated user"}),(0,t.jsx)(n.td,{children:"Audit"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"$time_local"})}),(0,t.jsx)(n.td,{children:"Request time"}),(0,t.jsx)(n.td,{children:"Incident timeline"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"$request"})}),(0,t.jsx)(n.td,{children:"Full request line"}),(0,t.jsx)(n.td,{children:"Detect exploits"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"$status"})}),(0,t.jsx)(n.td,{children:"HTTP response code"}),(0,t.jsx)(n.td,{children:"Error monitoring"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"$body_bytes_sent"})}),(0,t.jsx)(n.td,{children:"Response size"}),(0,t.jsx)(n.td,{children:"Traffic analysis"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"$http_referer"})}),(0,t.jsx)(n.td,{children:"Referrer URL"}),(0,t.jsx)(n.td,{children:"CSRF detection"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"$http_user_agent"})}),(0,t.jsx)(n.td,{children:"Client software"}),(0,t.jsx)(n.td,{children:"Bot detection"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"security-focused-access-log-format-recommended",children:"Security-Focused Access Log Format (Recommended)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"log_format security '$remote_addr '\r\n                    '[$time_iso8601] '\r\n                    '\"$request\" '\r\n                    '$status '\r\n                    '$request_time '\r\n                    '\"$http_user_agent\"';\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example Entry"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'198.51.100.25 [2026-01-22T10:17:11+00:00]\r\n"POST /login HTTP/1.1" 401 0.532 "curl/7.88.1"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"performance--latency-monitoring-format",children:"Performance & Latency Monitoring Format"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"log_format performance '$remote_addr '\r\n                        '\"$request\" '\r\n                        '$status '\r\n                        'rt=$request_time '\r\n                        'uct=$upstream_connect_time '\r\n                        'uht=$upstream_header_time '\r\n                        'urt=$upstream_response_time';\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'203.0.113.5 "GET /api HTTP/1.1" 200 rt=0.120 uct=0.003 uht=0.020 urt=0.115\n'})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Field"}),(0,t.jsx)(n.th,{children:"Meaning"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"rt"})}),(0,t.jsx)(n.td,{children:"Total request time"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"uct"})}),(0,t.jsx)(n.td,{children:"Upstream connect time"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"uht"})}),(0,t.jsx)(n.td,{children:"Time to receive headers"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"urt"})}),(0,t.jsx)(n.td,{children:"Backend response time"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"json-access-log-format-best-for-modern-monitoring",children:"JSON Access Log Format (Best for Modern Monitoring)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'log_format json escape=json\r\n\'{\'\r\n  \'"time":"$time_iso8601",\'\r\n  \'"remote_addr":"$remote_addr",\'\r\n  \'"method":"$request_method",\'\r\n  \'"uri":"$request_uri",\'\r\n  \'"status":$status,\'\r\n  \'"request_time":$request_time,\'\r\n  \'"user_agent":"$http_user_agent"\'\r\n\'}\';\n'})}),"\n",(0,t.jsx)(n.p,{children:"Example JSON Log"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'{\r\n  "time":"2026-01-22T10:19:12+00:00",\r\n  "remote_addr":"192.0.2.15",\r\n  "method":"GET",\r\n  "uri":"/api/users",\r\n  "status":200,\r\n  "request_time":0.083,\r\n  "user_agent":"Mozilla/5.0"\r\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"conditional-access-logging-reduce-noise",children:"Conditional Access Logging (Reduce Noise)"}),"\n",(0,t.jsx)(n.p,{children:"Log Only Errors (Status \u2265 400)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"map $status $log_errors {\r\n    ~^[45] 1;\r\n    default 0;\r\n}\r\n\r\naccess_log /var/log/nginx/error_access.log security if=$log_errors;\n"})}),"\n",(0,t.jsx)(n.h2,{id:"disable-access-logging-static-content",children:"Disable Access Logging (Static Content)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"location /assets/ {\r\n    access_log off;\r\n    expires 30d;\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"logging-real-client-ip-behind-proxy",children:"Logging Real Client IP (Behind Proxy)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"set_real_ip_from 10.0.0.0/8;\r\nreal_ip_header X-Forwarded-For;\n"})}),"\n",(0,t.jsx)(n.p,{children:"Then log:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"log_format realip '$remote_addr \"$request\" $status';\n"})}),"\n",(0,t.jsx)(n.h2,{id:"common-logging-mistakes",children:"Common Logging Mistakes"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Mistake"}),(0,t.jsx)(n.th,{children:"Impact"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Logging without request time"}),(0,t.jsx)(n.td,{children:"Hard to debug slowness"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Not using JSON logs"}),(0,t.jsx)(n.td,{children:"Painful parsing"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Missing real IP"}),(0,t.jsx)(n.td,{children:"Wrong attacker identity"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Logging everything"}),(0,t.jsx)(n.td,{children:"Disk exhaustion"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"No log rotation"}),(0,t.jsx)(n.td,{children:"Server crash"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"log-rotation-essential",children:"Log Rotation (Essential)"}),"\n",(0,t.jsx)(n.p,{children:"NGINX does not rotate logs itself."}),"\n",(0,t.jsx)(n.p,{children:"Use logrotate:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"/var/log/nginx/*.log {\r\n    daily\r\n    rotate 14\r\n    compress\r\n    missingok\r\n    notifempty\r\n    create 0640 nginx adm\r\n    postrotate\r\n        systemctl reload nginx\r\n    endscript\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"security-recommended-access-log-format",children:"Security-Recommended Access Log Format"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'log_format secure_json escape=json\r\n\'{\'\r\n \'"time":"$time_iso8601",\'\r\n \'"ip":"$remote_addr",\'\r\n \'"request":"$request",\'\r\n \'"status":$status,\'\r\n \'"rt":$request_time,\'\r\n \'"ua":"$http_user_agent"\'\r\n\'}\';\r\n\r\naccess_log /var/log/nginx/access.log secure_json;\n'})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}}}]);