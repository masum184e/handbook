"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[76908],{28453(e,n,r){r.d(n,{R:()=>d,x:()=>o});var s=r(96540);const l={},i=s.createContext(l);function d(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),s.createElement(i.Provider,{value:n},e.children)}},53972(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"mysql/Stored Procedure","title":"Stored Procedure","description":"A Stored Procedure in MySQL is a set of SQL statements that are stored in the database and can be executed later by calling its name.","source":"@site/docs/mysql/12. Stored Procedure.md","sourceDirName":"mysql","slug":"/mysql/Stored Procedure","permalink":"/handbook/docs/mysql/Stored Procedure","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"sidebar_position":13},"sidebar":"mysqlSidebar","previous":{"title":"Indexing","permalink":"/handbook/docs/mysql/Indexing"},"next":{"title":"Stored Function","permalink":"/handbook/docs/mysql/Stored Function"}}');var l=r(74848),i=r(28453);const d={sidebar_position:13},o=void 0,c={},t=[{value:"Creating a Stored Procedure",id:"creating-a-stored-procedure",level:2},{value:"A Simple Procedure (No Parameters)",id:"a-simple-procedure-no-parameters",level:2},{value:"Procedure with <code>IN</code> Parameter",id:"procedure-with-in-parameter",level:2},{value:"Procedure with <code>OUT</code> Parameter",id:"procedure-with-out-parameter",level:2},{value:"Procedure with <code>INOUT</code> Parameter",id:"procedure-with-inout-parameter",level:2},{value:"Managing Stored Procedures",id:"managing-stored-procedures",level:2},{value:"Error Handling Stored Procedures",id:"error-handling-stored-procedures",level:2},{value:"Syntax for Declaring a Handler",id:"syntax-for-declaring-a-handler",level:3},{value:"EXIT HANDLER (stop procedure on error)",id:"exit-handler-stop-procedure-on-error",level:3},{value:"CONTINUE HANDLER (ignore error and keep going)",id:"continue-handler-ignore-error-and-keep-going",level:3}];function a(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.p,{children:"A Stored Procedure in MySQL is a set of SQL statements that are stored in the database and can be executed later by calling its name."}),"\n",(0,l.jsx)(n.p,{children:"It\u2019s useful because:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"You can reuse logic without rewriting queries."}),"\n",(0,l.jsx)(n.li,{children:"It improves performance (less network traffic between app and DB)."}),"\n",(0,l.jsx)(n.li,{children:"It improves security (you can give permission to execute a procedure without exposing the underlying tables directly)."}),"\n",(0,l.jsx)(n.li,{children:"It helps modularize code (similar to functions in programming)."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"creating-a-stored-procedure",children:"Creating a Stored Procedure"}),"\n",(0,l.jsx)(n.p,{children:"The basic syntax is:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"DELIMITER //\r\n\r\nCREATE PROCEDURE procedureName (parameters)\r\nBEGIN\r\n   -- SQL statements go here\r\nEND //\r\n\r\nDELIMITER ;\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"DELIMITER"}),": By default, MySQL ends statements with ",(0,l.jsx)(n.code,{children:";"}),". Since procedures have multiple statements separated by ",(0,l.jsx)(n.code,{children:";"}),", we temporarily change the delimiter to ",(0,l.jsx)(n.code,{children:"//"})," (or some other symbol)."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"procedure_name"}),": The name of the stored procedure."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"parameters"}),": You can define parameters with ",(0,l.jsx)(n.code,{children:"IN"}),", ",(0,l.jsx)(n.code,{children:"OUT"}),", or ",(0,l.jsx)(n.code,{children:"INOUT"}),".","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"IN"})," \u2192 Input only (default).","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Caller sends a value into the procedure."}),"\n",(0,l.jsx)(n.li,{children:"Cannot be modified inside the procedure (only read)."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"OUT"})," \u2192 Output only.","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Caller provides a variable."}),"\n",(0,l.jsx)(n.li,{children:"Procedure sets a value for it."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"INOUT"})," \u2192 Input and output.","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Caller sends an initial value."}),"\n",(0,l.jsx)(n.li,{children:"Procedure can read and change it, and the updated value is returned."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"BEGIN"})," \u2026 ",(0,l.jsx)(n.code,{children:"END"}),": Defines the body of the procedure."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"a-simple-procedure-no-parameters",children:"A Simple Procedure (No Parameters)"}),"\n",(0,l.jsx)(n.p,{children:"Let\u2019s create a procedure that shows all employees from a table."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"DELIMITER //\r\n\r\nCREATE PROCEDURE getAllEmployees()\r\nBEGIN\r\n   SELECT * FROM employees;\r\nEND //\r\n\r\nDELIMITER ;\n"})}),"\n",(0,l.jsx)(n.p,{children:"To call this procedure:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"CALL getAllEmployees();\n"})}),"\n",(0,l.jsxs)(n.h2,{id:"procedure-with-in-parameter",children:["Procedure with ",(0,l.jsx)(n.code,{children:"IN"})," Parameter"]}),"\n",(0,l.jsx)(n.p,{children:"Suppose you want to get employees of a particular department:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"DELIMITER //\r\n\r\nCREATE PROCEDURE getEmployeesByDept(IN dept_id INT)\r\nBEGIN\r\n   SELECT * FROM employees\r\n   WHERE department_id = dept_id;\r\nEND //\r\n\r\nDELIMITER ;\n"})}),"\n",(0,l.jsx)(n.p,{children:"To call this procedure:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"CALL getEmployeesByDept(2);\n"})}),"\n",(0,l.jsxs)(n.h2,{id:"procedure-with-out-parameter",children:["Procedure with ",(0,l.jsx)(n.code,{children:"OUT"})," Parameter"]}),"\n",(0,l.jsx)(n.p,{children:"Now let\u2019s create a procedure that returns the total number of employees."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"DELIMITER //\r\n\r\nCREATE PROCEDURE getEmployeeCount(OUT total INT)\r\nBEGIN\r\n   SELECT COUNT(*) INTO total FROM employees;\r\nEND //\r\n\r\nDELIMITER ;\n"})}),"\n",(0,l.jsx)(n.p,{children:"To call this procedure:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"CALL getEmployeeCount(@empCount);\r\nSELECT @empCount AS 'Total Employees';\n"})}),"\n",(0,l.jsxs)(n.h2,{id:"procedure-with-inout-parameter",children:["Procedure with ",(0,l.jsx)(n.code,{children:"INOUT"})," Parameter"]}),"\n",(0,l.jsx)(n.p,{children:"Let\u2019s say we want to increase a number by 10 and return it."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"DELIMITER //\r\n\r\nCREATE PROCEDURE increaseNumber(INOUT num INT)\r\nBEGIN\r\n   SET num = num + 10;\r\nEND //\r\n\r\nDELIMITER ;\n"})}),"\n",(0,l.jsx)(n.p,{children:"To call this procedure:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"SET @x = 5;\r\nCALL increaseNumber(@x);\r\nSELECT @x AS 'New Value';\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Since ",(0,l.jsx)(n.code,{children:"@x"})," starts as 5, after the procedure call, the result will be 15."]}),"\n",(0,l.jsx)(n.h2,{id:"managing-stored-procedures",children:"Managing Stored Procedures"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Show all procedures: ",(0,l.jsx)(n.code,{children:"SHOW PROCEDURE STATUS WHERE Db = 'your_database_name';"})]}),"\n",(0,l.jsxs)(n.li,{children:["View procedure code: ",(0,l.jsx)(n.code,{children:"SHOW CREATE PROCEDURE GetAllEmployees;"})]}),"\n",(0,l.jsxs)(n.li,{children:["Delete a procedure: ",(0,l.jsx)(n.code,{children:"DROP PROCEDURE GetAllEmployees;"})]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"error-handling-stored-procedures",children:"Error Handling Stored Procedures"}),"\n",(0,l.jsx)(n.p,{children:"In MySQL, error handling inside stored procedures (and functions) is done using:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"DECLARE HANDLER"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Defines what to do when certain conditions occur (e.g., errors, warnings)."}),"\n",(0,l.jsxs)(n.li,{children:["Two types:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"CONTINUE HANDLER"})," \u2192 Ignore the error and continue execution."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"EXIT HANDLER"})," \u2192 Exit the procedure immediately when the condition happens."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Condition Types you can handle:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"SQLEXCEPTION"})," \u2192 Catches all SQL errors."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"SQLWARNING"})," \u2192 Catches all warnings."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"NOT FOUND"})," \u2192 Usually used in cursors when no more rows are available."]}),"\n",(0,l.jsx)(n.li,{children:"Or specific error codes / SQLSTATE values (e.g., 1062 for duplicate entry)."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["GET DIAGNOSTICS (MySQL 5.6+)","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Used to retrieve detailed error information inside the handler."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"syntax-for-declaring-a-handler",children:"Syntax for Declaring a Handler"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"DECLARE handler_type HANDLER FOR condition_value statement;\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"handler_type"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"CONTINUE"})," \u2192 continue execution"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"EXIT"})," \u2192 exit procedure"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"condition_value"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"SQLEXCEPTION"}),", ",(0,l.jsx)(n.code,{children:"SQLWARNING"}),", ",(0,l.jsx)(n.code,{children:"NOT FOUND"})," or ",(0,l.jsx)(n.code,{children:"SQLSTATE"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"exit-handler-stop-procedure-on-error",children:"EXIT HANDLER (stop procedure on error)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"DELIMITER //\r\n\r\nCREATE PROCEDURE insertEmployeeSafe(IN emp_id INT, IN emp_name VARCHAR(50))\r\nBEGIN\r\n   DECLARE EXIT HANDLER FOR SQLEXCEPTION\r\n   BEGIN\r\n      -- What to do on error\r\n      SELECT 'An error occurred while inserting employee.' AS ErrorMessage;\r\n   END;\r\n\r\n   INSERT INTO accounts (emp_id, emp_name)\r\n   VALUES (emp_id, emp_name);\r\n\r\n   SELECT 'Employee inserted successfully!' AS SuccessMessage;\r\nEND //\r\n\r\nDELIMITER ;\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["If an error occurs during ",(0,l.jsx)(n.code,{children:"INSERT"})," (e.g., duplicate ",(0,l.jsx)(n.code,{children:"employee_id"}),"), the EXIT HANDLER is triggered."]}),"\n",(0,l.jsx)(n.li,{children:"Procedure stops and displays the error message."}),"\n",(0,l.jsx)(n.li,{children:"If no error, it continues normally."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Call it:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"CALL insertEmployeeSafe(1, 'John');\n"})}),"\n",(0,l.jsx)(n.h3,{id:"continue-handler-ignore-error-and-keep-going",children:"CONTINUE HANDLER (ignore error and keep going)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"DELIMITER //\r\n\r\nCREATE PROCEDURE insertWithIgnore(IN emp_id INT, IN emp_name VARCHAR(50))\r\nBEGIN\r\n   DECLARE CONTINUE HANDLER FOR 1062 -- Duplicate entry error code\r\n   BEGIN\r\n      SELECT 'Duplicate entry ignored.' AS WarningMessage;\r\n   END;\r\n\r\n   INSERT INTO employees (employee_id, first_name)\r\n   VALUES (emp_id, emp_name);\r\n\r\n   SELECT 'Insert attempted.' AS InfoMessage;\r\nEND //\r\n\r\nDELIMITER ;\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["If a duplicate key error (",(0,l.jsx)(n.code,{children:"1062"}),") occurs, the ",(0,l.jsx)(n.code,{children:"CONTINUE"})," HANDLER executes, but the procedure continues."]}),"\n",(0,l.jsx)(n.li,{children:"It won\u2019t stop execution, just prints a warning."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Call it:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"CALL insertWithIgnore(1, 'Alice');\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}}}]);