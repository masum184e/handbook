"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[69714],{8762(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"mysql/Database Security/Securing Connections","title":"Securing Connections","description":"MySQL supports SSL/TLS (Secure Sockets Layer / Transport Layer Security) to encrypt client-server communication.","source":"@site/docs/mysql/19. Database Security/2. Securing Connections.md","sourceDirName":"mysql/19. Database Security","slug":"/mysql/Database Security/Securing Connections","permalink":"/handbook/docs/mysql/Database Security/Securing Connections","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"mysqlSidebar","previous":{"title":"User Management","permalink":"/handbook/docs/mysql/Database Security/User Management"},"next":{"title":"Best Practices","permalink":"/handbook/docs/mysql/Database Security/Best Practices"}}');var t=s(74848),c=s(28453);const i={},l=void 0,o={},a=[{value:"How SSL/TLS Works in MySQL",id:"how-ssltls-works-in-mysql",level:3},{value:"Enabling SSL/TLS in MySQL",id:"enabling-ssltls-in-mysql",level:3},{value:"Step 1: Generate Certificates &amp; Keys",id:"step-1-generate-certificates--keys",level:4},{value:"Step 2: Start MySQL Docker Container with SSL",id:"step-2-start-mysql-docker-container-with-ssl",level:4},{value:"Step 3: Enter MySQL Container",id:"step-3-enter-mysql-container",level:4},{value:"Step 4: Create SSL-Required Users",id:"step-4-create-ssl-required-users",level:4},{value:"Step 5: Connect from Client Using SSL",id:"step-5-connect-from-client-using-ssl",level:4},{value:"Step 6: Verify SSL Connection",id:"step-6-verify-ssl-connection",level:4},{value:"Step 7: Test Non-SSL Connection Failure",id:"step-7-test-non-ssl-connection-failure",level:4},{value:"Step 8: Optional \u2013 Verify Certificate Authentication",id:"step-8-optional--verify-certificate-authentication",level:4}];function d(e){const n={blockquote:"blockquote",code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"MySQL supports SSL/TLS (Secure Sockets Layer / Transport Layer Security) to encrypt client-server communication.\r\nBy default, MySQL connections are plaintext, meaning data (including passwords) can be intercepted if transmitted over a network.\r\nUsing SSL/TLS ensures:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Encryption"})," \u2192 Protects data in transit from eavesdropping."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Authentication"})," \u2192 Ensures the client is connecting to the right server."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Integrity"})," \u2192 Prevents data tampering."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"how-ssltls-works-in-mysql",children:"How SSL/TLS Works in MySQL"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Server and Client Certificates"})," \u2192 Both server and client can use X.509 certificates for authentication."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Handshake"})," \u2192 When the client connects, it negotiates encryption parameters with the server."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Encrypted Session"})," \u2192 All subsequent communication is encrypted."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"enabling-ssltls-in-mysql",children:"Enabling SSL/TLS in MySQL"}),"\n",(0,t.jsx)(n.h4,{id:"step-1-generate-certificates--keys",children:"Step 1: Generate Certificates & Keys"}),"\n",(0,t.jsx)(n.p,{children:"You need:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["CA certificate (",(0,t.jsx)(n.code,{children:"ca-cert.pem"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:["Server certificate (",(0,t.jsx)(n.code,{children:"server-cert.pem"}),") and key (",(0,t.jsx)(n.code,{children:"server-key.pem"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:["Client certificate (",(0,t.jsx)(n.code,{children:"client-cert.pem"}),") and key (",(0,t.jsx)(n.code,{children:"client-key.pem"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Place all certificates in a folder on Windows, e.g.:\r\n",(0,t.jsx)(n.code,{children:"C:\\Users\\USER\\mysql-certs"})]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Tip: You can generate certificates either manually using OpenSSL or let MySQL generate them automatically using ",(0,t.jsx)(n.code,{children:"mysql_ssl_rsa_setup.exe"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"step-2-start-mysql-docker-container-with-ssl",children:"Step 2: Start MySQL Docker Container with SSL"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'docker run --name mysql-secure -e MYSQL_ROOT_PASSWORD=my-secret-pw -v "C:\\Users\\USER\\mysql-certs:/etc/mysql/ssl" -p 3306:3306 -d mysql:latest --ssl-ca=/etc/mysql/ssl/ca-cert.pem --ssl-cert=/etc/mysql/ssl/server-cert.pem --ssl-key=/etc/mysql/ssl/server-key.pem\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'-v "C:\\Users\\USER\\mysql-certs:/etc/mysql/ssl"'})," \u2192 mounts cert folder into container"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"--ssl-ca"}),", ",(0,t.jsx)(n.code,{children:"--ssl-cert"}),", ",(0,t.jsx)(n.code,{children:"--ssl-key"})," \u2192 tell MySQL server where the certificates are"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"-p 3306:3306"})," \u2192 exposes MySQL port for TCP connections"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"step-3-enter-mysql-container",children:"Step 3: Enter MySQL Container"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"docker exec -it mysql-secure mysql -u root -p\n"})}),"\n",(0,t.jsx)(n.p,{children:"Check SSL-related variables:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"SHOW VARIABLES LIKE 'ssl_%';\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You should see paths pointing to ",(0,t.jsx)(n.code,{children:"/etc/mysql/ssl/..."})]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Note: ",(0,t.jsx)(n.code,{children:"have_ssl"})," is deprecated in MySQL 8 and may be empty \u2014 ignore it."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"step-4-create-ssl-required-users",children:"Step 4: Create SSL-Required Users"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"SSL-only user"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE USER 'secure_user'@'%' IDENTIFIED BY 'StrongPass123' REQUIRE SSL;\r\nGRANT ALL PRIVILEGES ON *.* TO 'secure_user'@'%';\r\nFLUSH PRIVILEGES;\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["This user cannot connect without SSL/TLS.\r\n",(0,t.jsx)(n.strong,{children:"Certificate-based authentication (optional)"})]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE USER 'cert_user'@'%' REQUIRE X509;\r\nGRANT ALL PRIVILEGES ON *.* TO 'cert_user'@'%';\r\nFLUSH PRIVILEGES;\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"This user requires the client to present a valid certificate signed by your CA."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"step-5-connect-from-client-using-ssl",children:"Step 5: Connect from Client Using SSL"}),"\n",(0,t.jsx)(n.p,{children:"Important: SSL works only over TCP. Do not connect via Unix socket inside the same container."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Connect from Windows host"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"mysql -u secure_user -p --ssl-mode=REQUIRED --ssl-ca=C:\\Users\\USER\\mysql-certs\\ca-cert.pem --ssl-cert=C:\\Users\\USER\\mysql-certs\\client-cert.pem --ssl-key=C:\\Users\\USER\\mysql-certs\\client-key.pem -h 127.0.0.1 -P 3306\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Connect from a separate Docker client container"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"docker run -it --rm -v C:\\Users\\USER\\mysql-certs:/certs mysql:latest bash\n"})}),"\n",(0,t.jsx)(n.p,{children:"Inside the container"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"mysql -u secure_user -p --ssl-mode=REQUIRED --ssl-ca=/certs/ca-cert.pem --ssl-cert=/certs/client-cert.pem --ssl-key=/certs/client-key.pem -h host.docker.internal -P 3306\n"})}),"\n",(0,t.jsx)(n.h4,{id:"step-6-verify-ssl-connection",children:"Step 6: Verify SSL Connection"}),"\n",(0,t.jsx)(n.p,{children:"Inside MySQL"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SHOW STATUS LIKE 'Ssl_cipher';\n"})}),"\n",(0,t.jsx)(n.p,{children:"Expeceted Output:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"+---------------+----------------------+\r\n| Variable_name | Value                |\r\n+---------------+----------------------+\r\n| Ssl_cipher    | TLS_AES_256_GCM_SHA384 |\r\n+---------------+----------------------+\n"})}),"\n",(0,t.jsx)(n.p,{children:"If empty \u2192 SSL is not being used (likely you connected via socket, not TCP)."}),"\n",(0,t.jsx)(n.h4,{id:"step-7-test-non-ssl-connection-failure",children:"Step 7: Test Non-SSL Connection Failure"}),"\n",(0,t.jsx)(n.p,{children:"Try connecting without SSL:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"mysql -u secure_user -p -h 127.0.0.1 -P 3306\n"})}),"\n",(0,t.jsx)(n.p,{children:"Should fail:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"ERROR 1045 (28000): SSL connection is required\n"})}),"\n",(0,t.jsx)(n.p,{children:"This confirms the SSL requirement is enforced."}),"\n",(0,t.jsx)(n.h4,{id:"step-8-optional--verify-certificate-authentication",children:"Step 8: Optional \u2013 Verify Certificate Authentication"}),"\n",(0,t.jsxs)(n.p,{children:["For ",(0,t.jsx)(n.code,{children:"cert_user"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"mysql -u cert_user -p --ssl-mode=REQUIRED --ssl-ca=C:\\Users\\USER\\mysql-certs\\ca-cert.pem --ssl-cert=C:\\Users\\USER\\mysql-certs\\client-cert.pem --ssl-key=C:\\Users\\USER\\mysql-certs\\client-key.pem -h 127.0.0.1 -P 3306\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Only works if the client presents the certificate signed by the CA."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453(e,n,s){s.d(n,{R:()=>i,x:()=>l});var r=s(96540);const t={},c=r.createContext(t);function i(e){const n=r.useContext(c);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);