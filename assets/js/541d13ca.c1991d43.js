"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[8831],{24688(e,s,n){n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>o,frontMatter:()=>d,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"system-design/TLS Handshake","title":"TLS Handshake","description":"The TLS (Transport Layer Security) handshake is a multi-step protocol used to establish a secure communication channel between a client and a server over an insecure network (like the Internet). It builds on top of TCP and ensures:","source":"@site/docs/system-design/16. TLS Handshake.md","sourceDirName":"system-design","slug":"/system-design/TLS Handshake","permalink":"/handbook/docs/system-design/TLS Handshake","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":17,"frontMatter":{"sidebar_position":17},"sidebar":"systemDesignSidebar","previous":{"title":"TCP Handshake","permalink":"/handbook/docs/system-design/TCP Handshake"},"next":{"title":"Scalability","permalink":"/handbook/docs/system-design/Scalability"}}');var t=n(74848),i=n(28453);const d={sidebar_position:17},l=void 0,c={},a=[{value:"TLS Handshake \u2013 Step-by-Step Breakdown",id:"tls-handshake--step-by-step-breakdown",level:2},{value:"Purpose of TLS in System Design",id:"purpose-of-tls-in-system-design",level:2},{value:"Visual Diagram of TLS Handshake",id:"visual-diagram-of-tls-handshake",level:2},{value:"Example of TLS Handshake",id:"example-of-tls-handshake",level:2},{value:"Example of TLS Handshake with Node.js",id:"example-of-tls-handshake-with-nodejs",level:2},{value:"TLS vs TCP",id:"tls-vs-tcp",level:2}];function h(e){const s={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:"The TLS (Transport Layer Security) handshake is a multi-step protocol used to establish a secure communication channel between a client and a server over an insecure network (like the Internet). It builds on top of TCP and ensures:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Confidentiality (encryption)"}),"\n",(0,t.jsx)(s.li,{children:"Integrity (data not altered)"}),"\n",(0,t.jsx)(s.li,{children:"Authentication (server identity verified)"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"TLS is most commonly used in HTTPS, secure email, VPNs, and secure APIs."}),"\n",(0,t.jsx)(s.h2,{id:"tls-handshake--step-by-step-breakdown",children:"TLS Handshake \u2013 Step-by-Step Breakdown"}),"\n",(0,t.jsx)(s.p,{children:"Default Modern TLS 1.2+ (simplified)"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Who"}),(0,t.jsx)(s.th,{children:"Message"}),(0,t.jsx)(s.th,{children:"Purpose"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Client"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"ClientHello"})}),(0,t.jsx)(s.td,{children:"Proposes supported TLS versions, cipher suites, and sends random value."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Server"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"ServerHello"})}),(0,t.jsx)(s.td,{children:"Selects TLS version, cipher suite, and sends its certificate and random value."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Server"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"Certificate"})}),(0,t.jsx)(s.td,{children:"Contains server\u2019s public key signed by a trusted CA."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Client"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"Verify certificate"})}),(0,t.jsx)(s.td,{children:"Checks if the cert is valid (via CA chain and hostname)."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Client"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"Pre-Master Key"})}),(0,t.jsx)(s.td,{children:"Encrypts and sends a pre-master secret using server\u2019s public key."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Both"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"Generate session keys"})}),(0,t.jsx)(s.td,{children:"Both generate the same symmetric key using the shared secret + randoms."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Client"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"Finished"})}),(0,t.jsx)(s.td,{children:"Sends encrypted handshake message."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Server"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"Finished"})}),(0,t.jsx)(s.td,{children:"Sends encrypted handshake message."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Both"}),(0,t.jsx)(s.td,{children:"Secure communication begins"}),(0,t.jsx)(s.td,{children:"Now both sides use symmetric encryption."})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"purpose-of-tls-in-system-design",children:"Purpose of TLS in System Design"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Goal"}),(0,t.jsx)(s.th,{children:"How TLS Handshake Helps"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Authentication"})}),(0,t.jsx)(s.td,{children:"Client verifies it\u2019s talking to a real, trusted server (via certificate)."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Encryption"})}),(0,t.jsx)(s.td,{children:"All HTTP data is encrypted using symmetric keys generated during handshake."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Integrity"})}),(0,t.jsx)(s.td,{children:"Protects against tampering or replay attacks using MACs or AEAD encryption."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Forward secrecy"})}),(0,t.jsx)(s.td,{children:"(with ephemeral key exchange like ECDHE) Even if private key is stolen, past sessions are safe."})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"visual-diagram-of-tls-handshake",children:"Visual Diagram of TLS Handshake"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Client                         Server\r\n  |                             |\r\n  | --- ClientHello ----------\x3e |  (Client proposes cipher suites, random)\r\n  |                             |\r\n  | <-- ServerHello ----------- |  (Server picks suite, sends cert & random)\r\n  |                             |\r\n  | <-- Certificate ------------|\r\n  |                             |\r\n  |     [Client verifies cert]  |\r\n  |                             |\r\n  | --- Pre-Master Key (Encrypted) --\x3e |\r\n  |                             |\r\n  |  [Both compute session key] |\r\n  | --- Finished (encrypted) --\x3e|\r\n  | <-- Finished (encrypted) ---|\r\n  |                             |\r\n  \ud83d\udd12 Encrypted communication begins\n"})}),"\n",(0,t.jsx)(s.h2,{id:"example-of-tls-handshake",children:"Example of TLS Handshake"}),"\n",(0,t.jsxs)(s.p,{children:["Scenario: A client makes a request to ",(0,t.jsx)(s.a,{href:"https://api.example.com",children:"https://api.example.com"})]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Client (browser or HTTP client) sends a TCP connection request."}),"\n",(0,t.jsx)(s.li,{children:"After TCP handshake, client sends a ClientHello to begin TLS."}),"\n",(0,t.jsx)(s.li,{children:"TLS handshake negotiates a cipher suite, and verifies the server's certificate."}),"\n",(0,t.jsx)(s.li,{children:"Both generate the same session key."}),"\n",(0,t.jsxs)(s.li,{children:["Secure HTTPS communication starts (e.g., sending a JSON payload).\r\nWhy it's important in system design:","\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Component"}),(0,t.jsx)(s.th,{children:"Role of TLS"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"API Gateway (e.g., NGINX, Envoy)"}),(0,t.jsx)(s.td,{children:"Terminates TLS, protects downstream services"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"CDN (e.g., Cloudflare)"}),(0,t.jsx)(s.td,{children:"Uses TLS to secure edge-to-origin traffic"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Microservices with mutual TLS (mTLS)"}),(0,t.jsx)(s.td,{children:"Authenticates both client and server, adds zero-trust security"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Mobile apps"}),(0,t.jsx)(s.td,{children:"Use TLS to securely communicate with backend servers"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"example-of-tls-handshake-with-nodejs",children:"Example of TLS Handshake with Node.js"}),"\n",(0,t.jsx)(s.p,{children:"Server"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:'const https = require("https");\r\nconst fs = require("fs");\r\n\r\nconst options = {\r\n  key: fs.readFileSync("server.key"), // Private key\r\n  cert: fs.readFileSync("server.crt"), // Certificate (signed by CA)\r\n};\r\n\r\nhttps\r\n  .createServer(options, (req, res) => {\r\n    res.writeHead(200);\r\n    res.end("Hello TLS-secured world!");\r\n  })\r\n  .listen(443);\n'})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:'const https = require("https");\r\n\r\nhttps.get("https://localhost", (res) => {\r\n  res.on("data", (d) => {\r\n    process.stdout.write(d);\r\n  });\r\n});\n'})}),"\n",(0,t.jsxs)(s.p,{children:["Under the hood, the ",(0,t.jsx)(s.code,{children:"https"})," module performs the entire TLS handshake automatically using Node's ",(0,t.jsx)(s.code,{children:"tls"})," module (part of OpenSSL)."]}),"\n",(0,t.jsx)(s.h2,{id:"tls-vs-tcp",children:"TLS vs TCP"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Feature"}),(0,t.jsx)(s.th,{children:"TCP"}),(0,t.jsx)(s.th,{children:"TLS"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Layer"}),(0,t.jsx)(s.td,{children:"Transport Layer (L4)"}),(0,t.jsx)(s.td,{children:"Application Layer (L5\u20136)"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Security"}),(0,t.jsx)(s.td,{children:"None"}),(0,t.jsx)(s.td,{children:"Provides encryption, authentication"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Handshake"}),(0,t.jsx)(s.td,{children:"3-way"}),(0,t.jsx)(s.td,{children:"Multi-step handshake with cryptographic exchange"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Used In"}),(0,t.jsx)(s.td,{children:"HTTP, FTP, DB"}),(0,t.jsx)(s.td,{children:"HTTPS, SMTPS, secure APIs, VPN"})]})]})]})]})}function o(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},28453(e,s,n){n.d(s,{R:()=>d,x:()=>l});var r=n(96540);const t={},i=r.createContext(t);function d(e){const s=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);