"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[14969],{28453(e,r,n){n.d(r,{R:()=>c,x:()=>d});var i=n(96540);const t={},s=i.createContext(t);function c(e){const r=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),i.createElement(s.Provider,{value:r},e.children)}},43743(e,r,n){n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>d,default:()=>a,frontMatter:()=>c,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"nginx/HTTP to HTTPS","title":"HTTP to HTTPS","description":"HTTP \u2192 HTTPS redirection forces all users who access your site over unencrypted HTTP (port 80) to be automatically redirected to encrypted HTTPS (port 443).","source":"@site/docs/nginx/17. HTTP to HTTPS.md","sourceDirName":"nginx","slug":"/nginx/HTTP to HTTPS","permalink":"/handbook/docs/nginx/HTTP to HTTPS","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":17,"frontMatter":{},"sidebar":"nginxApiSidebar","previous":{"title":"SSL_TLS setup","permalink":"/handbook/docs/nginx/SSL_TLS setup"},"next":{"title":"Rate Limiting","permalink":"/handbook/docs/nginx/Rate Limiting"}}');var t=n(74848),s=n(28453);const c={},d=void 0,l={},o=[{value:"Why Redirecting HTTP to HTTPS Is Critical for Security",id:"why-redirecting-http-to-https-is-critical-for-security",level:2},{value:"How HTTP \u2192 HTTPS Redirection Works in NGINX",id:"how-http--https-redirection-works-in-nginx",level:2},{value:"Recommended Redirect Status Codes",id:"recommended-redirect-status-codes",level:2},{value:"Best Practice: Separate HTTP Server Block",id:"best-practice-separate-http-server-block",level:2},{value:"Most Secure &amp; Clean Method",id:"most-secure--clean-method",level:3},{value:"Using 308 Redirect (Method-Preserving)",id:"using-308-redirect-method-preserving",level:3},{value:"Redirect with <code>rewrite</code> (Not Recommended)",id:"redirect-with-rewrite-not-recommended",level:3},{value:"Redirect Inside HTTPS Server Block",id:"redirect-inside-https-server-block",level:2},{value:"Redirect All Domains to One Canonical HTTPS Domain",id:"redirect-all-domains-to-one-canonical-https-domain",level:2},{value:"Combining HTTP \u2192 HTTPS Redirect with SSL Config",id:"combining-http--https-redirect-with-ssl-config",level:2},{value:"Enforcing HTTPS with HSTS (Advanced Security)",id:"enforcing-https-with-hsts-advanced-security",level:2},{value:"Common Security Mistakes",id:"common-security-mistakes",level:2},{value:"How to Test HTTP \u2192 HTTPS Redirect",id:"how-to-test-http--https-redirect",level:2}];function h(e){const r={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.p,{children:"HTTP \u2192 HTTPS redirection forces all users who access your site over unencrypted HTTP (port 80) to be automatically redirected to encrypted HTTPS (port 443)."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"http://example.com/page \u2192 https://example.com/page\n"})}),"\n",(0,t.jsx)(r.p,{children:"This is a fundamental web security control."}),"\n",(0,t.jsx)(r.h2,{id:"why-redirecting-http-to-https-is-critical-for-security",children:"Why Redirecting HTTP to HTTPS Is Critical for Security"}),"\n",(0,t.jsx)(r.p,{children:"Without HTTPS redirection:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Credentials can be sniffed on public Wi-Fi"}),"\n",(0,t.jsx)(r.li,{children:"Session cookies can be stolen"}),"\n",(0,t.jsx)(r.li,{children:"Data can be modified in transit"}),"\n",(0,t.jsx)(r.li,{children:"Users can be subjected to MITM (Man-in-the-Middle) attacks"}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"Redirecting HTTP \u2192 HTTPS ensures:"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Security Property"}),(0,t.jsx)(r.th,{children:"Benefit"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Confidentiality"}),(0,t.jsx)(r.td,{children:"Traffic is encrypted"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Integrity"}),(0,t.jsx)(r.td,{children:"Data cannot be modified"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Authentication"}),(0,t.jsx)(r.td,{children:"Server identity verified"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Trust"}),(0,t.jsx)(r.td,{children:"Browser shows secure lock \ud83d\udd12"})]})]})]}),"\n",(0,t.jsx)(r.h2,{id:"how-http--https-redirection-works-in-nginx",children:"How HTTP \u2192 HTTPS Redirection Works in NGINX"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"Client connects via HTTP (port 80)"}),"\n",(0,t.jsx)(r.li,{children:"NGINX responds with a 301 or 308 redirect"}),"\n",(0,t.jsx)(r.li,{children:"Browser requests the same URL over HTTPS"}),"\n",(0,t.jsx)(r.li,{children:"Secure TLS connection is established"}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"recommended-redirect-status-codes",children:"Recommended Redirect Status Codes"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Code"}),(0,t.jsx)(r.th,{children:"Meaning"}),(0,t.jsx)(r.th,{children:"Recommended?"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"301"})}),(0,t.jsx)(r.td,{children:"Permanent redirect"}),(0,t.jsx)(r.td,{children:"\u2705 Yes"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"308"})}),(0,t.jsx)(r.td,{children:"Permanent redirect (method preserved)"}),(0,t.jsx)(r.td,{children:"\u2705 Best"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"302"}),(0,t.jsx)(r.td,{children:"Temporary"}),(0,t.jsx)(r.td,{children:"\u274c No"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"307"}),(0,t.jsx)(r.td,{children:"Temporary (method preserved)"}),(0,t.jsx)(r.td,{children:"\u274c No"})]})]})]}),"\n",(0,t.jsx)(r.p,{children:"Best practice: Use 301 or 308"}),"\n",(0,t.jsx)(r.h2,{id:"best-practice-separate-http-server-block",children:"Best Practice: Separate HTTP Server Block"}),"\n",(0,t.jsx)(r.h3,{id:"most-secure--clean-method",children:"Most Secure & Clean Method"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"server {\r\n    listen 80;\r\n    server_name example.com www.example.com;\r\n\r\n    return 301 https://$host$request_uri;\r\n}\n"})}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Directive"}),(0,t.jsx)(r.th,{children:"Purpose"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"listen 80"})}),(0,t.jsx)(r.td,{children:"Accept HTTP traffic"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"server_name"})}),(0,t.jsx)(r.td,{children:"Match domain"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"return 301"})}),(0,t.jsx)(r.td,{children:"Send permanent redirect"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"$host$request_uri"})}),(0,t.jsx)(r.td,{children:"Preserve domain + path"})]})]})]}),"\n",(0,t.jsx)(r.h3,{id:"using-308-redirect-method-preserving",children:"Using 308 Redirect (Method-Preserving)"}),"\n",(0,t.jsx)(r.p,{children:"Why 308?"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Preserves HTTP methods (POST, PUT)"}),"\n",(0,t.jsx)(r.li,{children:"Prevents form resubmission issues"}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"server {\r\n    listen 80;\r\n    server_name example.com;\r\n\r\n    return 308 https://$host$request_uri;\r\n}\n"})}),"\n",(0,t.jsx)(r.p,{children:"Ideal for APIs and REST services."}),"\n",(0,t.jsxs)(r.h3,{id:"redirect-with-rewrite-not-recommended",children:["Redirect with ",(0,t.jsx)(r.code,{children:"rewrite"})," (Not Recommended)"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"server {\r\n    listen 80;\r\n    server_name example.com;\r\n\r\n    rewrite ^ https://$host$request_uri? permanent;\r\n}\n"})}),"\n",(0,t.jsx)(r.p,{children:"Problems:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["Slower than ",(0,t.jsx)(r.code,{children:"return"})]}),"\n",(0,t.jsx)(r.li,{children:"Harder to read"}),"\n",(0,t.jsx)(r.li,{children:"Regex overhead"}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"Works, but avoid unless necessary"}),"\n",(0,t.jsx)(r.h2,{id:"redirect-inside-https-server-block",children:"Redirect Inside HTTPS Server Block"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"server {\r\n    listen 443 ssl;\r\n    return 301 https://$host$request_uri;\r\n}\n"})}),"\n",(0,t.jsx)(r.p,{children:"This causes:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Infinite redirect loops"}),"\n",(0,t.jsx)(r.li,{children:"Broken SSL negotiation"}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"redirect-all-domains-to-one-canonical-https-domain",children:"Redirect All Domains to One Canonical HTTPS Domain"}),"\n",(0,t.jsxs)(r.p,{children:["Example: redirect ",(0,t.jsx)(r.code,{children:"www"})," \u2192 non-",(0,t.jsx)(r.code,{children:"www"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"server {\r\n    listen 80;\r\n    server_name www.example.com;\r\n    return 301 https://example.com$request_uri;\r\n}\n"})}),"\n",(0,t.jsx)(r.p,{children:"HTTPS version:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"server {\r\n    listen 443 ssl;\r\n    server_name www.example.com;\r\n\r\n    ssl_certificate     /path/fullchain.pem;\r\n    ssl_certificate_key /path/privkey.pem;\r\n\r\n    return 301 https://example.com$request_uri;\r\n}\n"})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Prevents duplicate content"}),"\n",(0,t.jsx)(r.li,{children:"Improves SEO"}),"\n",(0,t.jsx)(r.li,{children:"Simplifies certificates"}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"combining-http--https-redirect-with-ssl-config",children:"Combining HTTP \u2192 HTTPS Redirect with SSL Config"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"# HTTP \u2192 HTTPS\r\nserver {\r\n    listen 80;\r\n    server_name example.com www.example.com;\r\n    return 301 https://example.com$request_uri;\r\n}\r\n\r\n# HTTPS Server\r\nserver {\r\n    listen 443 ssl http2;\r\n    server_name example.com;\r\n\r\n    ssl_certificate     /etc/letsencrypt/live/example.com/fullchain.pem;\r\n    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;\r\n\r\n    root /var/www/html;\r\n    index index.html;\r\n}\n"})}),"\n",(0,t.jsx)(r.h2,{id:"enforcing-https-with-hsts-advanced-security",children:"Enforcing HTTPS with HSTS (Advanced Security)"}),"\n",(0,t.jsx)(r.p,{children:"HTTP Strict Transport Security tells browsers:"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"\u201cNever use HTTP for this site again\u201d"}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:'add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;\n'})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Effect:"})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Browser skips HTTP entirely"}),"\n",(0,t.jsx)(r.li,{children:"Protects against SSL stripping attacks"}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Warning:"})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"HSTS is hard to undo"}),"\n",(0,t.jsx)(r.li,{children:"Enable only after HTTPS works perfectly"}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"common-security-mistakes",children:"Common Security Mistakes"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Mistake"}),(0,t.jsx)(r.th,{children:"Risk"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Using 302 instead of 301"}),(0,t.jsx)(r.td,{children:"Downgrade attacks"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Redirecting in HTTPS block"}),(0,t.jsx)(r.td,{children:"Redirect loop"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsxs)(r.td,{children:["Forgetting ",(0,t.jsx)(r.code,{children:"$request_uri"})]}),(0,t.jsx)(r.td,{children:"Broken URLs"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Not redirecting all domains"}),(0,t.jsx)(r.td,{children:"Inconsistent security"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"No HSTS"}),(0,t.jsx)(r.td,{children:"SSL stripping possible"})]})]})]}),"\n",(0,t.jsx)(r.h2,{id:"how-to-test-http--https-redirect",children:"How to Test HTTP \u2192 HTTPS Redirect"}),"\n",(0,t.jsx)(r.p,{children:"CLI Test"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"curl -I http://example.com\n"})}),"\n",(0,t.jsx)(r.p,{children:"Expected:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"HTTP/1.1 301 Moved Permanently\r\nLocation: https://example.com/\n"})}),"\n",(0,t.jsx)(r.p,{children:"Browser Test"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["Enter ",(0,t.jsx)(r.code,{children:"http://example.com"})]}),"\n",(0,t.jsx)(r.li,{children:"Should auto-switch to HTTPS"}),"\n"]})]})}function a(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}}}]);