"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[4704],{28453(e,n,s){s.d(n,{R:()=>c,x:()=>a});var i=s(96540);const r={},t=i.createContext(r);function c(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(t.Provider,{value:n},e.children)}},53600(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"rest-api-design/E-Tag","title":"E-Tag","description":"ETag (short for Entity Tag) is a mechanism used in HTTP headers to manage web cache validation and optimistic concurrency control. It is part of the HTTP specification (defined in RFC 7232) and is commonly used in REST APIs to:","source":"@site/docs/rest-api-design/8. E-Tag.md","sourceDirName":"rest-api-design","slug":"/rest-api-design/E-Tag","permalink":"/handbook/docs/rest-api-design/E-Tag","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"title":"E-Tag","sidebar_position":10},"sidebar":"restApiSidebar","previous":{"title":"Cache Control","permalink":"/handbook/docs/rest-api-design/Cache Control"},"next":{"title":"API Versioning","permalink":"/handbook/docs/rest-api-design/API Versioning"}}');var r=s(74848),t=s(28453);const c={title:"E-Tag",sidebar_position:10},a=void 0,o={},l=[{value:"How E-Tag Works",id:"how-e-tag-works",level:2},{value:"Caching with <code>If-None-Match</code>",id:"caching-with-if-none-match",level:2},{value:"Client Request (initial GET)",id:"client-request-initial-get",level:3},{value:"Server Response",id:"server-response",level:3},{value:"Client Request (subsequent GET with ETag)",id:"client-request-subsequent-get-with-etag",level:3},{value:"Server Response (not modified)",id:"server-response-not-modified",level:3},{value:"Optimistic Concurrency Control with <code>If-Match</code>",id:"optimistic-concurrency-control-with-if-match",level:2},{value:"Generating ETags",id:"generating-etags",level:2}];function d(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"ETag (short for Entity Tag) is a mechanism used in HTTP headers to manage web cache validation and optimistic concurrency control. It is part of the HTTP specification (defined in RFC 7232) and is commonly used in REST APIs to:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Avoid unnecessary data transfers (by caching and validating resources)."}),"\n",(0,r.jsx)(n.li,{children:"Prevent lost updates (by safely updating only the latest version of a resource)."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"how-e-tag-works",children:"How E-Tag Works"}),"\n",(0,r.jsxs)(n.p,{children:["When a client retrieves a resource via a ",(0,r.jsx)(n.code,{children:"GET"})," request, the server responds with an ",(0,r.jsx)(n.code,{children:"ETag"})," header. This ",(0,r.jsx)(n.code,{children:"ETag"})," is a hash or version identifier representing the current state of the resource."]}),"\n",(0,r.jsx)(n.p,{children:"The client can then:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Send that ETag back to the server on subsequent requests using conditional headers:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"If-None-Match"})," (for ",(0,r.jsx)(n.code,{children:"GET"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"If-Match"})," (for ",(0,r.jsx)(n.code,{children:"PUT"}),", ",(0,r.jsx)(n.code,{children:"DELETE"}),", etc.)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The server compares the sent ETag with the current version and acts accordingly."}),"\n",(0,r.jsxs)(n.h2,{id:"caching-with-if-none-match",children:["Caching with ",(0,r.jsx)(n.code,{children:"If-None-Match"})]}),"\n",(0,r.jsx)(n.h3,{id:"client-request-initial-get",children:"Client Request (initial GET)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"GET /products/123 HTTP/1.1\r\nHost: api.example.com\n"})}),"\n",(0,r.jsx)(n.h3,{id:"server-response",children:"Server Response"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'HTTP/1.1 200 OK\r\nETag: "abc123"\r\nContent-Type: application/json\r\n\r\n{\r\n  "id": 123,\r\n  "name": "Wireless Mouse",\r\n  "price": 29.99\r\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"client-request-subsequent-get-with-etag",children:"Client Request (subsequent GET with ETag)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'GET /products/123 HTTP/1.1\r\nHost: api.example.com\r\nIf-None-Match: "abc123"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"server-response-not-modified",children:"Server Response (not modified)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"HTTP/1.1 304 Not Modified\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Benefit:"})," Saves bandwidth and reduces server load if the resource hasn\u2019t changed."]}),"\n",(0,r.jsxs)(n.h2,{id:"optimistic-concurrency-control-with-if-match",children:["Optimistic Concurrency Control with ",(0,r.jsx)(n.code,{children:"If-Match"})]}),"\n",(0,r.jsx)(n.p,{children:"Client Wants to Update a Product:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["It first ",(0,r.jsx)(n.code,{children:"GET"}),"s the product and receives:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'ETag: "abc123"\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["It modifies the data locally and sends a ",(0,r.jsx)(n.code,{children:"PUT"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'PUT /products/123 HTTP/1.1\r\nHost: api.example.com\r\nIf-Match: "abc123"\r\nContent-Type: application/json\r\n\r\n{\r\n  "name": "Wireless Mouse",\r\n  "price": 24.99\r\n}\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Server checks the current ETag. If it still matches ",(0,r.jsx)(n.code,{children:"abc123"}),", the update is accepted. If another client has already modified it, the ETag would be different."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"If Outdated"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"HTTP/1.1 412 Precondition Failed\n"})}),"\n",(0,r.jsx)(n.h2,{id:"generating-etags",children:"Generating ETags"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Weak ETags:"})," prefixed with W/, allow for semantically equivalent content changes."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'ETag: W/"xyz456"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Strong ETags:"})," strict bit-by-bit comparison."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'ETag: "abc123"\n'})}),"\n",(0,r.jsx)(n.p,{children:"ETags can be:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A hash of the resource (e.g. MD5 or SHA)."}),"\n",(0,r.jsxs)(n.li,{children:["A version number, timestamp, or database record version field (e.g., ",(0,r.jsx)(n.code,{children:"updated_at"}),", ",(0,r.jsx)(n.code,{children:"row_version"}),")."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);