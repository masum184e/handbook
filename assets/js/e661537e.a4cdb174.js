"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[88645],{28453(r,e,n){n.d(e,{R:()=>t,x:()=>o});var i=n(96540);const s={},l=i.createContext(s);function t(r){const e=i.useContext(l);return i.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function o(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(s):r.components||s:t(r.components),i.createElement(l.Provider,{value:e},r.children)}},85619(r,e,n){n.r(e),n.d(e,{assets:()=>d,contentTitle:()=>o,default:()=>a,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"rust/Error Handling.md/thiserror & anyhow","title":"thiserror & anyhow","description":"| Crate       | Best for     | Error type style                       |","source":"@site/docs/rust/12. Error Handling.md/6. thiserror & anyhow.md","sourceDirName":"rust/12. Error Handling.md","slug":"/rust/Error Handling.md/thiserror & anyhow","permalink":"/handbook/docs/rust/Error Handling.md/thiserror & anyhow","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{},"sidebar":"rustApiSidebar","previous":{"title":"Custom Error Types","permalink":"/handbook/docs/rust/Error Handling.md/Custom Error Types"},"next":{"title":"Modules","permalink":"/handbook/docs/rust/Project Structure/Modules"}}');var s=n(74848),l=n(28453);const t={},o=void 0,d={},c=[{value:"<code>thiserror</code> \u2014 Ergonomic custom error types",id:"thiserror--ergonomic-custom-error-types",level:2},{value:"Example: Library-style error with <code>thiserror</code>",id:"example-library-style-error-with-thiserror",level:3},{value:"<code>anyhow</code> \u2014 Flexible error handling for applications",id:"anyhow--flexible-error-handling-for-applications",level:2},{value:"Example: Application-style error handling with anyhow",id:"example-application-style-error-handling-with-anyhow",level:3},{value:"Using <code>thiserror</code> + <code>anyhow</code> together",id:"using-thiserror--anyhow-together",level:2},{value:"Example: Library + App integration",id:"example-library--app-integration",level:3},{value:"Key Differences",id:"key-differences",level:2},{value:"When not to use <code>anyhow</code>",id:"when-not-to-use-anyhow",level:2},{value:"Summary",id:"summary",level:2}];function h(r){const e={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...r.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"Crate"}),(0,s.jsx)(e.th,{children:"Best for"}),(0,s.jsx)(e.th,{children:"Error type style"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"thiserror"})}),(0,s.jsx)(e.td,{children:"Libraries"}),(0,s.jsx)(e.td,{children:"Strongly typed, structured errors"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"anyhow"})}),(0,s.jsx)(e.td,{children:"Applications"}),(0,s.jsx)(e.td,{children:"Flexible, dynamic, context-rich errors"})]})]})]}),"\n",(0,s.jsx)(e.p,{children:"Think of it like this:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Libraries \u2192 use ",(0,s.jsx)(e.code,{children:"thiserror"})]}),"\n",(0,s.jsxs)(e.li,{children:["Applications / binaries \u2192 use ",(0,s.jsx)(e.code,{children:"anyhow"})]}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"thiserror--ergonomic-custom-error-types",children:[(0,s.jsx)(e.code,{children:"thiserror"})," \u2014 Ergonomic custom error types"]}),"\n",(0,s.jsx)(e.p,{children:"Writing custom error types manually requires:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Implementing ",(0,s.jsx)(e.code,{children:"Display"})]}),"\n",(0,s.jsxs)(e.li,{children:["Implementing ",(0,s.jsx)(e.code,{children:"Error"})]}),"\n",(0,s.jsxs)(e.li,{children:["Implementing ",(0,s.jsx)(e.code,{children:"From"})," for wrapped errors"]}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"thiserror"})," generates all of that for you using derive macros."]}),"\n",(0,s.jsxs)(e.h3,{id:"example-library-style-error-with-thiserror",children:["Example: Library-style error with ",(0,s.jsx)(e.code,{children:"thiserror"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use thiserror::Error;\r\nuse std::io;\r\nuse std::num::ParseIntError;\r\n\r\n#[derive(Debug, Error)]\r\npub enum ConfigError {\r\n    #[error("I/O error while reading config: {0}")]\r\n    Io(#[from] io::Error),\r\n\r\n    #[error("Invalid number in config: {0}")]\r\n    Parse(#[from] ParseIntError),\r\n\r\n    #[error("Missing required field: {0}")]\r\n    MissingField(String),\r\n}\r\n\r\npub fn read_config_number(path: &str) -> Result<i32, ConfigError> {\r\n    let contents = std::fs::read_to_string(path)?;\r\n    let number = contents.trim().parse::<i32>()?;\r\n    Ok(number)\r\n}\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"#[derive(Error)]"})," automatically:","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Implements ",(0,s.jsx)(e.code,{children:"std::error::Error"})]}),"\n",(0,s.jsxs)(e.li,{children:["Implements ",(0,s.jsx)(e.code,{children:"Display"})," using ",(0,s.jsx)(e.code,{children:"#[error(...)]"})]}),"\n",(0,s.jsxs)(e.li,{children:["Implements ",(0,s.jsx)(e.code,{children:"From"})," for variants marked with ",(0,s.jsx)(e.code,{children:"#[from]"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Callers can match on ",(0,s.jsx)(e.code,{children:"ConfigError"})," variants."]}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"anyhow--flexible-error-handling-for-applications",children:[(0,s.jsx)(e.code,{children:"anyhow"})," \u2014 Flexible error handling for applications"]}),"\n",(0,s.jsx)(e.p,{children:"In applications:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"You often don\u2019t care exactly which error type occurred."}),"\n",(0,s.jsxs)(e.li,{children:["You want:","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Easy error propagation"}),"\n",(0,s.jsx)(e.li,{children:"Rich context"}),"\n",(0,s.jsx)(e.li,{children:"Good backtraces"}),"\n",(0,s.jsx)(e.li,{children:"Minimal boilerplate"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"anyhow"})," provides a single error type: ",(0,s.jsx)(e.code,{children:"anyhow::Error"}),"."]}),"\n",(0,s.jsx)(e.h3,{id:"example-application-style-error-handling-with-anyhow",children:"Example: Application-style error handling with anyhow"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use anyhow::{Context, Result};\r\n\r\nfn read_number(path: &str) -> Result<i32> {\r\n    let contents = std::fs::read_to_string(path)\r\n        .with_context(|| format!("Failed to read file \'{}\'", path))?;\r\n\r\n    let number = contents\r\n        .trim()\r\n        .parse::<i32>()\r\n        .context("Failed to parse number from file")?;\r\n\r\n    Ok(number)\r\n}\r\n\r\nfn main() -> Result<()> {\r\n    let n = read_number("number.txt")?;\r\n    println!("Number: {}", n);\r\n    Ok(())\r\n}\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"Result<T>"})," is shorthand for ",(0,s.jsx)(e.code,{children:"Result<T, anyhow::Error>"}),"."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:".context(...)"})," and ",(0,s.jsx)(e.code,{children:".with_context(...)"})," add helpful messages."]}),"\n",(0,s.jsxs)(e.li,{children:["Errors automatically carry:","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"The original cause"}),"\n",(0,s.jsx)(e.li,{children:"A context chain"}),"\n",(0,s.jsx)(e.li,{children:"A backtrace (when enabled)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"using-thiserror--anyhow-together",children:["Using ",(0,s.jsx)(e.code,{children:"thiserror"})," + ",(0,s.jsx)(e.code,{children:"anyhow"})," together"]}),"\n",(0,s.jsx)(e.p,{children:"This is very common:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Library code uses ",(0,s.jsx)(e.code,{children:"thiserror"}),"."]}),"\n",(0,s.jsxs)(e.li,{children:["Application code uses ",(0,s.jsx)(e.code,{children:"anyhow"})," and converts library errors automatically."]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"example-library--app-integration",children:"Example: Library + App integration"}),"\n",(0,s.jsx)(e.p,{children:"Library crate:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use thiserror::Error;\r\nuse std::io;\r\nuse std::num::ParseIntError;\r\n\r\n#[derive(Debug, Error)]\r\npub enum DataError {\r\n    #[error("I/O error: {0}")]\r\n    Io(#[from] io::Error),\r\n\r\n    #[error("Parse error: {0}")]\r\n    Parse(#[from] ParseIntError),\r\n}\r\n\r\npub fn read_data(path: &str) -> Result<i32, DataError> {\r\n    let contents = std::fs::read_to_string(path)?;\r\n    let number = contents.trim().parse::<i32>()?;\r\n    Ok(number)\r\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"Application crate:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-rust",children:'use anyhow::Result;\r\nuse mylib::read_data;\r\n\r\nfn main() -> Result<()> {\r\n    let value = read_data("data.txt")?;\r\n    println!("Value: {}", value);\r\n    Ok(())\r\n}\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"DataError"})," automatically converts into ",(0,s.jsx)(e.code,{children:"anyhow::Error"}),"."]}),"\n",(0,s.jsx)(e.li,{children:"You get structured errors in the library and flexible handling in the app."}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"key-differences",children:"Key Differences"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"Feature"}),(0,s.jsx)(e.th,{children:(0,s.jsx)(e.code,{children:"thiserror"})}),(0,s.jsx)(e.th,{children:(0,s.jsx)(e.code,{children:"anyhow"})})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Error type"}),(0,s.jsx)(e.td,{children:"Your own enum/struct"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"anyhow::Error"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Best for"}),(0,s.jsx)(e.td,{children:"Libraries"}),(0,s.jsx)(e.td,{children:"Applications"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Error matching"}),(0,s.jsxs)(e.td,{children:["Yes (",(0,s.jsx)(e.code,{children:"match"})," on variants)"]}),(0,s.jsx)(e.td,{children:"No (opaque type)"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Context messages"}),(0,s.jsx)(e.td,{children:"Manual"}),(0,s.jsxs)(e.td,{children:["Built-in (",(0,s.jsx)(e.code,{children:"context"}),", ",(0,s.jsx)(e.code,{children:"with_context"}),")"]})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Backtraces"}),(0,s.jsx)(e.td,{children:"Via std / feature"}),(0,s.jsx)(e.td,{children:"Built-in support"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Boilerplate"}),(0,s.jsx)(e.td,{children:"Low"}),(0,s.jsx)(e.td,{children:"Very low"})]})]})]}),"\n",(0,s.jsxs)(e.h2,{id:"when-not-to-use-anyhow",children:["When not to use ",(0,s.jsx)(e.code,{children:"anyhow"})]}),"\n",(0,s.jsxs)(e.p,{children:["Avoid ",(0,s.jsx)(e.code,{children:"anyhow"})," in:"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Public library APIs"}),"\n",(0,s.jsx)(e.li,{children:"Code where callers must distinguish error types"}),"\n",(0,s.jsx)(e.li,{children:"Low-level libraries"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["Use ",(0,s.jsx)(e.code,{children:"thiserror"})," instead."]}),"\n",(0,s.jsx)(e.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"thiserror"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Use for defining clean, typed, structured error enums."}),"\n",(0,s.jsx)(e.li,{children:"Ideal for libraries and reusable modules."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"anyhow"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Use for application-level error handling."}),"\n",(0,s.jsx)(e.li,{children:"Provides easy propagation, context, and backtraces."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Together, they give you:","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Strong typing internally"}),"\n",(0,s.jsx)(e.li,{children:"Flexible error handling at the top level"}),"\n"]}),"\n"]}),"\n"]})]})}function a(r={}){const{wrapper:e}={...(0,l.R)(),...r.components};return e?(0,s.jsx)(e,{...r,children:(0,s.jsx)(h,{...r})}):h(r)}}}]);