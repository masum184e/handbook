"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[41830],{28453(e,n,r){r.d(n,{R:()=>c,x:()=>a});var s=r(96540);const i={},l=s.createContext(i);function c(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(l.Provider,{value:n},e.children)}},30368(e,n,r){r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"rust/Project Structure/Workspaces","title":"Workspaces","description":"A workspace is a way to group multiple related crates (binary and/or library) into one logical project.","source":"@site/docs/rust/13. Project Structure/5. Workspaces.md","sourceDirName":"rust/13. Project Structure","slug":"/rust/Project Structure/Workspaces","permalink":"/handbook/docs/rust/Project Structure/Workspaces","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"rustApiSidebar","previous":{"title":"Visibility","permalink":"/handbook/docs/rust/Project Structure/Visibility"},"next":{"title":"Dependency Management","permalink":"/handbook/docs/rust/Project Structure/Dependency Management"}}');var i=r(74848),l=r(28453);const c={},a=void 0,o={},d=[{value:"Why Workspaces Exist (Real Reason)",id:"why-workspaces-exist-real-reason",level:2},{value:"Basic Workspace Structure",id:"basic-workspace-structure",level:2},{value:"Workspace <code>Cargo.toml</code>",id:"workspace-cargotoml",level:2},{value:"Binary Crate Using Workspace Library",id:"binary-crate-using-workspace-library",level:2},{value:"Shared Cargo.lock and target/",id:"shared-cargolock-and-target",level:2},{value:"Running &amp; Building in a Workspace",id:"running--building-in-a-workspace",level:2},{value:"Workspace with Multiple Binaries",id:"workspace-with-multiple-binaries",level:2},{value:"Workspaces + Modules (How They Differ)",id:"workspaces--modules-how-they-differ",level:2},{value:"When Should You Create a Workspace?",id:"when-should-you-create-a-workspace",level:2},{value:"Real-World Example (Production Style)",id:"real-world-example-production-style",level:2},{value:"Workspace Dependency Inheritance (Advanced)",id:"workspace-dependency-inheritance-advanced",level:2},{value:"Publishing from a Workspace",id:"publishing-from-a-workspace",level:2},{value:"Common Workspace Mistakes",id:"common-workspace-mistakes",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Mental Model (Very Important)",id:"mental-model-very-important",level:2}];function t(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"A workspace is a way to group multiple related crates (binary and/or library) into one logical project."}),"\n",(0,i.jsx)(n.p,{children:"Key idea:"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"A workspace lets multiple crates share the same Cargo.lock, target directory, and dependency versions."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"So instead of one big crate, you build many small crates that work together."}),"\n",(0,i.jsx)(n.h2,{id:"why-workspaces-exist-real-reason",children:"Why Workspaces Exist (Real Reason)"}),"\n",(0,i.jsx)(n.p,{children:"Without workspaces, large projects become:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"tightly coupled"}),"\n",(0,i.jsx)(n.li,{children:"hard to test independently"}),"\n",(0,i.jsx)(n.li,{children:"slow to compile"}),"\n",(0,i.jsx)(n.li,{children:"messy to reuse"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Workspaces solve this by:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"separating concerns into crates"}),"\n",(0,i.jsx)(n.li,{children:"allowing parallel compilation"}),"\n",(0,i.jsx)(n.li,{children:"enabling clean boundaries"}),"\n",(0,i.jsx)(n.li,{children:"sharing dependencies efficiently"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"What a Workspace Is NOT"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A workspace is not a crate"}),"\n",(0,i.jsx)(n.li,{children:"A workspace has no code itself"}),"\n",(0,i.jsx)(n.li,{children:"A workspace does not compile to a binary or library"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"It is just an organizational layer."}),"\n",(0,i.jsx)(n.h2,{id:"basic-workspace-structure",children:"Basic Workspace Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"my_workspace/\r\n \u251c\u2500\u2500 Cargo.toml     // workspace manifest\r\n \u251c\u2500\u2500 Cargo.lock\r\n \u251c\u2500\u2500 target/\r\n \u251c\u2500\u2500 app/\r\n \u2502    \u251c\u2500\u2500 Cargo.toml\r\n \u2502    \u2514\u2500\u2500 src/\r\n \u2502         \u2514\u2500\u2500 main.rs\r\n \u2514\u2500\u2500 core/\r\n      \u251c\u2500\u2500 Cargo.toml\r\n      \u2514\u2500\u2500 src/\r\n           \u2514\u2500\u2500 lib.rs\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"app"})," \u2192 binary crate"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"core"})," \u2192 library crate"]}),"\n"]}),"\n",(0,i.jsxs)(n.h2,{id:"workspace-cargotoml",children:["Workspace ",(0,i.jsx)(n.code,{children:"Cargo.toml"})]}),"\n",(0,i.jsxs)(n.p,{children:["Root ",(0,i.jsx)(n.code,{children:"Cargo.toml"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[workspace]\r\nmembers = [\r\n    "app",\r\n    "core"\r\n]\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"This file defines the workspace"}),"\n",(0,i.jsxs)(n.li,{children:["No ",(0,i.jsx)(n.code,{children:"[package]"})," section"]}),"\n",(0,i.jsx)(n.li,{children:"Only workspace configuration"}),"\n"]}),"\n",(0,i.jsx)(n.h1,{id:"library-crate-inside-workspace",children:"Library Crate Inside Workspace"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"core/Cargo.toml"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[package]\r\nname = "core"\r\nversion = "0.1.0"\r\nedition = "2021"\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"core/src/lib.rs"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"pub fn add(a: i32, b: i32) -> i32 {\r\n    a + b\r\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"binary-crate-using-workspace-library",children:"Binary Crate Using Workspace Library"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"app/Cargo.toml"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[package]\r\nname = "app"\r\nversion = "0.1.0"\r\nedition = "2021"\r\n\r\n[dependencies]\r\ncore = { path = "../core" }\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"app/src/main.rs"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'use core::add;\r\n\r\nfn main() {\r\n    println!("{}", add(3, 4));\r\n}\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"core"})," is imported like a normal crate"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"path"})," points to workspace member"]}),"\n",(0,i.jsx)(n.li,{children:"No publishing required"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"shared-cargolock-and-target",children:"Shared Cargo.lock and target/"}),"\n",(0,i.jsx)(n.p,{children:"In a workspace:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"all crates share one Cargo.lock"}),"\n",(0,i.jsx)(n.li,{children:"all compiled artifacts go to one target/"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Benefits:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"consistent dependency versions"}),"\n",(0,i.jsx)(n.li,{children:"faster builds"}),"\n",(0,i.jsx)(n.li,{children:"less disk usage"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"running--building-in-a-workspace",children:"Running & Building in a Workspace"}),"\n",(0,i.jsx)(n.p,{children:"Build everything"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"cargo build\n"})}),"\n",(0,i.jsx)(n.p,{children:"Run a specific binary"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"cargo run -p app\n"})}),"\n",(0,i.jsx)(n.p,{children:"Test one crate"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"cargo test -p core\n"})}),"\n",(0,i.jsx)(n.h2,{id:"workspace-with-multiple-binaries",children:"Workspace with Multiple Binaries"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"my_workspace/\r\n \u251c\u2500\u2500 Cargo.toml\r\n \u251c\u2500\u2500 api/\r\n \u251c\u2500\u2500 cli/\r\n \u2514\u2500\u2500 shared/\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"api"})," \u2192 backend service"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cli"})," \u2192 command-line tool"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"shared"})," \u2192 common logic"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["All depend on ",(0,i.jsx)(n.code,{children:"shared"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"workspaces--modules-how-they-differ",children:"Workspaces + Modules (How They Differ)"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Concept"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Module"}),(0,i.jsxs)(n.td,{children:["Organize code ",(0,i.jsx)(n.strong,{children:"inside a crate"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Crate"}),(0,i.jsx)(n.td,{children:"Compilation unit"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Workspace"}),(0,i.jsxs)(n.td,{children:["Organize ",(0,i.jsx)(n.strong,{children:"multiple crates"})]})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"Rule of thumb:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"small separation \u2192 module"}),"\n",(0,i.jsx)(n.li,{children:"strong boundary \u2192 crate"}),"\n",(0,i.jsx)(n.li,{children:"multiple apps/libs \u2192 workspace"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"when-should-you-create-a-workspace",children:"When Should You Create a Workspace?"}),"\n",(0,i.jsx)(n.p,{children:"Use a workspace when:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"you have multiple binaries"}),"\n",(0,i.jsx)(n.li,{children:"you want shared libraries"}),"\n",(0,i.jsx)(n.li,{children:"compile time is growing"}),"\n",(0,i.jsx)(n.li,{children:"you plan to publish some crates"}),"\n",(0,i.jsx)(n.li,{children:"different teams own different parts"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"real-world-example-production-style",children:"Real-World Example (Production Style)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ecommerce/\r\n \u251c\u2500\u2500 Cargo.toml\r\n \u251c\u2500\u2500 auth/\r\n \u251c\u2500\u2500 payments/\r\n \u251c\u2500\u2500 inventory/\r\n \u251c\u2500\u2500 web/\r\n \u2514\u2500\u2500 common/\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"web"})," \u2192 frontend server (binary)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"auth"}),", ",(0,i.jsx)(n.code,{children:"payments"}),", ",(0,i.jsx)(n.code,{children:"inventory"})," \u2192 services"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"common"})," \u2192 shared types & utilities"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Each crate:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["has its own ",(0,i.jsx)(n.code,{children:"lib.rs"})," or ",(0,i.jsx)(n.code,{children:"main.rs"})]}),"\n",(0,i.jsx)(n.li,{children:"its own dependencies"}),"\n",(0,i.jsx)(n.li,{children:"clear API boundaries"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"workspace-dependency-inheritance-advanced",children:"Workspace Dependency Inheritance (Advanced)"}),"\n",(0,i.jsxs)(n.p,{children:["Root ",(0,i.jsx)(n.code,{children:"Cargo.toml"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[workspace.dependencies]\r\nserde = "1.0"\n'})}),"\n",(0,i.jsx)(n.p,{children:"Member crate"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:"[dependencies]\r\nserde = { workspace = true }\n"})}),"\n",(0,i.jsx)(n.p,{children:"This ensures:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"same version everywhere"}),"\n",(0,i.jsx)(n.li,{children:"no duplication"}),"\n",(0,i.jsx)(n.li,{children:"easy upgrades"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"publishing-from-a-workspace",children:"Publishing from a Workspace"}),"\n",(0,i.jsx)(n.p,{children:"You can:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"publish individual crates"}),"\n",(0,i.jsx)(n.li,{children:"keep others private"}),"\n",(0,i.jsxs)(n.li,{children:["share internal crates via ",(0,i.jsx)(n.code,{children:"path"})]}),"\n",(0,i.jsx)(n.li,{children:"Workspace does not affect publishing."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"common-workspace-mistakes",children:"Common Workspace Mistakes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Putting code in root"}),"\n",(0,i.jsx)(n.li,{children:"One crate with too many responsibilities"}),"\n",(0,i.jsx)(n.li,{children:"Circular dependencies between crates"}),"\n",(0,i.jsx)(n.li,{children:"Making everything a workspace too early"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Start with one crate"}),"\n",(0,i.jsx)(n.li,{children:"Extract crates when boundaries appear"}),"\n",(0,i.jsx)(n.li,{children:"Keep crates small and focused"}),"\n",(0,i.jsx)(n.li,{children:"Use pub(crate) for internal APIs"}),"\n",(0,i.jsx)(n.li,{children:"Re-export clean APIs from libraries"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"mental-model-very-important",children:"Mental Model (Very Important)"}),"\n",(0,i.jsx)(n.p,{children:"Think of Rust structure like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Workspace\r\n \u2514\u2500\u2500 Crates\r\n      \u2514\u2500\u2500 Modules\r\n           \u2514\u2500\u2500 Items\n"})}),"\n",(0,i.jsx)(n.p,{children:"Each layer has a clear responsibility."})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}}}]);