"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[291],{7446(n,e,t){t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"database-design/Transaction Management","title":"Transaction Management","description":"A transaction is a sequence of one or more SQL operations (INSERT, UPDATE, DELETE, SELECT) that form a single logical unit of work.","source":"@site/docs/database-design/21. Transaction Management.md","sourceDirName":"database-design","slug":"/database-design/Transaction Management","permalink":"/handbook/docs/database-design/Transaction Management","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":22,"frontMatter":{"sidebar_position":22}}');var s=t(4848),i=t(8453);const o={sidebar_position:22},a=void 0,c={},l=[{value:"Concurrency Control",id:"concurrency-control",level:2},{value:"Problems Without Concurrency Control",id:"problems-without-concurrency-control",level:3},{value:"Solutions (Concurrency Control Mechanisms)",id:"solutions-concurrency-control-mechanisms",level:3},{value:"Relation to Integrity in Database Design",id:"relation-to-integrity-in-database-design",level:2}];function d(n){const e={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.p,{children:"A transaction is a sequence of one or more SQL operations (INSERT, UPDATE, DELETE, SELECT) that form a single logical unit of work."}),"\n",(0,s.jsx)(e.p,{children:"The goal of transaction management:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Ensure ACID properties (Atomicity, Consistency, Isolation, Durability)."}),"\n",(0,s.jsx)(e.li,{children:"Handle failures (crashes, power loss, errors)."}),"\n",(0,s.jsx)(e.li,{children:"Ensure data integrity across multiple operations."}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"Suppose we want to transfer $500 from Alice\u2019s account to Bob\u2019s account."}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"BEGIN TRANSACTION;\r\n\r\nUPDATE Accounts SET balance = balance - 500 WHERE account_id = 1; -- Alice\r\nUPDATE Accounts SET balance = balance + 500 WHERE account_id = 2; -- Bob\r\n\r\nCOMMIT;\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"If both statements succeed \u2192 transaction is committed (durable)."}),"\n",(0,s.jsx)(e.li,{children:"If one statement fails (e.g., crash after debit but before credit) \u2192 transaction is rolled back (atomic)."}),"\n",(0,s.jsx)(e.li,{children:"Constraints like \u201cbalance \u2265 0\u201d enforce consistency."}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"concurrency-control",children:"Concurrency Control"}),"\n",(0,s.jsx)(e.p,{children:"When multiple transactions run at the same time, problems can occur if they interact with the same data.\r\nConcurrency control ensures that isolation is preserved without sacrificing too much performance."}),"\n",(0,s.jsx)(e.h3,{id:"problems-without-concurrency-control",children:"Problems Without Concurrency Control"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Dirty Read"})," \u2013 Reading uncommitted changes of another transaction.\r\nExample: T1 updates Alice\u2019s balance but hasn\u2019t committed; T2 reads it \u2192 later T1 rolls back \u2192 T2 read invalid data."]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Non-Repeatable Read"})," \u2013 Reading the same row twice gives different results because another transaction updated it in between."]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Phantom Read"})," \u2013 A transaction re-executes a query and sees new rows inserted by another transaction."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"solutions-concurrency-control-mechanisms",children:"Solutions (Concurrency Control Mechanisms)"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["Locking (Pessimistic Concurrency Control)","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Shared Lock (S-lock): For reading. Multiple readers allowed, but no writers."}),"\n",(0,s.jsx)(e.li,{children:"Exclusive Lock (X-lock): For writing. Only one transaction can hold it."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"Example:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"BEGIN TRANSACTION;\r\nSELECT balance FROM Accounts WHERE account_id = 1 FOR UPDATE;\r\n-- prevents others from reading/writing until commit/rollback\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"2",children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"Timestamp Ordering (Optimistic Concurrency Control)"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Transactions get timestamps; older ones get priority."}),"\n",(0,s.jsx)(e.li,{children:"Detects conflicts at commit time."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"Multiversion Concurrency Control (MVCC) (used in PostgreSQL, Oracle, etc.)"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Readers see a snapshot of the database at the start of their transaction."}),"\n",(0,s.jsx)(e.li,{children:"Writers create new versions instead of blocking readers."}),"\n",(0,s.jsx)(e.li,{children:"Prevents dirty reads and non-repeatable reads without heavy locking."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"relation-to-integrity-in-database-design",children:"Relation to Integrity in Database Design"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Entity integrity (PKs), Referential integrity (FKs), Domain integrity (constraints) work at the schema level."}),"\n",(0,s.jsx)(e.li,{children:"Transaction management & concurrency control ensure that these rules aren\u2019t violated at runtime."}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Example:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Referential integrity: Cannot delete a customer if orders exist (unless CASCADE)."}),"\n",(0,s.jsx)(e.li,{children:"If two transactions simultaneously try to delete and insert related records, locks/MVCC ensure the database remains consistent."}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},8453(n,e,t){t.d(e,{R:()=>o,x:()=>a});var r=t(6540);const s={},i=r.createContext(s);function o(n){const e=r.useContext(i);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:o(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);