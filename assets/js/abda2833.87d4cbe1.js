"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[1787],{28453(e,n,r){r.d(n,{R:()=>c,x:()=>l});var s=r(96540);const i={},d=s.createContext(i);function c(e){const n=s.useContext(d);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(d.Provider,{value:n},e.children)}},86842(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"rust/Project Structure/Dependency Management","title":"Dependency Management","description":"Cargo.toml is the manifest file of a Rust project.","source":"@site/docs/rust/13. Project Structure/6. Dependency Management.md","sourceDirName":"rust/13. Project Structure","slug":"/rust/Project Structure/Dependency Management","permalink":"/handbook/docs/rust/Project Structure/Dependency Management","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{}}');var i=r(74848),d=r(28453);const c={},l=void 0,a={},t=[{value:"Why <code>Cargo.toml</code> Matters in Project Structure",id:"why-cargotoml-matters-in-project-structure",level:2},{value:"Basic <code>Cargo.toml</code> Structure",id:"basic-cargotoml-structure",level:2},{value:"Binary vs Library Crates in <code>Cargo.toml</code>",id:"binary-vs-library-crates-in-cargotoml",level:2},{value:"Declaring Dependencies",id:"declaring-dependencies",level:2},{value:"Using Dependencies in Modules",id:"using-dependencies-in-modules",level:2},{value:"Dependency Versions (SemVer Rules)",id:"dependency-versions-semver-rules",level:2},{value:"Dev Dependencies",id:"dev-dependencies",level:2},{value:"Optional Dependencies &amp; Features",id:"optional-dependencies--features",level:2},{value:"Path Dependencies (Local Crates)",id:"path-dependencies-local-crates",level:2},{value:"Git Dependencies",id:"git-dependencies",level:2},{value:"Workspace Dependencies (Shared Versions)",id:"workspace-dependencies-shared-versions",level:2},{value:"Dependency Resolution &amp; <code>Cargo.lock</code>",id:"dependency-resolution--cargolock",level:2},{value:"Target-Specific Dependencies",id:"target-specific-dependencies",level:2},{value:"Dependency Features (Enabling APIs)",id:"dependency-features-enabling-apis",level:2},{value:"Example: Real Project Structure",id:"example-real-project-structure",level:2},{value:"How Cargo Connects to Modules",id:"how-cargo-connects-to-modules",level:2}];function o(e){const n={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Cargo.toml"})," is the manifest file of a Rust project."]}),"\n",(0,i.jsx)(n.p,{children:"It tells Cargo:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"what this project is"}),"\n",(0,i.jsx)(n.li,{children:"how it\u2019s structured"}),"\n",(0,i.jsx)(n.li,{children:"what it depends on"}),"\n",(0,i.jsx)(n.li,{children:"how it should be built"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Think of it as:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"package.json"})," (Node)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pom.xml"})," (Maven)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"go.mod"})," (Go)"]}),"\n"]}),"\n",(0,i.jsxs)(n.h2,{id:"why-cargotoml-matters-in-project-structure",children:["Why ",(0,i.jsx)(n.code,{children:"Cargo.toml"})," Matters in Project Structure"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Cargo.toml"})," defines:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"crate identity (name, version)"}),"\n",(0,i.jsx)(n.li,{children:"binary vs library"}),"\n",(0,i.jsx)(n.li,{children:"dependencies between crates"}),"\n",(0,i.jsx)(n.li,{children:"workspace layout"}),"\n",(0,i.jsx)(n.li,{children:"features and build behavior"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Without it, Rust code doesn\u2019t exist as a project."}),"\n",(0,i.jsxs)(n.h2,{id:"basic-cargotoml-structure",children:["Basic ",(0,i.jsx)(n.code,{children:"Cargo.toml"})," Structure"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[package]\r\nname = "my_app"\r\nversion = "0.1.0"\r\nedition = "2021"\n'})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Concept"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Module"}),(0,i.jsxs)(n.td,{children:["Organize code ",(0,i.jsx)(n.strong,{children:"inside a crate"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Crate"}),(0,i.jsx)(n.td,{children:"Compilation unit"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Workspace"}),(0,i.jsxs)(n.td,{children:["Organize ",(0,i.jsx)(n.strong,{children:"multiple crates"})]})]})]})]}),"\n",(0,i.jsxs)(n.h2,{id:"binary-vs-library-crates-in-cargotoml",children:["Binary vs Library Crates in ",(0,i.jsx)(n.code,{children:"Cargo.toml"})]}),"\n",(0,i.jsx)(n.p,{children:"Binary crate (default)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[package]\r\nname = "my_app"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Requires ",(0,i.jsx)(n.code,{children:"src/main.rs"})]}),"\n",(0,i.jsx)(n.li,{children:"Builds an executable\r\nLibrary crate"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[package]\r\nname = "my_lib"\r\n\r\n[lib]\r\nname = "my_lib"\r\npath = "src/lib.rs"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Produces a reusable library"}),"\n",(0,i.jsx)(n.li,{children:"Used by other crates"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Both Binary + Library"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"src/\r\n \u251c\u2500\u2500 main.rs\r\n \u2514\u2500\u2500 lib.rs\n"})}),"\n",(0,i.jsx)(n.p,{children:"Cargo automatically detects both\u2014no extra config needed."}),"\n",(0,i.jsx)(n.h2,{id:"declaring-dependencies",children:"Declaring Dependencies"}),"\n",(0,i.jsx)(n.p,{children:"Basic dependency"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[dependencies]\r\nserde = "1.0"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Fetches from crates.io"}),"\n",(0,i.jsxs)(n.li,{children:["Uses latest compatible ",(0,i.jsx)(n.code,{children:"1.x.x"})]}),"\n",(0,i.jsx)(n.li,{children:"Downloaded automatically"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"using-dependencies-in-modules",children:"Using Dependencies in Modules"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"use serde::Serialize;\r\n\r\n#[derive(Serialize)]\r\nstruct User {\r\n    name: String,\r\n}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Crate name becomes top-level path"}),"\n",(0,i.jsx)(n.li,{children:"Works in any module"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"dependency-versions-semver-rules",children:"Dependency Versions (SemVer Rules)"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Version"}),(0,i.jsx)(n.th,{children:"Meaning"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'"1.2.3"'})}),(0,i.jsx)(n.td,{children:"Exact version"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'"^1.2.3"'})}),(0,i.jsx)(n.td,{children:"Compatible updates"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'"~1.2.3"'})}),(0,i.jsx)(n.td,{children:"Patch updates only"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'"*"'})}),(0,i.jsx)(n.td,{children:"Any version (avoid)"})]})]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'serde = "^1.0"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"dev-dependencies",children:"Dev Dependencies"}),"\n",(0,i.jsx)(n.p,{children:"Used only for tests and examples."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[dev-dependencies]\r\ntokio = { version = "1", features = ["macros"] }\n'})}),"\n",(0,i.jsx)(n.p,{children:"Available in:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"tests"}),"\n",(0,i.jsx)(n.li,{children:"benchmarks"}),"\n",(0,i.jsx)(n.li,{children:"examples"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Not included in release builds."}),"\n",(0,i.jsx)(n.h2,{id:"optional-dependencies--features",children:"Optional Dependencies & Features"}),"\n",(0,i.jsx)(n.p,{children:"Defining features"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[features]\r\ndefault = ["json"]\r\njson = ["serde"]\n'})}),"\n",(0,i.jsx)(n.p,{children:"Optional dependency"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[dependencies]\r\nserde = { version = "1.0", optional = true }\n'})}),"\n",(0,i.jsx)(n.p,{children:"Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'#[cfg(feature = "json")]\r\nfn serialize() {}\n'})}),"\n",(0,i.jsx)(n.p,{children:"This enables conditional compilation."}),"\n",(0,i.jsx)(n.h2,{id:"path-dependencies-local-crates",children:"Path Dependencies (Local Crates)"}),"\n",(0,i.jsx)(n.p,{children:"Used in workspaces or local development."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[dependencies]\r\ncore = { path = "../core" }\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"No publishing required"}),"\n",(0,i.jsx)(n.li,{children:"Fast iteration"}),"\n",(0,i.jsx)(n.li,{children:"Common in monorepos"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"git-dependencies",children:"Git Dependencies"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[dependencies]\r\nmy_lib = { git = "https://github.com/user/my_lib", branch = "main" }\n'})}),"\n",(0,i.jsx)(n.p,{children:"Used when:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"dependency isn\u2019t on crates.io"}),"\n",(0,i.jsx)(n.li,{children:"testing unreleased features"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"workspace-dependencies-shared-versions",children:"Workspace Dependencies (Shared Versions)"}),"\n",(0,i.jsxs)(n.p,{children:["Root ",(0,i.jsx)(n.code,{children:"Cargo.toml"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[workspace]\r\nmembers = ["app", "core"]\r\n\r\n[workspace.dependencies]\r\nserde = "1.0"\n'})}),"\n",(0,i.jsx)(n.p,{children:"Member crate"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:"[dependencies]\r\nserde = { workspace = true }\n"})}),"\n",(0,i.jsx)(n.p,{children:"Guarantees:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"same version everywhere"}),"\n",(0,i.jsx)(n.li,{children:"no version conflicts"}),"\n"]}),"\n",(0,i.jsxs)(n.h2,{id:"dependency-resolution--cargolock",children:["Dependency Resolution & ",(0,i.jsx)(n.code,{children:"Cargo.lock"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"Cargo.lock"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Exact versions of dependencies"}),"\n",(0,i.jsx)(n.li,{children:"Ensures reproducible builds"}),"\n",(0,i.jsx)(n.li,{children:"Shared across workspace"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Rule:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["commit ",(0,i.jsx)(n.code,{children:"Cargo.lock"})," for binaries"]}),"\n",(0,i.jsx)(n.li,{children:"do NOT commit for libraries"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"target-specific-dependencies",children:"Target-Specific Dependencies"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:"[target.'cfg(windows)'.dependencies]\r\nwinapi = \"0.3\"\n"})}),"\n",(0,i.jsx)(n.p,{children:"Only compiled on Windows."}),"\n",(0,i.jsx)(n.h2,{id:"dependency-features-enabling-apis",children:"Dependency Features (Enabling APIs)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'tokio = { version = "1", features = ["rt-multi-thread", "macros"] }\n'})}),"\n",(0,i.jsx)(n.p,{children:"Features:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"enable extra functionality"}),"\n",(0,i.jsx)(n.li,{children:"reduce binary size"}),"\n",(0,i.jsx)(n.li,{children:"control behavior"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"example-real-project-structure",children:"Example: Real Project Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"my_workspace/\r\n \u251c\u2500\u2500 Cargo.toml\r\n \u251c\u2500\u2500 api/\r\n \u2502    \u2514\u2500\u2500 Cargo.toml\r\n \u2514\u2500\u2500 shared/\r\n      \u2514\u2500\u2500 Cargo.toml\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Root ",(0,i.jsx)(n.code,{children:"Cargo.toml"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[workspace]\r\nmembers = ["api", "shared"]\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"shared/Cargo.toml"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[package]\r\nname = "shared"\r\n\r\n[dependencies]\r\nserde = { workspace = true }\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"api/Cargo.toml"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[package]\r\nname = "api"\r\n\r\n[dependencies]\r\nshared = { path = "../shared" }\r\nserde = { workspace = true }\n'})}),"\n",(0,i.jsx)(n.h2,{id:"how-cargo-connects-to-modules",children:"How Cargo Connects to Modules"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Layer"}),(0,i.jsx)(n.th,{children:"Controlled By"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Workspace"}),(0,i.jsxs)(n.td,{children:["Root ",(0,i.jsx)(n.code,{children:"Cargo.toml"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Crate"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"[package]"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Modules"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"mod"})," / ",(0,i.jsx)(n.code,{children:"pub"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Dependencies"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"[dependencies]"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"Cargo handles crates, Rust handles modules."})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}}}]);