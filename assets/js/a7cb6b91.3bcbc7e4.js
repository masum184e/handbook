"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[9670],{4827(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>c,metadata:()=>d,toc:()=>a});const d=JSON.parse('{"id":"golang/Memory Allocation","title":"Memory Allocation","description":"1. Memory placement","source":"@site/docs/golang/12. Memory Allocation.md","sourceDirName":"golang","slug":"/golang/Memory Allocation","permalink":"/handbook/docs/golang/Memory Allocation","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"sidebar_position":13},"sidebar":"golangSidebar","previous":{"title":"Internal Memory","permalink":"/handbook/docs/golang/Internal Memory"},"next":{"title":"Error Handling","permalink":"/handbook/docs/golang/Error Handling"}}');var s=r(4848),o=r(8453);const c={sidebar_position:13},i=void 0,l={},a=[{value:"1. Memory placement",id:"1-memory-placement",level:3},{value:"2. <code>main()</code> stack frame created",id:"2-main-stack-frame-created",level:3},{value:"3. A new stack frame <code>add()</code> is pushed on top of <code>main()</code>",id:"3-a-new-stack-frame-add-is-pushed-on-top-of-main",level:3},{value:"4. Another stack frame is pushed on top of <code>add()</code>",id:"4-another-stack-frame-is-pushed-on-top-of-add",level:3},{value:"5. <code>show()</code> frame destroyed",id:"5-show-frame-destroyed",level:3},{value:"6. <code>add()</code> frame destroyed",id:"6-add-frame-destroyed",level:3},{value:"7. <code>mul()</code> frame is pushed on top of <code>main()</code>",id:"7-mul-frame-is-pushed-on-top-of-main",level:3},{value:"8. Another stack frame is pushed on top of <code>mul()</code>",id:"8-another-stack-frame-is-pushed-on-top-of-mul",level:3},{value:"9. <code>mul()</code> frame destroyed",id:"9-mul-frame-destroyed",level:3},{value:"10. <code>main()</code> frame popped",id:"10-main-frame-popped",level:3}];function t(e){const n={blockquote:"blockquote",code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'package main\r\n\r\nimport "fmt"\r\n\r\nvar a = 10\r\nvar b = 20\r\n\r\nfunc show(x int){\r\n\tfmt.Println(x)\r\n}\r\n\r\nfunc add(x int, y int){\r\n\tz := x + y\r\n\tshow(z)\r\n}\r\n\r\nfunc mul(x int){\r\n\tz := x*a\r\n\tfmt.Println(z)\r\n}\r\n\r\nfunc display(x int){\r\n    a := 100\r\n    mul(x)\r\n    fmt.Println(a)\r\n}\r\n\r\nfunc main(){\r\n\tp := 30\r\n\tq := 40\r\n    a := 40\r\n\r\n\tadd(p, q)\r\n\tmul(q)\r\n    \r\n    fmt.Print(a)\r\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"1-memory-placement",children:"1. Memory placement"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Item"}),(0,s.jsx)(n.th,{children:"Segment"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"show"}),", ",(0,s.jsx)(n.code,{children:"add"}),", ",(0,s.jsx)(n.code,{children:"mul"}),", ",(0,s.jsx)(n.code,{children:"display"}),", ",(0,s.jsx)(n.code,{children:"show"})]}),(0,s.jsx)(n.td,{children:"Code segment"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"a"}),", ",(0,s.jsx)(n.code,{children:"b"})]}),(0,s.jsx)(n.td,{children:"Data segment"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Function locals & params"}),(0,s.jsx)(n.td,{children:"Stack"})]})]})]}),"\n",(0,s.jsxs)(n.h3,{id:"2-main-stack-frame-created",children:["2. ",(0,s.jsx)(n.code,{children:"main()"})," stack frame created"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Stack:\r\n| main() |\r\n| p = 30 |\r\n| q = 40 |\r\n| a = 50 |\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"3-a-new-stack-frame-add-is-pushed-on-top-of-main",children:["3. A new stack frame ",(0,s.jsx)(n.code,{children:"add()"})," is pushed on top of ",(0,s.jsx)(n.code,{children:"main()"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Stack:\r\n| add(p, q) |\r\n|-----------|\r\n|   main()  |\r\n|   p = 30  |\r\n|   q = 40  |\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Inside ",(0,s.jsx)(n.code,{children:"add()"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-md",children:"Stack:\r\n| add(p, q) |\r\n|  x = 30   |\r\n|  y = 40   |\r\n|  z = 70   |\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"4-another-stack-frame-is-pushed-on-top-of-add",children:["4. Another stack frame is pushed on top of ",(0,s.jsx)(n.code,{children:"add()"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-md",children:"Stack:\r\n|  show(z)  |\r\n|-----------|\r\n| add(p, q) |\r\n|   z = 70  |\r\n|-----------|\r\n| main()    |\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Inside ",(0,s.jsx)(n.code,{children:"show() "})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-md",children:"Stack:\r\n| show(z) |\r\n| x = 70  |\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"70 is printed to stdout"}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"5-show-frame-destroyed",children:["5. ",(0,s.jsx)(n.code,{children:"show()"})," frame destroyed"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Stack:\r\n| add(p, q) |\r\n| z = 70    |\r\n|-----------|\r\n| main()    |\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"6-add-frame-destroyed",children:["6. ",(0,s.jsx)(n.code,{children:"add()"})," frame destroyed"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Stack:\r\n| main() |\r\n| p = 30 |\r\n| q = 40 |\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"7-mul-frame-is-pushed-on-top-of-main",children:["7. ",(0,s.jsx)(n.code,{children:"mul()"})," frame is pushed on top of ",(0,s.jsx)(n.code,{children:"main()"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"| mul(q) |\r\n|--------|\r\n| main() |\r\n| p = 30 |\r\n| q = 40 |\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Inside ",(0,s.jsx)(n.code,{children:"mul()"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Stack:\r\n| mul(q)    |\r\n| x = 40    |\r\n| z = 40*10 |\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"mul()"})," has no local ",(0,s.jsx)(n.code,{children:"a"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"main()"}),"\u2019s a is NOT visible here"]}),"\n",(0,s.jsxs)(n.li,{children:["So Go uses the package-level ",(0,s.jsx)(n.code,{children:"a"})]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["A function can only see identifiers declared in its ",(0,s.jsx)(n.strong,{children:"own scope"})," or in ",(0,s.jsx)(n.strong,{children:"enclosing (outer) scopes / lexical scope"})," \u2014 never in a caller\u2019s scope."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Scope hierarchy"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Universe scope\r\n  \u2193\r\nPackage scope\r\n  \u2193\r\nFile scope\r\n  \u2193\r\nFunction scope\r\n  \u2193\r\nBlock scope\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"How name lookup works (algorithm)"})}),"\n",(0,s.jsxs)(n.p,{children:["When the compiler sees an identifier like ",(0,s.jsx)(n.code,{children:"a"}),", it does this:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Look in the current scope"}),"\n",(0,s.jsx)(n.li,{children:"If not found, go to the immediate enclosing scope"}),"\n",(0,s.jsxs)(n.li,{children:["Repeat until:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Found \u2192 use it"}),"\n",(0,s.jsx)(n.li,{children:"Reach universe scope \u2192 error if still not found"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example lookup execution"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"a"})," isn't in block scope, theres nothing like (",(0,s.jsx)(n.code,{children:"{ ... }"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"a"})," isn't in that function scope"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"a"})," isn't in the file scope"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"a"})," is in package scope"]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Caller scopes are never part of this lookup"}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"8-another-stack-frame-is-pushed-on-top-of-mul",children:["8. Another stack frame is pushed on top of ",(0,s.jsx)(n.code,{children:"mul()"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Stack:\r\n| show(z)  |\r\n|----------|\r\n| mul(q)   |\r\n| z = x*a  |\r\n|----------|\r\n| main()   |\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"9-mul-frame-destroyed",children:["9. ",(0,s.jsx)(n.code,{children:"mul()"})," frame destroyed"]}),"\n",(0,s.jsxs)(n.h3,{id:"10-main-frame-popped",children:["10. ",(0,s.jsx)(n.code,{children:"main()"})," frame popped"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Runtime cleans up"}),"\n",(0,s.jsx)(n.li,{children:"Global memory released"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},8453(e,n,r){r.d(n,{R:()=>c,x:()=>i});var d=r(6540);const s={},o=d.createContext(s);function c(e){const n=d.useContext(o);return d.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),d.createElement(o.Provider,{value:n},e.children)}}}]);