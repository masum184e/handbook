"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[98905],{28453(e,r,n){n.d(r,{R:()=>t,x:()=>d});var s=n(96540);const l={},i=s.createContext(l);function t(e){const r=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),s.createElement(i.Provider,{value:r},e.children)}},97913(e,r,n){n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"nginx/Default Server Block","title":"Default Server Block","description":"The default server block is the server context NGINX uses when an incoming HTTP request does not match any server_name on the requested IP:port.","source":"@site/docs/nginx/13. Default Server Block.md","sourceDirName":"nginx","slug":"/nginx/Default Server Block","permalink":"/handbook/docs/nginx/Default Server Block","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":13,"frontMatter":{},"sidebar":"nginxApiSidebar","previous":{"title":"MIME Types","permalink":"/handbook/docs/nginx/MIME Types"},"next":{"title":"Index Files","permalink":"/handbook/docs/nginx/Index Files"}}');var l=n(74848),i=n(28453);const t={},d=void 0,c={},a=[{value:"When the Default Server Is Used",id:"when-the-default-server-is-used",level:2},{value:"How NGINX Chooses the Default Server",id:"how-nginx-chooses-the-default-server",level:2},{value:"<code>default_server</code> Directive",id:"default_server-directive",level:2},{value:"Simple Default Server Example",id:"simple-default-server-example",level:2},{value:"Example: Default vs Named Server Blocks",id:"example-default-vs-named-server-blocks",level:2},{value:"Role of <code>server_name _;</code>",id:"role-of-server_name-_",level:2},{value:"Default Server for HTTPS (Port 443)",id:"default-server-for-https-port-443",level:2},{value:"Default Server and <code>server_name</code> Matching Order",id:"default-server-and-server_name-matching-order",level:2},{value:"Common Use Cases for Default Server",id:"common-use-cases-for-default-server",level:2},{value:"Real-World Production Example",id:"real-world-production-example",level:2},{value:"Common Mistakes",id:"common-mistakes",level:2},{value:"Debugging Default Server Behavior",id:"debugging-default-server-behavior",level:2},{value:"Best Practices",id:"best-practices",level:2}];function o(e){const r={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(r.p,{children:["The ",(0,l.jsx)(r.strong,{children:"default server block"})," is the server context NGINX uses when an incoming HTTP request does not match any ",(0,l.jsx)(r.code,{children:"server_name"})," on the requested IP",":port","."]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.strong,{children:"In simple terms:"})}),"\n",(0,l.jsx)(r.p,{children:"If NGINX doesn\u2019t know which virtual host should handle a request, it uses the default server."}),"\n",(0,l.jsx)(r.h2,{id:"when-the-default-server-is-used",children:"When the Default Server Is Used"}),"\n",(0,l.jsx)(r.p,{children:"NGINX uses the default server when:"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["No ",(0,l.jsx)(r.code,{children:"server_name"})," matches the ",(0,l.jsx)(r.code,{children:"Host"})," header"]}),"\n",(0,l.jsxs)(r.li,{children:["The client sends no ",(0,l.jsx)(r.code,{children:"Host"})," header"]}),"\n",(0,l.jsx)(r.li,{children:"The request uses an IP address"}),"\n",(0,l.jsx)(r.li,{children:"The request is sent to an unexpected domain"}),"\n",(0,l.jsx)(r.li,{children:"A scanner or bot probes your server"}),"\n"]}),"\n",(0,l.jsx)(r.h2,{id:"how-nginx-chooses-the-default-server",children:"How NGINX Chooses the Default Server"}),"\n",(0,l.jsxs)(r.p,{children:["For each ",(0,l.jsxs)(r.strong,{children:["IP",":port"]})," combination, NGINX determines the default server as follows."]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.strong,{children:"Selection Rules (in order):"})}),"\n",(0,l.jsxs)(r.ol,{children:["\n",(0,l.jsxs)(r.li,{children:["The server marked with ",(0,l.jsx)(r.code,{children:"default_server"})]}),"\n",(0,l.jsxs)(r.li,{children:["If none marked \u2192 the first server defined for that IP",":port"]}),"\n"]}),"\n",(0,l.jsxs)(r.h2,{id:"default_server-directive",children:[(0,l.jsx)(r.code,{children:"default_server"})," Directive"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.strong,{children:"Syntax"})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-nginx",children:"listen 80 default_server;\n"})}),"\n",(0,l.jsx)(r.p,{children:"Context"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["Valid inside ",(0,l.jsx)(r.code,{children:"server"})," block"]}),"\n",(0,l.jsxs)(r.li,{children:["Applies per IP",":port"]}),"\n"]}),"\n",(0,l.jsx)(r.h2,{id:"simple-default-server-example",children:"Simple Default Server Example"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{children:"server {\r\n    listen 80 default_server;\r\n    server_name _;\r\n\r\n    return 444;\r\n}\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["Listens on port ",(0,l.jsx)(r.code,{children:"80"})]}),"\n",(0,l.jsx)(r.li,{children:"Catches all unmatched requests"}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"return 444"})," closes connection without response"]}),"\n",(0,l.jsxs)(r.li,{children:["Common ",(0,l.jsx)(r.code,{children:"anti-bot/security"})," pattern"]}),"\n"]}),"\n",(0,l.jsx)(r.h2,{id:"example-default-vs-named-server-blocks",children:"Example: Default vs Named Server Blocks"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{children:"server {\r\n    listen 80 default_server;\r\n    server_name _;\r\n    root /var/www/default;\r\n}\r\n\r\nserver {\r\n    listen 80;\r\n    server_name example.com;\r\n    root /var/www/example;\r\n}\n"})}),"\n",(0,l.jsx)(r.p,{children:"Request Handling"}),"\n",(0,l.jsxs)(r.table,{children:[(0,l.jsx)(r.thead,{children:(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.th,{children:"Request"}),(0,l.jsx)(r.th,{children:"Server Used"})]})}),(0,l.jsxs)(r.tbody,{children:[(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.a,{href:"http://example.com",children:"http://example.com"})}),(0,l.jsx)(r.td,{children:"example.com server"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.a,{href:"http://unknown.com",children:"http://unknown.com"})}),(0,l.jsx)(r.td,{children:"default server"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"http://IP_ADDRESS"}),(0,l.jsx)(r.td,{children:"default server"})]})]})]}),"\n",(0,l.jsxs)(r.h2,{id:"role-of-server_name-_",children:["Role of ",(0,l.jsx)(r.code,{children:"server_name _;"})]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{children:"server_name _;\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"_"})," is a convention, not a wildcard"]}),"\n",(0,l.jsx)(r.li,{children:"Ensures the block does not accidentally match a real hostname"}),"\n",(0,l.jsx)(r.li,{children:"Makes intent clear: \u201cthis is a catch-all server\u201d"}),"\n"]}),"\n",(0,l.jsx)(r.h2,{id:"default-server-for-https-port-443",children:"Default Server for HTTPS (Port 443)"}),"\n",(0,l.jsx)(r.p,{children:"HTTPS default servers are critical."}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{children:"server {\r\n    listen 443 ssl default_server;\r\n\r\n    ssl_certificate /etc/ssl/certs/default.crt;\r\n    ssl_certificate_key /etc/ssl/private/default.key;\r\n\r\n    return 444;\r\n}\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"TLS handshake requires a certificate"}),"\n",(0,l.jsx)(r.li,{children:"Default server handles unknown SNI names"}),"\n",(0,l.jsx)(r.li,{children:"Prevents certificate mismatch exposure"}),"\n"]}),"\n",(0,l.jsxs)(r.h2,{id:"default-server-and-server_name-matching-order",children:["Default Server and ",(0,l.jsx)(r.code,{children:"server_name"})," Matching Order"]}),"\n",(0,l.jsxs)(r.p,{children:["NGINX matches ",(0,l.jsx)(r.code,{children:"server_name"})," in this order:"]}),"\n",(0,l.jsxs)(r.ol,{children:["\n",(0,l.jsxs)(r.li,{children:["Exact names (",(0,l.jsx)(r.code,{children:"example.com"}),")"]}),"\n",(0,l.jsxs)(r.li,{children:["Wildcards (",(0,l.jsx)(r.code,{children:"*.example.com"}),")"]}),"\n",(0,l.jsxs)(r.li,{children:["Regex (",(0,l.jsx)(r.code,{children:"~^www\\d+\\.example\\.com$"}),")"]}),"\n",(0,l.jsx)(r.li,{children:"If no match \u2192 default server"}),"\n"]}),"\n",(0,l.jsx)(r.h2,{id:"common-use-cases-for-default-server",children:"Common Use Cases for Default Server"}),"\n",(0,l.jsxs)(r.ol,{children:["\n",(0,l.jsxs)(r.li,{children:["Catch-All Fallback: ",(0,l.jsx)(r.code,{children:"return 404;"})]}),"\n",(0,l.jsxs)(r.li,{children:["Security Sink: ",(0,l.jsx)(r.code,{children:"return 444;"})]}),"\n",(0,l.jsxs)(r.li,{children:["Redirect to Canonical Domain: ",(0,l.jsx)(r.code,{children:"return 301 https://example.com$request_uri;"})]}),"\n",(0,l.jsxs)(r.li,{children:["Maintenance Page: ",(0,l.jsx)(r.code,{children:"root /var/www/maintenance;"})]}),"\n"]}),"\n",(0,l.jsx)(r.h2,{id:"real-world-production-example",children:"Real-World Production Example"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{children:"    server {\r\n    listen 80 default*server;\r\n    server_name *;\r\n    access_log off;\r\n    return 444;\r\n    }\r\n\r\nserver {\r\nlisten 80;\r\nserver_name example.com www.example.com;\r\n\r\n    root /var/www/example;\r\n    index index.html;\r\n\r\n    location / {\r\n        try_files $uri $uri/ =404;\r\n    }\r\n\r\n}\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"Default server blocks unwanted traffic"}),"\n",(0,l.jsx)(r.li,{children:"Legit domain handled separately"}),"\n",(0,l.jsx)(r.li,{children:"Improves security and log noise reduction"}),"\n"]}),"\n",(0,l.jsx)(r.h2,{id:"common-mistakes",children:"Common Mistakes"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"No default server defined"}),"\n",(0,l.jsx)(r.li,{children:"Multiple default servers on same port"}),"\n",(0,l.jsx)(r.li,{children:"Forgetting SSL cert on HTTPS default server"}),"\n",(0,l.jsx)(r.li,{children:"Serving app content from default server"}),"\n"]}),"\n",(0,l.jsx)(r.h2,{id:"debugging-default-server-behavior",children:"Debugging Default Server Behavior"}),"\n",(0,l.jsx)(r.p,{children:"Check active config"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{children:"nginx -T\n"})}),"\n",(0,l.jsx)(r.p,{children:"Test with curl"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{children:'curl -H "Host: unknown.com" http://server_ip\n'})}),"\n",(0,l.jsx)(r.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"Always define an explicit default server"}),"\n",(0,l.jsxs)(r.li,{children:["Use ",(0,l.jsx)(r.code,{children:"server*name *;"})]}),"\n",(0,l.jsx)(r.li,{children:"Lock down default server (444 or 404)"}),"\n",(0,l.jsx)(r.li,{children:"Separate default HTTP and HTTPS servers"}),"\n",(0,l.jsx)(r.li,{children:"Never serve real app content from default server"}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,l.jsx)(r,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}}}]);