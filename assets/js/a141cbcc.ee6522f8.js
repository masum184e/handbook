"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[6517],{28453(e,n,s){s.d(n,{R:()=>t,x:()=>c});var i=s(96540);const l={},r=i.createContext(l);function t(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),i.createElement(r.Provider,{value:n},e.children)}},37325(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"redis/Replication","title":"Replication","description":"Master-Slave replication","source":"@site/docs/redis/10. Replication.md","sourceDirName":"redis","slug":"/redis/Replication","permalink":"/handbook/docs/redis/Replication","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10},"sidebar":"redisApiSidebar","previous":{"title":"Transactions","permalink":"/handbook/docs/redis/Transactions"},"next":{"title":"Security","permalink":"/handbook/docs/redis/Security"}}');var l=s(74848),r=s(28453);const t={sidebar_position:10},c=void 0,a={},d=[{value:"Master-Slave replication",id:"master-slave-replication",level:2},{value:"How Replication Works in Redis",id:"how-replication-works-in-redis",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Example Setup",id:"example-setup",level:3},{value:"Read Replicas in Redis",id:"read-replicas-in-redis",level:2},{value:"Key Characteristics of Read Replicas",id:"key-characteristics-of-read-replicas",level:3},{value:"Limitations of Read Replicas",id:"limitations-of-read-replicas",level:3},{value:"Redis Sentinel for Failover",id:"redis-sentinel-for-failover",level:2},{value:"Why Sentinel?",id:"why-sentinel",level:3},{value:"How Sentinel Works",id:"how-sentinel-works",level:3},{value:"Sentinel Configuration Example",id:"sentinel-configuration-example",level:3},{value:"Example Walkthrough of Sentinel",id:"example-walkthrough-of-sentinel",level:3},{value:"Redis Cluster",id:"redis-cluster",level:2},{value:"Sharding in Redis Cluster",id:"sharding-in-redis-cluster",level:3},{value:"Hash Slots",id:"hash-slots",level:3},{value:"Replication in Cluster",id:"replication-in-cluster",level:3},{value:"Example Setup of Cluster (3 Masters, 3 Replicas)",id:"example-setup-of-cluster-3-masters-3-replicas",level:3},{value:"Example Walkthrough",id:"example-walkthrough",level:3},{value:"Benefits of Redis Cluster",id:"benefits-of-redis-cluster",level:3},{value:"Limitations of Redis Cluster",id:"limitations-of-redis-cluster",level:3}];function o(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"master-slave-replication",children:"Master-Slave replication"}),"\n",(0,l.jsx)(n.p,{children:"Redis provides asynchronous replication that allows you to set up one master node and one or more slave (replica) nodes."}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"The master:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Handles all write operations (SET, INCR, DEL, etc.)."}),"\n",(0,l.jsx)(n.li,{children:"Propagates data changes to the replicas."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"The slaves:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Get a copy of the master\u2019s dataset."}),"\n",(0,l.jsx)(n.li,{children:"Keep synchronized with the master by receiving a continuous stream of changes."}),"\n",(0,l.jsx)(n.li,{children:"Can handle read-only queries (GET, MGET, etc.), reducing load on the master."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"This model is often used for high availability (HA), load balancing, and data redundancy."}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Limitations"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Asynchronous replication \u2192 data may be lost if the master crashes before changes are propagated."}),"\n",(0,l.jsx)(n.li,{children:"Slaves are read-only \u2192 writes always go to master."}),"\n",(0,l.jsx)(n.li,{children:"No automatic failover \u2192 unless you use Redis Sentinel or Cluster."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"how-replication-works-in-redis",children:"How Replication Works in Redis"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Initial Sync"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"When a slave connects to the master, it requests a full synchronization."}),"\n",(0,l.jsxs)(n.li,{children:["The master performs a ",(0,l.jsx)(n.code,{children:"BGSAVE"})," (background save) to create an RDB snapshot."]}),"\n",(0,l.jsx)(n.li,{children:"It sends this snapshot to the slave, which loads it into memory."}),"\n",(0,l.jsx)(n.li,{children:"While the snapshot is being sent, the master buffers write commands."}),"\n",(0,l.jsx)(n.li,{children:"After the snapshot is loaded, the master sends the buffered commands to the slave."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Ongoing Replication"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"After the initial sync, the master continuously sends write commands to the slave so it stays up-to-date."}),"\n",(0,l.jsx)(n.li,{children:"This is asynchronous, meaning there could be a slight lag."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Automatic Reconnection"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"If the slave disconnects, it automatically tries to reconnect and resync with the master."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,l.jsx)(n.p,{children:"On the Master (redis.conf)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"# Master\u2019s config (default)\r\nreplica-serve-stale-data yes\n"})}),"\n",(0,l.jsx)(n.p,{children:"On the Slave (redis.conf)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"# Point to the master\r\nreplicaof 127.0.0.1 6379\n"})}),"\n",(0,l.jsx)(n.p,{children:"Or dynamically in the CLI:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"127.0.0.1:6380> REPLICAOF 127.0.0.1 6379\n"})}),"\n",(0,l.jsx)(n.h3,{id:"example-setup",children:"Example Setup"}),"\n",(0,l.jsx)(n.p,{children:"Let\u2019s say we want 1 master and 2 slaves."}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Start Master"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sj",children:"redis-server --port 6379\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Start Slaves"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"redis-server --port 6380\r\nredis-server --port 6381\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Configure Slaves"})}),"\n",(0,l.jsx)(n.p,{children:"In the Redis CLI:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"127.0.0.1:6380> REPLICAOF 127.0.0.1 6379\r\n127.0.0.1:6381> REPLICAOF 127.0.0.1 6379\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Test Replication"})}),"\n",(0,l.jsx)(n.p,{children:"On master:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:'127.0.0.1:6379> SET user:1 "Alice"\r\nOK\n'})}),"\n",(0,l.jsx)(n.p,{children:"On slave (port 6380 or 6381):"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:'127.0.0.1:6380> GET user:1\r\n"Alice"\n'})}),"\n",(0,l.jsx)(n.p,{children:"The data written to the master is automatically replicated to the slaves."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"read-replicas-in-redis",children:"Read Replicas in Redis"}),"\n",(0,l.jsx)(n.p,{children:"A read replica in Redis is simply a replica node (slave) configured to receive data from the master and serve read-only queries."}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Master: Handles all write operations (e.g., ",(0,l.jsx)(n.code,{children:"SET"}),", ",(0,l.jsx)(n.code,{children:"INCR"}),", ",(0,l.jsx)(n.code,{children:"DEL"}),")."]}),"\n",(0,l.jsxs)(n.li,{children:["Replica: Receives replicated data from the master and can serve read operations (e.g., ",(0,l.jsx)(n.code,{children:"GET"}),", ",(0,l.jsx)(n.code,{children:"MGET"}),", ",(0,l.jsx)(n.code,{children:"HGET"}),")."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"This improves performance and scalability, since you can distribute read queries across multiple replicas, reducing load on the master."}),"\n",(0,l.jsx)(n.h3,{id:"key-characteristics-of-read-replicas",children:"Key Characteristics of Read Replicas"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Read-only by default"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"By default, replicas are read-only (replica-read-only yes in config)."}),"\n",(0,l.jsx)(n.li,{children:"This prevents accidental writes."}),"\n",(0,l.jsx)(n.li,{children:"You can override with CONFIG SET replica-read-only no, but it breaks consistency."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Asynchronous Replication"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Replicas might be slightly behind the master (called replication lag)."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Scaling Reads"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Applications can direct read-heavy traffic (like analytics or reporting queries) to replicas."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"High Availability"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"If the master goes down, replicas can be promoted to master (manually, or automatically via Sentinel)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"limitations-of-read-replicas",children:"Limitations of Read Replicas"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Replication Lag: Replicas may serve slightly outdated data compared to the master."}),"\n",(0,l.jsx)(n.li,{children:"No Writes Allowed: You cannot perform writes on replicas unless explicitly allowed."}),"\n",(0,l.jsx)(n.li,{children:"Manual Promotion: By default, replicas don\u2019t automatically take over as master (requires Sentinel or Cluster)."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"redis-sentinel-for-failover",children:"Redis Sentinel for Failover"}),"\n",(0,l.jsx)(n.p,{children:"Redis Sentinel is a distributed system that provides:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Monitoring"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Keeps track of whether the master and replicas are working properly."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Notification"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Alerts administrators or external systems when something goes wrong."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Automatic Failover"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"If the master is not reachable, Sentinel promotes one of the replicas to master and reconfigures the other replicas to follow it."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Configuration Provider"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Applications can query Sentinel to know the current master\u2019s address (no need to hardcode the master IP)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"why-sentinel",children:"Why Sentinel?"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Normal master-replica setup gives redundancy but requires manual intervention when the master fails."}),"\n",(0,l.jsx)(n.li,{children:"Sentinel automates failover, ensuring high availability with minimal downtime."}),"\n",(0,l.jsx)(n.li,{children:"Useful for production deployments where availability is critical."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"how-sentinel-works",children:"How Sentinel Works"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Monitoring"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Each Sentinel constantly checks the health of the master and replicas via PINGs."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Failure Detection"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"If a master doesn\u2019t respond within a configured time (down-after-milliseconds), the Sentinel marks it as subjectively down."}),"\n",(0,l.jsx)(n.li,{children:"Other Sentinels must agree to mark it objectively down (majority vote)."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Failover"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Sentinels elect a leader."}),"\n",(0,l.jsx)(n.li,{children:"The leader promotes one replica to master."}),"\n",(0,l.jsx)(n.li,{children:"Other replicas are reconfigured to follow the new master."}),"\n",(0,l.jsx)(n.li,{children:"Applications connected through Sentinel will automatically discover the new master."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"sentinel-configuration-example",children:"Sentinel Configuration Example"}),"\n",(0,l.jsx)(n.p,{children:"Suppose we have:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Master \u2192 Port 6379"}),"\n",(0,l.jsx)(n.li,{children:"Replicas \u2192 Ports 6380, 6381"}),"\n",(0,l.jsx)(n.li,{children:"Sentinels \u2192 Ports 26379, 26380, 26381"}),"\n"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Configure Redis Master"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"# redis-master.conf\r\nport 6379\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Configure Replicas"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"# redis-slave.conf (for each replica)\r\nport 6380\r\nreplicaof 127.0.0.1 6379\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Configure Sentinel"})}),"\n",(0,l.jsxs)(n.p,{children:["Create a ",(0,l.jsx)(n.code,{children:"sentinel.conf"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"port 26379\r\nsentinel monitor mymaster 127.0.0.1 6379 2\r\nsentinel down-after-milliseconds mymaster 5000\r\nsentinel failover-timeout mymaster 10000\r\nsentinel parallel-syncs mymaster 1\n"})}),"\n",(0,l.jsx)(n.p,{children:"Explanation:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"mymaster"})," \u2192 Name of monitored master."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"127.0.0.1 6379"})," \u2192 Master\u2019s address and port."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"2"})," \u2192 Number of Sentinels that must agree master is down."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"down-after-milliseconds"})," \u2192 Time after which a master is considered down (5s)."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"failover-timeout"})," \u2192 Max time for failover (10s)."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"parallel-syncs"})," \u2192 Number of replicas syncing with new master at once."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Start Components"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"redis-server redis-master.conf\r\nredis-server redis-slave.conf --port 6380\r\nredis-server redis-slave.conf --port 6381\r\nredis-sentinel sentinel.conf --port 26379\r\nredis-sentinel sentinel.conf --port 26380\r\nredis-sentinel sentinel.conf --port 26381\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"example-walkthrough-of-sentinel",children:"Example Walkthrough of Sentinel"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Normal Operation"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Master: ",(0,l.jsx)(n.code,{children:"6379"})]}),"\n",(0,l.jsxs)(n.li,{children:["Replicas: ",(0,l.jsx)(n.code,{children:"6380"}),", ",(0,l.jsx)(n.code,{children:"6381"})]}),"\n",(0,l.jsx)(n.li,{children:"Sentinels monitor the master."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Insert Data"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:'127.0.0.1:6379> SET user:1 "Alice"\r\nOK\n'})}),"\n",(0,l.jsx)(n.p,{children:"Check replica:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'127.0.0.1:6380> GET user:1\r\n"Alice"\n'})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Simulate Failure"}),"\n",(0,l.jsx)(n.p,{children:"Stop the master:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:'pkill -f "redis-server.*6379"\n'})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Failover Happens"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Sentinels detect master is down after 5 seconds."}),"\n",(0,l.jsx)(n.li,{children:"They vote and promote one replica (say 6380) as new master."}),"\n",(0,l.jsx)(n.li,{children:"Other replica (6381) is reconfigured to follow 6380."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Check with Sentinel:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:'redis-cli -p 26379 SENTINEL get-master-addr-by-name mymaster\r\n1) "127.0.0.1"\r\n2) "6380"\n'})}),"\n",(0,l.jsx)(n.p,{children:"The master has changed automatically!"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Client Auto-Discovery"}),"\n",(0,l.jsx)(n.p,{children:"Applications can connect to Sentinel to always find the current master:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"redis-cli -p 26379 SENTINEL get-master-addr-by-name mymaster\n"})}),"\n",(0,l.jsx)(n.p,{children:"This avoids hardcoding the master\u2019s address in the app."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"redis-cluster",children:"Redis Cluster"}),"\n",(0,l.jsx)(n.p,{children:"Redis Cluster is Redis\u2019s built-in distributed solution that provides:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Automatic Sharding (Data Partitioning)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Splits the dataset across multiple nodes."}),"\n",(0,l.jsx)(n.li,{children:"Each node holds only part of the data."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"High Availability with Replication"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Each shard (master) can have replicas."}),"\n",(0,l.jsx)(n.li,{children:"If a master fails, a replica is promoted automatically."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"No Single Point of Failure"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Cluster survives as long as the majority of masters are available."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"sharding-in-redis-cluster",children:"Sharding in Redis Cluster"}),"\n",(0,l.jsx)(n.p,{children:"Instead of storing all keys on one master, Redis Cluster divides the keyspace into 16384 hash slots."}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Each master node is responsible for a subset of slots."}),"\n",(0,l.jsx)(n.li,{children:"When a client issues a command, Redis determines the slot for the key using CRC16 hashing:"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"HASH_SLOT = CRC16(key) mod 16384\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"That slot tells Redis which node holds the key."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Example:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Key ",(0,l.jsx)(n.code,{children:"user:1"})," \u2192 Slot ",(0,l.jsx)(n.code,{children:"5798"})]}),"\n",(0,l.jsxs)(n.li,{children:["Key ",(0,l.jsx)(n.code,{children:"user:2"})," \u2192 Slot ",(0,l.jsx)(n.code,{children:"15296"})]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"If you have 3 masters, Redis divides 16384 slots across them (roughly ~5461 slots each)."}),"\n",(0,l.jsx)(n.h3,{id:"hash-slots",children:"Hash Slots"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"16384 slots \u2192 fixed, not configurable."}),"\n",(0,l.jsx)(n.li,{children:"Each master manages some slots."}),"\n",(0,l.jsx)(n.li,{children:"Replicas mirror their master\u2019s slots (but are read-only)."}),"\n",(0,l.jsx)(n.li,{children:"During rebalancing, slots can be moved between masters."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"This makes scaling horizontal:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Add a new master \u2192 some slots are migrated to it."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"replication-in-cluster",children:"Replication in Cluster"}),"\n",(0,l.jsx)(n.p,{children:"Each master has at least one replica:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"If master fails \u2192 a replica is promoted."}),"\n",(0,l.jsx)(n.li,{children:"Ensures high availability with automatic failover."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"example-setup-of-cluster-3-masters-3-replicas",children:"Example Setup of Cluster (3 Masters, 3 Replicas)"}),"\n",(0,l.jsx)(n.p,{children:"We want a 6-node cluster:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["3 Masters: ports ",(0,l.jsx)(n.code,{children:"7000"}),", ",(0,l.jsx)(n.code,{children:"7001"}),", ",(0,l.jsx)(n.code,{children:"7002"})]}),"\n",(0,l.jsxs)(n.li,{children:["3 Replicas: ports ",(0,l.jsx)(n.code,{children:"7003"}),", ",(0,l.jsx)(n.code,{children:"7004"}),", ",(0,l.jsx)(n.code,{children:"7005"})]}),"\n"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"Start Nodes"})}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"redis-server --port 7000 --cluster-enabled yes --cluster-config-file nodes-7000.conf --cluster-node-timeout 5000 --appendonly yes\r\nredis-server --port 7001 --cluster-enabled yes --cluster-config-file nodes-7001.conf --cluster-node-timeout 5000 --appendonly yes\r\nredis-server --port 7002 --cluster-enabled yes --cluster-config-file nodes-7002.conf --cluster-node-timeout 5000 --appendonly yes\r\nredis-server --port 7003 --cluster-enabled yes --cluster-config-file nodes-7003.conf --cluster-node-timeout 5000 --appendonly yes\r\nredis-server --port 7004 --cluster-enabled yes --cluster-config-file nodes-7004.conf --cluster-node-timeout 5000 --appendonly yes\r\nredis-server --port 7005 --cluster-enabled yes --cluster-config-file nodes-7005.conf --cluster-node-timeout 5000 --appendonly yes\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Create the Cluster"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"redis-cli --cluster create 127.0.0.1:7000 \\\r\n                          127.0.0.1:7001 \\\r\n                          127.0.0.1:7002 \\\r\n                          127.0.0.1:7003 \\\r\n                          127.0.0.1:7004 \\\r\n                          127.0.0.1:7005 \\\r\n                          --cluster-replicas 1\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"--cluster-replicas 1"})," \u2192 Each master will have one replica."]}),"\n",(0,l.jsx)(n.li,{children:"Redis will automatically assign slots across the 3 masters."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"example-walkthrough",children:"Example Walkthrough"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Check Cluster Info"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"redis-cli -c -p 7000 cluster info\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Check Slot Assignment"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"redis-cli -c -p 7000 cluster slots\n"})}),"\n",(0,l.jsx)(n.p,{children:"Example output:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"0-5460       -> 7000 (master), 7003 (replica)\r\n5461-10922   -> 7001 (master), 7004 (replica)\r\n10923-16383  -> 7002 (master), 7005 (replica)\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Insert a Key"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'redis-cli -c -p 7000 SET user:1 "Alice"\n'})}),"\n",(0,l.jsx)(n.p,{children:"The client will:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Compute slot for ",(0,l.jsx)(n.code,{children:"user:1"})," (e.g., ",(0,l.jsx)(n.code,{children:"5798"}),")."]}),"\n",(0,l.jsxs)(n.li,{children:["Redirect request to the correct master (",(0,l.jsx)(n.code,{children:"7001"}),")."]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["With ",(0,l.jsx)(n.code,{children:"-c"})," (cluster mode), ",(0,l.jsx)(n.code,{children:"redis-cli"})," automatically follows redirects."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Read a Key"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'redis-cli -c -p 7002 GET user:1\r\n"Alice"\n'})}),"\n",(0,l.jsxs)(n.p,{children:["Even though you connected to ",(0,l.jsx)(n.code,{children:"7002"}),", the client redirects you to the correct node."]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"benefits-of-redis-cluster",children:"Benefits of Redis Cluster"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Horizontal scaling \u2192 Distributes data across multiple nodes."}),"\n",(0,l.jsx)(n.li,{children:"High availability \u2192 Failover handled by replicas."}),"\n",(0,l.jsx)(n.li,{children:"No single point of failure (if majority of masters remain)."}),"\n",(0,l.jsx)(n.li,{children:"Auto rebalancing of slots when nodes are added/removed."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"limitations-of-redis-cluster",children:"Limitations of Redis Cluster"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Cross-slot operations: Multi-key operations must be in the same slot (use hash tags like ",(0,l.jsx)(n.code,{children:"{user}:1"})," and ",(0,l.jsx)(n.code,{children:"{user}:2"}),")."]}),"\n",(0,l.jsx)(n.li,{children:"Strong network requirements: All nodes must communicate with each other."}),"\n",(0,l.jsx)(n.li,{children:"Higher complexity than standalone/sentinel setups."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}}}]);