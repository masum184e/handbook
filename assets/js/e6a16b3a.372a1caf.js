"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[88320],{28453(e,n,t){t.d(n,{R:()=>c,x:()=>o});var r=t(96540);const s={},i=r.createContext(s);function c(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(i.Provider,{value:n},e.children)}},83042(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"nodejs/Database Optimization","title":"Database Optimization","description":"Connection Pooling","source":"@site/docs/nodejs/20. Database Optimization.md","sourceDirName":"nodejs","slug":"/nodejs/Database Optimization","permalink":"/handbook/docs/nodejs/Database Optimization","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":20,"frontMatter":{},"sidebar":"nodejsApiSidebar","previous":{"title":"Event Loop","permalink":"/handbook/docs/nodejs/Event Loop"},"next":{"title":"Monitoring","permalink":"/handbook/docs/nodejs/Monitoring"}}');var s=t(74848),i=t(28453);const c={},o=void 0,a={},d=[{value:"Connection Pooling",id:"connection-pooling",level:2},{value:"Caching Database Results",id:"caching-database-results",level:2}];function l(e){const n={code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"connection-pooling",children:"Connection Pooling"}),"\n",(0,s.jsx)(n.p,{children:"Creating a DB connection per request is expensive."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const mysql = require('mysql2/promise');\r\n\r\nconst pool = mysql.createPool({\r\n  host: 'localhost',\r\n  user: 'root',\r\n  database: 'app',\r\n  connectionLimit: 10\r\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"caching-database-results",children:"Caching Database Results"}),"\n",(0,s.jsx)(n.p,{children:"Caching avoids repeated queries for frequently requested data."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Types of Caching"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Example"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"In-memory cache"}),(0,s.jsx)(n.td,{children:"Node.js Map, LRU"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Distributed cache"}),(0,s.jsx)(n.td,{children:"Redis, Memcached"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"HTTP cache"}),(0,s.jsx)(n.td,{children:"CDN, browser cache"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"In-Memory Cache"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const cache = new Map();\r\n\r\nasync function getUser(id) {\r\n  if (cache.has(id)) {\r\n    return cache.get(id); // Cache hit\r\n  }\r\n\r\n  const user = await db.query('SELECT * FROM users WHERE id = ?', [id]);\r\n  cache.set(id, user); // Cache miss -> store\r\n  return user;\r\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Redis Cache"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const redis = require('redis');\r\nconst client = redis.createClient();\r\n\r\nasync function getUser(id) {\r\n  const cacheKey = `user:${id}`;\r\n\r\n  const cached = await client.get(cacheKey);\r\n  if (cached) {\r\n    return JSON.parse(cached); // Cache hit\r\n  }\r\n\r\n  const user = await db.query('SELECT * FROM users WHERE id = ?', [id]);\r\n\r\n  // Cache for 60 seconds\r\n  await client.setEx(cacheKey, 60, JSON.stringify(user));\r\n\r\n  return user;\r\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);