"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[85926],{28453(e,n,s){s.d(n,{R:()=>a,x:()=>r});var i=s(96540);const t={},d=i.createContext(t);function a(e){const n=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(d.Provider,{value:n},e.children)}},44285(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"database-design/Cascading","title":"Cascading","description":"When we design relational databases with foreign keys, we can define what happens to child records when the parent record is updated or deleted.","source":"@site/docs/database-design/20. Cascading.md","sourceDirName":"database-design","slug":"/database-design/Cascading","permalink":"/handbook/docs/database-design/Cascading","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":21,"frontMatter":{"sidebar_position":21}}');var t=s(74848),d=s(28453);const a={sidebar_position:21},r=void 0,c={},l=[{value:"Cascading Deletes (Integrity + Transactions)",id:"cascading-deletes-integrity--transactions",level:2},{value:"Cascading Updates (Integrity + Transactions)",id:"cascading-updates-integrity--transactions",level:2},{value:"Cascading and ACID Transactions",id:"cascading-and-acid-transactions",level:2},{value:"Why Cascading is Useful",id:"why-cascading-is-useful",level:2}];function o(e){const n={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"When we design relational databases with foreign keys, we can define what happens to child records when the parent record is updated or deleted."}),"\n",(0,t.jsx)(n.p,{children:"This is done using:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"ON DELETE CASCADE"})," \u2192 If a parent row is deleted, all child rows that reference it are also deleted automatically."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"ON UPDATE CASCADE"})," \u2192 If a parent key changes (usually the primary key), all child foreign key references are updated automatically."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Other options exist too (like ",(0,t.jsx)(n.code,{children:"SET NULL"}),", ",(0,t.jsx)(n.code,{children:"SET DEFAULT"}),", ",(0,t.jsx)(n.code,{children:"RESTRICT"}),", ",(0,t.jsx)(n.code,{children:"NO ACTION"}),"), but we\u2019ll focus on CASCADE."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE students (\r\n    student_id INT PRIMARY KEY,\r\n    name VARCHAR(100)\r\n);\r\n\r\nCREATE TABLE enrollments (\r\n    enrollment_id INT PRIMARY KEY,\r\n    student_id INT,\r\n    course_code VARCHAR(10),\r\n    FOREIGN KEY (student_id) REFERENCES students(student_id)\r\n        ON DELETE CASCADE\r\n        ON UPDATE CASCADE\r\n);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"cascading-deletes-integrity--transactions",children:"Cascading Deletes (Integrity + Transactions)"}),"\n",(0,t.jsx)(n.p,{children:"If a student is deleted, all their enrollment records should also be removed to avoid \u201corphan\u201d rows."}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"INSERT INTO students VALUES (101, 'Alice'), (102, 'Bob');\r\nINSERT INTO enrollments VALUES (1, 101, 'CS101'), (2, 101, 'MATH201'), (3, 102, 'CS101');\n"})}),"\n",(0,t.jsx)(n.p,{children:"Now delete Alice:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"BEGIN TRANSACTION;\r\nDELETE FROM students WHERE student_id = 101;\r\nCOMMIT;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Because of ",(0,t.jsx)(n.code,{children:"ON DELETE CASCADE"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Alice (",(0,t.jsx)(n.code,{children:"student_id = 101"}),") is deleted from ",(0,t.jsx)(n.code,{children:"students"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Her enrollments (1, 2) are automatically deleted from ",(0,t.jsx)(n.code,{children:"enrollments"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Bob\u2019s enrollment (3) remains unaffected."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This prevents dangling enrollments for a student who doesn\u2019t exist."}),"\n",(0,t.jsx)(n.h2,{id:"cascading-updates-integrity--transactions",children:"Cascading Updates (Integrity + Transactions)"}),"\n",(0,t.jsx)(n.p,{children:"If the primary key of a parent row changes, the foreign key references in child rows are updated automatically."}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"BEGIN TRANSACTION;\r\nUPDATE students\r\nSET student_id = 201\r\nWHERE student_id = 102;\r\nCOMMIT;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Because of ",(0,t.jsx)(n.code,{children:"ON UPDATE CASCADE"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Student id ",(0,t.jsx)(n.code,{children:"102"})," changes to ",(0,t.jsx)(n.code,{children:"201"})," in ",(0,t.jsx)(n.code,{children:"students"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["In ",(0,t.jsx)(n.code,{children:"enrollments"}),", the row ",(0,t.jsx)(n.code,{children:"(3, 102, 'CS101')"})," is automatically updated to ",(0,t.jsx)(n.code,{children:"(3, 201, 'CS101')"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Ensures child rows stay consistent with parent rows."}),"\n",(0,t.jsx)(n.h2,{id:"cascading-and-acid-transactions",children:"Cascading and ACID Transactions"}),"\n",(0,t.jsx)(n.p,{children:"Now let\u2019s connect this with transactions:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Atomicity:"})," If the parent delete/update fails, the cascaded changes are rolled back too."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Consistency:"})," Referential integrity is preserved because no child is left orphaned."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Isolation:"})," If two users modify the same parent, cascades won\u2019t conflict (depending on isolation level)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Durability:"})," Once committed, all cascaded changes are permanent."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"why-cascading-is-useful",children:"Why Cascading is Useful"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Prevents orphan records automatically."}),"\n",(0,t.jsx)(n.li,{children:"Reduces the need for manual cleanup logic in application code."}),"\n",(0,t.jsx)(n.li,{children:"Keeps relationships consistent across multiple tables."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}}}]);