"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[23438],{25945(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"prisma/Migration","title":"Migration","description":"Prisma Migrate","source":"@site/docs/prisma/4. Migration.md","sourceDirName":"prisma","slug":"/prisma/Migration","permalink":"/handbook/docs/prisma/Migration","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"prismaApiSidebar","previous":{"title":"Prisma Schema","permalink":"/handbook/docs/prisma/Prisma Schema"},"next":{"title":"Prisma Client","permalink":"/handbook/docs/prisma/Prisma Client"}}');var r=s(74848),a=s(28453);const t={sidebar_position:4},l=void 0,o={},c=[{value:"Prisma Migrate",id:"prisma-migrate",level:2},{value:"Prisma Migrate Workflow",id:"prisma-migrate-workflow",level:3},{value:"Resetting the database",id:"resetting-the-database",level:2},{value:"How Resetting Works",id:"how-resetting-works",level:3}];function d(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"prisma-migrate",children:"Prisma Migrate"}),"\n",(0,r.jsxs)(n.p,{children:["Prisma Migrate is the migration system Prisma provides to safely evolve your database schema in sync with your Prisma Schema (",(0,r.jsx)(n.code,{children:"schema.prisma"}),"). It helps you track schema changes, generate SQL migrations, apply them to your database, and keep everything consistent across environments (dev, staging, production)."]}),"\n",(0,r.jsx)(n.h3,{id:"prisma-migrate-workflow",children:"Prisma Migrate Workflow"}),"\n",(0,r.jsx)(n.p,{children:"The Prisma Migrate workflow generally involves four main steps:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Define schema changes"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["You edit your ",(0,r.jsx)(n.code,{children:"schema.prisma"})," file (e.g., adding a model, changing a field, creating relations, etc.)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Create a new migration"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npx prisma migrate dev --name <migration-name>\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Prisma detects differences between your current schema and the database."}),"\n",(0,r.jsxs)(n.li,{children:["Generates a new SQL migration file inside ",(0,r.jsx)(n.code,{children:"prisma/migrations/"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Applies the migration immediately to your development database."}),"\n",(0,r.jsx)(n.li,{children:"Updates the Prisma Client (so you can use new types in your code)."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Apply migrations to other environments"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["In production or staging, you don\u2019t use ",(0,r.jsx)(n.code,{children:"migrate dev"}),". Instead, you use:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npx prisma migrate deploy\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Reads all unapplied migrations from ",(0,r.jsx)(n.code,{children:"prisma/migrations/"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Applies them in the correct order to the target database."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Track and version migrations"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Each migration is a folder with timestamp + name:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"prisma/\r\n  migrations/\r\n    20250925101010_init/\r\n      migration.sql\r\n    20250925103520_add-user-table/\r\n      migration.sql\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The database contains a ",(0,r.jsx)(n.code,{children:"_prisma_migrations"})," table that records which migrations have been applied."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"resetting-the-database",children:"Resetting the database"}),"\n",(0,r.jsx)(n.p,{children:"Resetting means:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Drop all tables in the database."}),"\n",(0,r.jsxs)(n.li,{children:["Recreate the schema from migrations in ",(0,r.jsx)(n.code,{children:"prisma/migrations/"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Re-generate Prisma Client to match the schema."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This is especially useful when:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"You want a clean database while developing."}),"\n",(0,r.jsx)(n.li,{children:"You changed schema drastically and just want a fresh start locally."}),"\n",(0,r.jsx)(n.li,{children:"You\u2019re preparing for testing with a clean dataset."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The main command is:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npx prisma migrate reset\n"})}),"\n",(0,r.jsx)(n.h3,{id:"how-resetting-works",children:"How Resetting Works"}),"\n",(0,r.jsx)(n.p,{children:"When you run migrate reset, Prisma does the following:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Confirmation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"It asks you to confirm, because it will delete ALL DATA."}),"\n",(0,r.jsx)(n.li,{children:"You can skip confirmation with:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npx prisma migrate reset --force\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Drops all tables"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Completely clears the database schema."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Re-applies all migrations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Prisma runs every migration in your ",(0,r.jsx)(n.code,{children:"prisma/migrations/"})," directory in sequence."]}),"\n",(0,r.jsx)(n.li,{children:"This ensures the schema is the same as if you had created the DB from scratch."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Seeds the database (optional)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If you have a ",(0,r.jsx)(n.code,{children:"prisma/seed.ts"})," or ",(0,r.jsx)(n.code,{children:"prisma/seed.js"})," file, Prisma will run it automatically."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npx prisma migrate reset --skip-seed\n"})}),"\n","skips the seeding step."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Regenerates Prisma Client"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"So your code reflects the new schema."}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453(e,n,s){s.d(n,{R:()=>t,x:()=>l});var i=s(96540);const r={},a=i.createContext(r);function t(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);