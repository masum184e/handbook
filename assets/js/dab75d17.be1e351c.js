"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[9036],{28453(e,n,r){r.d(n,{R:()=>i,x:()=>d});var t=r(96540);const s={},o=t.createContext(s);function i(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(o.Provider,{value:n},e.children)}},77297(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"nextjs/Proxy API Requests","title":"Proxy API","description":"When you have a Next.js frontend and a separate backend (e.g., running on http5000), your frontend may need to make API calls to the backend.","source":"@site/docs/nextjs/18. Proxy API Requests.md","sourceDirName":"nextjs","slug":"/nextjs/Proxy API Requests","permalink":"/handbook/docs/nextjs/Proxy API Requests","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"title":"Proxy API","sidebar_position":20},"sidebar":"nextjsSidebar","previous":{"title":"Error Handling","permalink":"/handbook/docs/nextjs/Error Handling"}}');var s=r(74848),o=r(28453);const i={title:"Proxy API",sidebar_position:20},d=void 0,c={},a=[{value:"Ways to Proxy in Next.js",id:"ways-to-proxy-in-nextjs",level:2},{value:"Proxy with <code>next.config.js</code>",id:"proxy-with-nextconfigjs",level:3},{value:"Proxy with Next.js API Route (Custom Middleware)",id:"proxy-with-nextjs-api-route-custom-middleware",level:3},{value:"When to Use Which",id:"when-to-use-which",level:3}];function l(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["When you have a Next.js frontend and a separate backend (e.g., running on ",(0,s.jsx)(n.code,{children:"http://localhost:5000"}),"), your frontend may need to make API calls to the backend."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Problem"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Next.js dev server runs at ",(0,s.jsx)(n.code,{children:"http://localhost:3000"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Backend runs at ",(0,s.jsx)(n.code,{children:"http://localhost:5000"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["If frontend directly fetches ",(0,s.jsx)(n.code,{children:"http://localhost:5000/api/..."}),", you run into CORS issues and must configure CORS on the backend."]}),"\n",(0,s.jsxs)(n.li,{children:["In production, the frontend and backend may even live under different domains (",(0,s.jsx)(n.code,{children:"frontend.com"})," vs ",(0,s.jsx)(n.code,{children:"api.backend.com"}),")."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Solution \u2192 Proxy"})}),"\n",(0,s.jsx)(n.p,{children:"Proxying means:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The frontend still calls something like ",(0,s.jsx)(n.code,{children:"/api/..."})," from the same Next.js domain."]}),"\n",(0,s.jsxs)(n.li,{children:["The Next.js dev server forwards that request to the backend (",(0,s.jsx)(n.code,{children:"http://localhost:5000"}),")."]}),"\n",(0,s.jsx)(n.li,{children:"This avoids CORS issues and makes development simpler."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"ways-to-proxy-in-nextjs",children:"Ways to Proxy in Next.js"}),"\n",(0,s.jsx)(n.p,{children:"There are two common ways:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Using ",(0,s.jsx)(n.code,{children:"next.config.js"})," rewrites (recommended, built-in)."]}),"\n",(0,s.jsx)(n.li,{children:"Creating a custom API route in Next.js that forwards requests (manual proxy)."}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"proxy-with-nextconfigjs",children:["Proxy with ",(0,s.jsx)(n.code,{children:"next.config.js"})]}),"\n",(0,s.jsxs)(n.p,{children:["In ",(0,s.jsx)(n.code,{children:"next.config.js"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'// next.config.js\r\nmodule.exports = {\r\n  async rewrites() {\r\n    return [\r\n      {\r\n        source: "/api/:path*", // when frontend requests /api/*\r\n        destination: "http://localhost:5000/api/:path*", // forward to backend\r\n      },\r\n    ];\r\n  },\r\n};\n'})}),"\n",(0,s.jsx)(n.p,{children:"Usage in Frontend"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'// pages/products.js\r\nexport default function ProductsPage({ products }) {\r\n  return (\r\n    <div>\r\n      <h1>Products via Proxy</h1>\r\n      <ul>\r\n        {products.map((p) => (\r\n          <li key={p.id}>\r\n            {p.name} - ${p.price}\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport async function getServerSideProps() {\r\n  // Notice: We call /api/products (Next.js server)\r\n  const res = await fetch("http://localhost:3000/api/products");\r\n  const products = await res.json();\r\n\r\n  return { props: { products } };\r\n}\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Frontend calls ",(0,s.jsx)(n.code,{children:"/api/products"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Next.js intercepts and proxies it to ",(0,s.jsx)(n.code,{children:"http://localhost:5000/api/products"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["No CORS required because the browser thinks it\u2019s talking to the same origin (",(0,s.jsx)(n.code,{children:"localhost:3000"}),")."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"proxy-with-nextjs-api-route-custom-middleware",children:"Proxy with Next.js API Route (Custom Middleware)"}),"\n",(0,s.jsxs)(n.p,{children:["Sometimes you want to add logic before proxying (e.g., authentication, caching, rate-limiting). In that case, you can create your own proxy endpoint in ",(0,s.jsx)(n.code,{children:"/pages/api"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'// pages/api/proxy/[...path].js\r\nexport default async function handler(req, res) {\r\n  const { path } = req.query;\r\n  const backendURL = `http://localhost:5000/api/${path.join("/")}`;\r\n\r\n  try {\r\n    const backendRes = await fetch(backendURL, {\r\n      method: req.method,\r\n      headers: {\r\n        "Content-Type": "application/json",\r\n      },\r\n      body: req.method !== "GET" ? JSON.stringify(req.body) : undefined,\r\n    });\r\n\r\n    const data = await backendRes.json();\r\n    res.status(backendRes.status).json(data);\r\n  } catch (error) {\r\n    res.status(500).json({ error: "Proxy error", details: error.message });\r\n  }\r\n}\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Frontend calls ",(0,s.jsx)(n.code,{children:"/api/proxy/products"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Next.js API route receives it and forwards the request to ",(0,s.jsx)(n.code,{children:"http://localhost:5000/api/products"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"You can modify the request/response (add headers, auth tokens, etc.)."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"when-to-use-which",children:"When to Use Which"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"next.config.js rewrites"})," \u2192 Simple, lightweight, good for local dev to avoid CORS."]}),"\n",(0,s.jsx)(n.li,{children:"API route proxy \u2192 More control, when you need to add logic (auth, caching, validation)."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);