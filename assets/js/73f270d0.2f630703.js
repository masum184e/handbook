"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[72184],{28453(e,r,n){n.d(r,{R:()=>d,x:()=>t});var i=n(96540);const s={},l=i.createContext(s);function d(e){const r=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),i.createElement(l.Provider,{value:r},e.children)}},64317(e,r,n){n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>t,default:()=>a,frontMatter:()=>d,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"nginx/Rewrite & Redirect","title":"Rewrite & Redirect","description":"What Are Rewrite & Redirect Rules?","source":"@site/docs/nginx/29. Rewrite & Redirect.md","sourceDirName":"nginx","slug":"/nginx/Rewrite & Redirect","permalink":"/handbook/docs/nginx/Rewrite & Redirect","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":29,"frontMatter":{},"sidebar":"nginxApiSidebar","previous":{"title":"Priority Rules","permalink":"/handbook/docs/nginx/Priority Rules"}}');var s=n(74848),l=n(28453);const d={},t=void 0,c={},o=[{value:"What Are Rewrite &amp; Redirect Rules?",id:"what-are-rewrite--redirect-rules",level:2},{value:"Rewrite vs Redirect (Key Difference)",id:"rewrite-vs-redirect-key-difference",level:2},{value:"rewrite Directive (Internal URL Rewrite)",id:"rewrite-directive-internal-url-rewrite",level:2},{value:"Example: Remove <code>.php</code> from URLs",id:"example-remove-php-from-urls",level:3},{value:"Rewrite Flags (Very Important)",id:"rewrite-flags-very-important",level:2},{value:"Redirect Using rewrite",id:"redirect-using-rewrite",level:2},{value:"Redirect Using <code>return</code> (Best Practice)",id:"redirect-using-return-best-practice",level:2},{value:"Remove <code>www</code> from Domain",id:"remove-www-from-domain",level:2},{value:"Add www to Domain",id:"add-www-to-domain",level:2},{value:"Redirect Old URLs to New URLs (SEO Migration)",id:"redirect-old-urls-to-new-urls-seo-migration",level:2},{value:"Conditional <code>Rewrite</code> with if (Use Carefully)",id:"conditional-rewrite-with-if-use-carefully",level:2},{value:"Language-Based Redirect",id:"language-based-redirect",level:2},{value:"Rewrite for API Versioning",id:"rewrite-for-api-versioning",level:2},{value:"Regex Capture Variables",id:"regex-capture-variables",level:2},{value:"Common Mistakes",id:"common-mistakes",level:2}];function h(e){const r={br:"br",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h2,{id:"what-are-rewrite--redirect-rules",children:"What Are Rewrite & Redirect Rules?"}),"\n",(0,s.jsx)(r.p,{children:"In NGINX, rewrite and redirect rules control how incoming URLs are handled:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Rewrite \u2192 Internally changes the URI without telling the browser"}),"\n",(0,s.jsx)(r.li,{children:"Redirect \u2192 Sends a response to the browser telling it to go to a different URL"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"They are commonly used for:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"SEO-friendly URLs"}),"\n",(0,s.jsx)(r.li,{children:"Enforcing HTTPS"}),"\n",(0,s.jsxs)(r.li,{children:["Removing ",(0,s.jsx)(r.code,{children:"www"})," or adding ",(0,s.jsx)(r.code,{children:"www"})]}),"\n",(0,s.jsx)(r.li,{children:"Legacy URL migration"}),"\n",(0,s.jsx)(r.li,{children:"API versioning"}),"\n",(0,s.jsx)(r.li,{children:"Language or country routing"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"rewrite-vs-redirect-key-difference",children:"Rewrite vs Redirect (Key Difference)"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Feature"}),(0,s.jsx)(r.th,{children:"Rewrite"}),(0,s.jsx)(r.th,{children:"Redirect"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"Browser URL changes?"}),(0,s.jsx)(r.td,{children:"\u274c No"}),(0,s.jsx)(r.td,{children:"\u2705 Yes"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"Client aware?"}),(0,s.jsx)(r.td,{children:"\u274c No"}),(0,s.jsx)(r.td,{children:"\u2705 Yes"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"HTTP status code"}),(0,s.jsx)(r.td,{children:"Not visible"}),(0,s.jsx)(r.td,{children:"301, 302, etc."})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"Performance"}),(0,s.jsx)(r.td,{children:"Faster"}),(0,s.jsx)(r.td,{children:"Slightly slower"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"SEO impact"}),(0,s.jsx)(r.td,{children:"Neutral"}),(0,s.jsx)(r.td,{children:"Very important"})]})]})]}),"\n",(0,s.jsx)(r.h2,{id:"rewrite-directive-internal-url-rewrite",children:"rewrite Directive (Internal URL Rewrite)"}),"\n",(0,s.jsx)(r.p,{children:"Basic Syntax"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"rewrite regex replacement [flag];\n"})}),"\n",(0,s.jsxs)(r.h3,{id:"example-remove-php-from-urls",children:["Example: Remove ",(0,s.jsx)(r.code,{children:".php"})," from URLs"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["URL Requested: ",(0,s.jsx)(r.code,{children:"/about"})]}),"\n",(0,s.jsxs)(r.li,{children:["Actual File: ",(0,s.jsx)(r.code,{children:"/about.php"})]}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"location / {\r\n    rewrite ^/([a-zA-Z0-9_-]+)$ /$1.php last;\r\n}\n"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"^/([a-zA-Z0-9_-]+)$"})," \u2192 Matches ",(0,s.jsx)(r.code,{children:"/about"})]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"$1.php"})," \u2192 Converts it to /about.php"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"last"})," \u2192 Re-process the request with the new URI"]}),"\n",(0,s.jsxs)(r.li,{children:["Browser still shows ",(0,s.jsx)(r.code,{children:"/about"})]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"rewrite-flags-very-important",children:"Rewrite Flags (Very Important)"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Flag"}),(0,s.jsx)(r.th,{children:"Meaning"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"last"})}),(0,s.jsx)(r.td,{children:"Re-evaluates location blocks"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"break"})}),(0,s.jsx)(r.td,{children:"Stops rewrite processing"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"redirect"})}),(0,s.jsx)(r.td,{children:"Temporary redirect (302)"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"permanent"})}),(0,s.jsx)(r.td,{children:"Permanent redirect (301)"})]})]})]}),"\n",(0,s.jsx)(r.h2,{id:"redirect-using-rewrite",children:"Redirect Using rewrite"}),"\n",(0,s.jsx)(r.p,{children:"Example: HTTP \u2192 HTTPS Redirect"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"server {\r\n    listen 80;\r\n    server_name example.com;\r\n\r\n    rewrite ^ https://example.com$request_uri permanent;\r\n}\n"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Redirects all HTTP traffic to HTTPS"}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"permanent"})," sends 301"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"$request_uri"})," preserves path & query string"]}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["Not recommended for complex logic (use ",(0,s.jsx)(r.code,{children:"return"})," instead)"]}),"\n",(0,s.jsxs)(r.h2,{id:"redirect-using-return-best-practice",children:["Redirect Using ",(0,s.jsx)(r.code,{children:"return"})," (Best Practice)"]}),"\n",(0,s.jsx)(r.p,{children:"Example: HTTP \u2192 HTTPS (Recommended)"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"server {\r\n    listen 80;\r\n    server_name example.com;\r\n\r\n    return 301 https://example.com$request_uri;\r\n}\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Why ",(0,s.jsx)(r.code,{children:"return"})," is Better: Faster, Clear, No regex evaluation, Best for simple redirects"]}),"\n",(0,s.jsxs)(r.h2,{id:"remove-www-from-domain",children:["Remove ",(0,s.jsx)(r.code,{children:"www"})," from Domain"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"server {\r\n    listen 80;\r\n    server_name www.example.com;\r\n\r\n    return 301 https://example.com$request_uri;\r\n}\n"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Forces a single canonical domain"}),"\n",(0,s.jsx)(r.li,{children:"Improves SEO"}),"\n",(0,s.jsx)(r.li,{children:"Avoids duplicate content"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"add-www-to-domain",children:"Add www to Domain"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"server {\r\n    listen 80;\r\n    server_name example.com;\r\n\r\n    return 301 https://www.example.com$request_uri;\r\n}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"redirect-old-urls-to-new-urls-seo-migration",children:"Redirect Old URLs to New URLs (SEO Migration)"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Old URL: ",(0,s.jsx)(r.code,{children:"/old-blog/my-post"})]}),"\n",(0,s.jsxs)(r.li,{children:["New URL: ",(0,s.jsx)(r.code,{children:"/blog/my-post"})]}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"rewrite ^/old-blog/(.*)$ /blog/$1 permanent;\n"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Captures everything after ",(0,s.jsx)(r.code,{children:"/old-blog/"})]}),"\n",(0,s.jsx)(r.li,{children:"Redirects with 301"}),"\n",(0,s.jsx)(r.li,{children:"Preserves SEO ranking"}),"\n"]}),"\n",(0,s.jsxs)(r.h2,{id:"conditional-rewrite-with-if-use-carefully",children:["Conditional ",(0,s.jsx)(r.code,{children:"Rewrite"})," with if (Use Carefully)"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"if ($request_method = POST) {\r\n    rewrite ^/submit$ /submit.php last;\r\n}\n"})}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.code,{children:"if"})," in NGINX can be dangerous if misused",(0,s.jsx)(r.br,{}),"\n","Safe when used for simple conditions like redirects"]}),"\n",(0,s.jsx)(r.h2,{id:"language-based-redirect",children:"Language-Based Redirect"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'location / {\r\n    if ($http_accept_language ~* "^fr") {\r\n        return 302 /fr;\r\n    }\r\n}\n'})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Detects browser language"}),"\n",(0,s.jsxs)(r.li,{children:["Redirects French users to ",(0,s.jsx)(r.code,{children:"/fr"})]}),"\n",(0,s.jsx)(r.li,{children:"Temporary redirect (302)"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"rewrite-for-api-versioning",children:"Rewrite for API Versioning"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"location /api/ {\r\n    rewrite ^/api/v1/(.*)$ /api/$1 break;\r\n}\n"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Keeps backend simple"}),"\n",(0,s.jsx)(r.li,{children:"Allows multiple API versions"}),"\n",(0,s.jsx)(r.li,{children:"Internal rewrite only"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"regex-capture-variables",children:"Regex Capture Variables"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"rewrite ^/product/([0-9]+)$ /item.php?id=$1 last;\n"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Example Request: ",(0,s.jsx)(r.code,{children:"/product/123"})]}),"\n",(0,s.jsxs)(r.li,{children:["Result: ",(0,s.jsx)(r.code,{children:"/item.php?id=123"})]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"common-mistakes",children:"Common Mistakes"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Using rewrite instead of return"}),"\n",(0,s.jsx)(r.li,{children:"Redirect loops"}),"\n",(0,s.jsx)(r.li,{children:"Too many regex rules"}),"\n",(0,s.jsx)(r.li,{children:"Using if for complex logic"}),"\n",(0,s.jsx)(r.li,{children:"Forgetting last or break"}),"\n"]})]})}function a(e={}){const{wrapper:r}={...(0,l.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);