"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[57318],{28453(e,n,i){i.d(n,{R:()=>t,x:()=>l});var s=i(96540);const r={},c=s.createContext(r);function t(e){const n=s.useContext(c);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(c.Provider,{value:n},e.children)}},86535(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>a,frontMatter:()=>t,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"nginx/Prefix Match","title":"Prefix Match","description":"Prefix matching means NGINX matches a request based on the beginning (prefix) of the URI.","source":"@site/docs/nginx/25. Prefix Match.md","sourceDirName":"nginx","slug":"/nginx/Prefix Match","permalink":"/handbook/docs/nginx/Prefix Match","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":25,"frontMatter":{},"sidebar":"nginxApiSidebar","previous":{"title":"Default Server","permalink":"/handbook/docs/nginx/Default Server"},"next":{"title":"Exact Match","permalink":"/handbook/docs/nginx/Exact Match"}}');var r=i(74848),c=i(28453);const t={},l=void 0,o={},h=[{value:"Prefix Matching Priority (Very Important)",id:"prefix-matching-priority-very-important",level:2},{value:"The Root (<code>/</code>) Prefix (Catch-All)",id:"the-root--prefix-catch-all",level:2},{value:"Prefix Match with <code>^~</code> (Stop Regex Checks)",id:"prefix-match-with--stop-regex-checks",level:2},{value:"Prefix Matching vs Exact Matching",id:"prefix-matching-vs-exact-matching",level:2},{value:"Prefix Matching with alias (Common Pitfall)",id:"prefix-matching-with-alias-common-pitfall",level:2},{value:"Common Use Cases for Prefix Locations",id:"common-use-cases-for-prefix-locations",level:2},{value:"Common Mistakes",id:"common-mistakes",level:2}];function d(e){const n={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Prefix matching means NGINX matches a request based on the beginning (prefix) of the URI."}),"\n",(0,r.jsxs)(n.p,{children:["If the request URI starts with a given path, that ",(0,r.jsx)(n.code,{children:"location"})," block is a candidate."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Request URI: /images/logo.png\r\nPrefix:      /images/\r\n\u2192 MATCH\n"})}),"\n",(0,r.jsx)(n.p,{children:"This type of match is used for: Static files, Application routes, API paths, Proxies, Almost everything in real-world configs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"location /path/ {\r\n    ...\r\n}\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/path/"})," is a literal prefix"]}),"\n",(0,r.jsx)(n.li,{children:"Matching is case-sensitive"}),"\n",(0,r.jsx)(n.li,{children:"No regex involved"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"server {\r\n    listen 80;\r\n    server_name example.com;\r\n\r\n    root /var/www/html;\r\n\r\n    location /images/ {\r\n        root /var/www/assets;\r\n    }\r\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"How This Works"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Request: ",(0,r.jsx)(n.code,{children:"/images/logo.png"})]}),"\n",(0,r.jsxs)(n.li,{children:["Matching logic","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Does ",(0,r.jsx)(n.code,{children:"/images/logo.png"})," start with ",(0,r.jsx)(n.code,{children:"/images/"}),"? \u2192 Yes"]}),"\n",(0,r.jsx)(n.li,{children:"NGINX selects this location"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["File served: ",(0,r.jsx)(n.code,{children:"/var/www/assets/images/logo.png"})]}),"\n",(0,r.jsxs)(n.li,{children:["Because: ",(0,r.jsx)(n.code,{children:"root /var/www/assets;"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"prefix-matching-priority-very-important",children:"Prefix Matching Priority (Very Important)"}),"\n",(0,r.jsxs)(n.p,{children:["NGINX evaluates ",(0,r.jsx)(n.code,{children:"location"})," blocks in this order:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Exact match (",(0,r.jsx)(n.code,{children:"location = /path"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Longest prefix match (",(0,r.jsx)(n.code,{children:"location /path/"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Regex match (",(0,r.jsx)(n.code,{children:"location ~"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Default (",(0,r.jsx)(n.code,{children:"location /"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Among prefix matches, the longest matching prefix wins."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"location /api/ {\r\n    proxy_pass http://backend_api;\r\n}\r\n\r\nlocation /api/v1/ {\r\n    proxy_pass http://backend_v1;\r\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Requests"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Request"}),(0,r.jsx)(n.th,{children:"Matched Location"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/api/users"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/api/"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/api/v1/users"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/api/v1/"})})]})]})]}),"\n",(0,r.jsxs)(n.h2,{id:"the-root--prefix-catch-all",children:["The Root (",(0,r.jsx)(n.code,{children:"/"}),") Prefix (Catch-All)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"location / {\r\n    try_files $uri $uri/ =404;\r\n}\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/"})," matches everything"]}),"\n",(0,r.jsx)(n.li,{children:"Acts as the default location"}),"\n",(0,r.jsx)(n.li,{children:"Used when no other location matches"}),"\n"]}),"\n",(0,r.jsxs)(n.h2,{id:"prefix-match-with--stop-regex-checks",children:["Prefix Match with ",(0,r.jsx)(n.code,{children:"^~"})," (Stop Regex Checks)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"location ^~ /static/ {\r\n    root /var/www/static;\r\n}\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If this prefix matches:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"NGINX skips regex checks"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Improves performance"}),"\n",(0,r.jsx)(n.li,{children:"Prevents regex from overriding this location"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Why ^~ Matters"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"location ^~ /images/ {\r\n    root /var/www/images;\r\n}\r\n\r\nlocation ~ \\.jpg$ {\r\n    root /var/www/jpg;\r\n}\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Request: ",(0,r.jsx)(n.code,{children:"/images/photo.jpg"})]}),"\n",(0,r.jsxs)(n.li,{children:["Result:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Prefix ",(0,r.jsx)(n.code,{children:"/images/"})," matches"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"^~"})," stops regex"]}),"\n",(0,r.jsxs)(n.li,{children:["Served from ",(0,r.jsx)(n.code,{children:"/var/www/images"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Without ",(0,r.jsx)(n.code,{children:"^~"}),", the regex location could win."]}),"\n",(0,r.jsx)(n.h2,{id:"prefix-matching-vs-exact-matching",children:"Prefix Matching vs Exact Matching"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"location = /login {\r\n    return 403;\r\n}\n"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Request"}),(0,r.jsx)(n.th,{children:"Matched"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/login"})}),(0,r.jsx)(n.td,{children:"Exact match"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/login/"})}),(0,r.jsxs)(n.td,{children:["Prefix ",(0,r.jsx)(n.code,{children:"/"})]})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Exact match is higher priority than prefix."})}),"\n",(0,r.jsx)(n.h2,{id:"prefix-matching-with-alias-common-pitfall",children:"Prefix Matching with alias (Common Pitfall)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"location /download/ {\r\n    alias /var/files/;\r\n}\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Request: ",(0,r.jsx)(n.code,{children:"/download/file.zip"})]}),"\n",(0,r.jsxs)(n.li,{children:["File served: ",(0,r.jsx)(n.code,{children:"/var/files/file.zip"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["With ",(0,r.jsx)(n.code,{children:"alias"}),", the location path is replaced, not appended."]}),"\n",(0,r.jsx)(n.h2,{id:"common-use-cases-for-prefix-locations",children:"Common Use Cases for Prefix Locations"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Static files"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"location /static/ {\r\n    root /var/www;\r\n    expires 30d;\r\n}\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"API routing"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"location /api/ {\r\n    proxy_pass http://api_backend;\r\n}\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"Application sections"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'location /admin/ {\r\n    auth_basic "Restricted";\r\n    auth_basic_user_file /etc/nginx/.htpasswd;\r\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"common-mistakes",children:"Common Mistakes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Forgetting trailing slash (",(0,r.jsx)(n.code,{children:"/path"})," vs ",(0,r.jsx)(n.code,{children:"/path/"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Expecting prefix matching to behave like regex"}),"\n",(0,r.jsxs)(n.li,{children:["Misusing ",(0,r.jsx)(n.code,{children:"root"})," vs ",(0,r.jsx)(n.code,{children:"alias"})]}),"\n",(0,r.jsx)(n.li,{children:"Not understanding longest prefix wins"}),"\n",(0,r.jsx)(n.li,{children:"Letting regex override important prefixes"}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);