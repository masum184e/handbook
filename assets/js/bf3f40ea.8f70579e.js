"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[43818],{28453(e,n,s){s.d(n,{R:()=>a,x:()=>d});var t=s(96540);const r={},i=t.createContext(r);function a(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:n},e.children)}},75184(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>l,frontMatter:()=>a,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"system-design/TCP Handshake","title":"TCP Handshake","description":"The TCP 3-way handshake is the process by which a client and server establish a reliable connection before exchanging data. It ensures that both sides are ready to communicate, sequence numbers are synchronized, and the network path is working.","source":"@site/docs/system-design/15. TCP Handshake.md","sourceDirName":"system-design","slug":"/system-design/TCP Handshake","permalink":"/handbook/docs/system-design/TCP Handshake","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":16,"frontMatter":{"sidebar_position":16},"sidebar":"systemDesignSidebar","previous":{"title":"TCP","permalink":"/handbook/docs/system-design/TCP"},"next":{"title":"TLS Handshake","permalink":"/handbook/docs/system-design/TLS Handshake"}}');var r=s(74848),i=s(28453);const a={sidebar_position:16},d=void 0,c={},o=[{value:"Step-by-Step: TCP 3-Way Handshake",id:"step-by-step-tcp-3-way-handshake",level:2},{value:"Purpose of TCP Handshake in System Design",id:"purpose-of-tcp-handshake-in-system-design",level:2},{value:"Diagram of TCP Handshake",id:"diagram-of-tcp-handshake",level:2},{value:"Example Scenario of TCP Handshake",id:"example-scenario-of-tcp-handshake",level:2},{value:"TCP Handshake with Node.js",id:"tcp-handshake-with-nodejs",level:2},{value:"TCP Handshake Use Cases",id:"tcp-handshake-use-cases",level:2},{value:"System Design Considerations of TCP Handshake",id:"system-design-considerations-of-tcp-handshake",level:2}];function h(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"The TCP 3-way handshake is the process by which a client and server establish a reliable connection before exchanging data. It ensures that both sides are ready to communicate, sequence numbers are synchronized, and the network path is working."}),"\n",(0,r.jsx)(n.h2,{id:"step-by-step-tcp-3-way-handshake",children:"Step-by-Step: TCP 3-Way Handshake"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Step"}),(0,r.jsx)(n.th,{children:"Sender \u2192 Receiver"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"1\ufe0f\u20e3 SYN"}),(0,r.jsx)(n.td,{children:"Client \u2192 Server"}),(0,r.jsxs)(n.td,{children:["Client sends a ",(0,r.jsx)(n.strong,{children:"SYN"})," (synchronize) packet with an initial sequence number (e.g., ",(0,r.jsx)(n.code,{children:"Seq = 100"}),") to start a connection."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"2\ufe0f\u20e3 SYN-ACK"}),(0,r.jsx)(n.td,{children:"Server \u2192 Client"}),(0,r.jsxs)(n.td,{children:["Server replies with a ",(0,r.jsx)(n.strong,{children:"SYN-ACK"}),": acknowledges client's SYN and sends its own SYN with its own initial sequence number (e.g., ",(0,r.jsx)(n.code,{children:"Seq = 500"}),", ",(0,r.jsx)(n.code,{children:"Ack = 101"}),")."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"3\ufe0f\u20e3 ACK"}),(0,r.jsx)(n.td,{children:"Client \u2192 Server"}),(0,r.jsxs)(n.td,{children:["Client sends back an ",(0,r.jsx)(n.strong,{children:"ACK"})," acknowledging the server\u2019s SYN (",(0,r.jsx)(n.code,{children:"Ack = 501"}),"). Connection is now established."]})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"purpose-of-tcp-handshake-in-system-design",children:"Purpose of TCP Handshake in System Design"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reliability:"})," Ensures both ends are ready and capable of communication."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Sequence Number Sync:"})," Sets up both sides to track packet order."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Avoids Half-Open Connections:"})," Prevents unintentional connections caused by dropped packets or old messages."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Security (partial):"})," Helps mitigate some basic spoofing or replay attacks by requiring return traffic."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"diagram-of-tcp-handshake",children:"Diagram of TCP Handshake"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Client                                Server\r\n  |                                     |\r\n  | ----------- SYN (Seq=100) --------\x3e |\r\n  |                                     |\r\n  | <------ SYN-ACK (Seq=500, Ack=101)--|\r\n  |                                     |\r\n  | ------- ACK (Seq=101, Ack=501) ----\x3e|\r\n  |                                     |\r\nConnection Established                  |\n"})}),"\n",(0,r.jsx)(n.h2,{id:"example-scenario-of-tcp-handshake",children:"Example Scenario of TCP Handshake"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Scenario:"})," Web Client \u2194 Web Server (HTTP over TCP)\r\nLet\u2019s say a user visits a website (e.g., ",(0,r.jsx)(n.a,{href:"https://example.com",children:"https://example.com"}),"):"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Browser initiates TCP connection to example.com on port 443."}),"\n",(0,r.jsx)(n.li,{children:"TCP 3-way handshake happens to establish a reliable connection."}),"\n",(0,r.jsx)(n.li,{children:"Once connected, HTTPS handshake begins, followed by HTTP request/response."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Without this TCP handshake, the HTTP request might go to a server that\u2019s not ready, causing dropped data or errors."}),"\n",(0,r.jsx)(n.h2,{id:"tcp-handshake-with-nodejs",children:"TCP Handshake with Node.js"}),"\n",(0,r.jsxs)(n.p,{children:["Although Node.js abstracts the actual handshake, here\u2019s how the ",(0,r.jsx)(n.code,{children:"net"})," module internally triggers it when ",(0,r.jsx)(n.code,{children:"connect()"})," is called:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Server"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'const net = require("net");\r\n\r\nconst server = net.createServer((socket) => {\r\n  console.log("Client connected"); // after handshake\r\n});\r\n\r\nserver.listen(3000, () => {\r\n  console.log("Server listening on port 3000");\r\n});\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Client"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'const net = require("net");\r\n\r\nconst client = net.createConnection({ port: 3000 }, () => {\r\n  console.log("Connected to server"); // handshake complete\r\n});\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["When client.createConnection() is called:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"OS sends SYN."}),"\n",(0,r.jsx)(n.li,{children:"Waits for SYN-ACK."}),"\n",(0,r.jsx)(n.li,{children:"Sends ACK."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:'Only after that will the "connect" callback fire.'}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"tcp-handshake-use-cases",children:"TCP Handshake Use Cases"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Use Case"}),(0,r.jsx)(n.th,{children:"How TCP Handshake Helps"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Microservices"})}),(0,r.jsx)(n.td,{children:"Ensures gRPC/HTTP clients don\u2019t send data until backend is ready."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Load balancers (e.g., Nginx, HAProxy)"})}),(0,r.jsx)(n.td,{children:"Wait for successful handshake before forwarding requests."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"API Gateways"})}),(0,r.jsx)(n.td,{children:"Establishes stable connection before passing request to backend service."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Database Clients"})}),(0,r.jsx)(n.td,{children:"PostgreSQL or MySQL drivers use handshake before sending queries."})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"system-design-considerations-of-tcp-handshake",children:"System Design Considerations of TCP Handshake"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Challenge"}),(0,r.jsx)(n.th,{children:"Explanation"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Latency"})}),(0,r.jsx)(n.td,{children:"Adds round-trip time before data starts flowing."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Half-open connections"})}),(0,r.jsx)(n.td,{children:"Clients that disconnect improperly can leave resources open on the server."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"SYN flood attacks"})}),(0,r.jsx)(n.td,{children:"Attackers can send many SYNs without completing handshake, overwhelming the server (Mitigated via SYN cookies or rate limiting)."})]})]})]})]})}function l(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);