"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[2604],{28453(e,r,n){n.d(r,{R:()=>a,x:()=>i});var s=n(96540);const l={},t=s.createContext(l);function a(e){const r=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),s.createElement(t.Provider,{value:r},e.children)}},38899(e,r,n){n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"system-design/Load Balancer","title":"Load Balancer","description":"A load balancer is a key component in system design that distributes incoming network or application traffic across multiple servers. Its primary goal is to optimize resource use, maximize throughput, reduce latency, and ensure fault tolerance.","source":"@site/docs/system-design/7. Load Balancer.md","sourceDirName":"system-design","slug":"/system-design/Load Balancer","permalink":"/handbook/docs/system-design/Load Balancer","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8},"sidebar":"systemDesignSidebar","previous":{"title":"API Gateway","permalink":"/handbook/docs/system-design/API Gateway"},"next":{"title":"Rate Limiting","permalink":"/handbook/docs/system-design/Rate Limiting"}}');var l=n(74848),t=n(28453);const a={sidebar_position:8},i=void 0,d={},o=[{value:"Load Balancer Does",id:"load-balancer-does",level:2},{value:"Types of Load Balancers",id:"types-of-load-balancers",level:2},{value:"Load Balancing Algorithms",id:"load-balancing-algorithms",level:2},{value:"Architecture Diagram Example of Load Balancer",id:"architecture-diagram-example-of-load-balancer",level:2},{value:"Example of Load Balancer",id:"example-of-load-balancer",level:2},{value:"Where Load Balancer used",id:"where-load-balancer-used",level:2},{value:"Layer 4 vs Layer 7 Load Balancers",id:"layer-4-vs-layer-7-load-balancers",level:2},{value:"Real Deployment Example Using AWS",id:"real-deployment-example-using-aws",level:2},{value:"Diagram",id:"diagram",level:3},{value:"Flow Explaination",id:"flow-explaination",level:4},{value:"Tools Used",id:"tools-used",level:4},{value:"Example of Load Balancer",id:"example-of-load-balancer-1",level:3},{value:"Custom Load Balancer in Node.js (Layer 4 Style)",id:"custom-load-balancer-in-nodejs-layer-4-style",level:4},{value:"Production Setup: Node.js Behind NGINX (Layer 7 Load Balancer)",id:"production-setup-nodejs-behind-nginx-layer-7-load-balancer",level:4},{value:"Summary of uses",id:"summary-of-uses",level:4},{value:"How Load Balancer Work",id:"how-load-balancer-work",level:2},{value:"1. Client Sends Request",id:"1-client-sends-request",level:3},{value:"2. Load Balancer Receives Request",id:"2-load-balancer-receives-request",level:3},{value:"3. Load Balancer Chooses a Backend Server",id:"3-load-balancer-chooses-a-backend-server",level:3},{value:"4. Request Is Forwarded",id:"4-request-is-forwarded",level:3},{value:"5. Backend Server Handles It",id:"5-backend-server-handles-it",level:3},{value:"6. Response Is Sent Back to Client",id:"6-response-is-sent-back-to-client",level:3},{value:"Behind the scene",id:"behind-the-scene",level:3},{value:"Real Example with Node.js Proxy",id:"real-example-with-nodejs-proxy",level:3},{value:"Health Check",id:"health-check",level:3},{value:"Workflow of Load Balancer",id:"workflow-of-load-balancer",level:3}];function c(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.p,{children:"A load balancer is a key component in system design that distributes incoming network or application traffic across multiple servers. Its primary goal is to optimize resource use, maximize throughput, reduce latency, and ensure fault tolerance."}),"\n",(0,l.jsx)(r.h2,{id:"load-balancer-does",children:"Load Balancer Does"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"Distributes client requests to multiple backend servers (web/app servers)."}),"\n",(0,l.jsx)(r.li,{children:"Prevents overloading a single server."}),"\n",(0,l.jsx)(r.li,{children:"Provides high availability\u2014if one server fails, traffic is rerouted to healthy servers."}),"\n",(0,l.jsx)(r.li,{children:"Improves scalability\u2014more servers can be added easily to handle increased load."}),"\n"]}),"\n",(0,l.jsx)(r.h2,{id:"types-of-load-balancers",children:"Types of Load Balancers"}),"\n",(0,l.jsxs)(r.table,{children:[(0,l.jsx)(r.thead,{children:(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.th,{children:"Type"}),(0,l.jsx)(r.th,{children:"Description"})]})}),(0,l.jsxs)(r.tbody,{children:[(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Layer 4 (Transport)"})}),(0,l.jsx)(r.td,{children:"Operates at TCP/UDP level. Balances based on IP and port. Fast and simple."})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Layer 7 (Application)"})}),(0,l.jsx)(r.td,{children:"Operates at HTTP/HTTPS level. Can inspect content (URLs, cookies, etc.)."})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Global Load Balancer"})}),(0,l.jsx)(r.td,{children:"Routes traffic between data centers or regions."})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Internal Load Balancer"})}),(0,l.jsx)(r.td,{children:"Routes traffic between microservices or internal systems."})]})]})]}),"\n",(0,l.jsx)(r.h2,{id:"load-balancing-algorithms",children:"Load Balancing Algorithms"}),"\n",(0,l.jsxs)(r.table,{children:[(0,l.jsx)(r.thead,{children:(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.th,{children:"Algorithm"}),(0,l.jsx)(r.th,{children:"Description"})]})}),(0,l.jsxs)(r.tbody,{children:[(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Round Robin"})}),(0,l.jsx)(r.td,{children:"Requests are sent to each server in order."})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Least Connections"})}),(0,l.jsx)(r.td,{children:"Sends traffic to the server with the fewest active connections."})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"IP Hash"})}),(0,l.jsx)(r.td,{children:"Uses client's IP address to determine which server handles the request."})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Weighted"})}),(0,l.jsx)(r.td,{children:"Assigns more traffic to stronger servers with more capacity."})]})]})]}),"\n",(0,l.jsx)(r.h2,{id:"architecture-diagram-example-of-load-balancer",children:"Architecture Diagram Example of Load Balancer"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{children:"                +---------------------+\r\n                |     Clients         |\r\n                +---------------------+\r\n                          |\r\n                          v\r\n               +----------------------+\r\n               |     Load Balancer    |  <--- Entry point (L4 or L7)\r\n               +----------------------+\r\n              /           |            \\\r\n             v            v             v\r\n    +------------+  +------------+  +------------+\r\n    | WebServer1 |  | WebServer2 |  | WebServer3 |\r\n    +------------+  +------------+  +------------+\n"})}),"\n",(0,l.jsx)(r.h2,{id:"example-of-load-balancer",children:"Example of Load Balancer"}),"\n",(0,l.jsx)(r.p,{children:"Let\u2019s say you are building an online store like Amazon:"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"Traffic increases dramatically during sales events."}),"\n",(0,l.jsx)(r.li,{children:"You deploy three web servers behind a Layer 7 Load Balancer (e.g., AWS ELB, Nginx, HAProxy)."}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:"What happens:"}),"\n",(0,l.jsxs)(r.ol,{children:["\n",(0,l.jsxs)(r.li,{children:["User A accesses ",(0,l.jsx)(r.a,{href:"http://www.store.com",children:"www.store.com"}),"."]}),"\n",(0,l.jsx)(r.li,{children:"Request goes to the Load Balancer."}),"\n",(0,l.jsxs)(r.li,{children:["The Load Balancer:","\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"Checks which server is least loaded."}),"\n",(0,l.jsx)(r.li,{children:"Sends User A\u2019s request to WebServer2."}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.li,{children:"WebServer2 handles the request and returns the response."}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:"If WebServer2 crashes:"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"Load balancer detects health check failure."}),"\n",(0,l.jsx)(r.li,{children:"Redirects future requests to WebServer1 and WebServer3."}),"\n"]}),"\n",(0,l.jsx)(r.h2,{id:"where-load-balancer-used",children:"Where Load Balancer used"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.strong,{children:"Frontend Traffic Management"}),": Distributes user traffic across web servers."]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.strong,{children:"Microservices Communication"}),": Distributes service-to-service calls."]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.strong,{children:"Multi-region Deployments"}),": Global load balancers distribute traffic across continents."]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.strong,{children:"Autoscaling"}),": Automatically routes traffic to newly created instances."]}),"\n"]}),"\n",(0,l.jsx)(r.h2,{id:"layer-4-vs-layer-7-load-balancers",children:"Layer 4 vs Layer 7 Load Balancers"}),"\n",(0,l.jsxs)(r.table,{children:[(0,l.jsx)(r.thead,{children:(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.th,{children:"Feature"}),(0,l.jsx)(r.th,{children:(0,l.jsx)(r.strong,{children:"Layer 4 Load Balancer"})}),(0,l.jsx)(r.th,{children:(0,l.jsx)(r.strong,{children:"Layer 7 Load Balancer"})})]})}),(0,l.jsxs)(r.tbody,{children:[(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"OSI Layer"})}),(0,l.jsx)(r.td,{children:"Transport Layer (TCP/UDP)"}),(0,l.jsx)(r.td,{children:"Application Layer (HTTP/HTTPS)"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Traffic Type"})}),(0,l.jsx)(r.td,{children:"Low-level protocols (TCP, UDP)"}),(0,l.jsx)(r.td,{children:"High-level protocols (HTTP, WebSocket, gRPC)"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Routing Logic"})}),(0,l.jsx)(r.td,{children:"Based on IP address and port"}),(0,l.jsx)(r.td,{children:"Based on URL path, headers, cookies, request content, etc."})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Performance"})}),(0,l.jsx)(r.td,{children:"Faster, lower latency (less inspection)"}),(0,l.jsx)(r.td,{children:"Slightly slower due to deep packet inspection"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Use Case"})}),(0,l.jsx)(r.td,{children:"Game servers, database traffic, generic TCP services"}),(0,l.jsx)(r.td,{children:"Web applications, REST APIs, websites"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Sticky Sessions"})}),(0,l.jsx)(r.td,{children:"Via IP hash or custom setup"}),(0,l.jsx)(r.td,{children:"Supports cookie-based session persistence"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"SSL Termination"})}),(0,l.jsx)(r.td,{children:"Often not supported or limited"}),(0,l.jsx)(r.td,{children:"Fully supported"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Flexibility"})}),(0,l.jsx)(r.td,{children:"Limited routing logic"}),(0,l.jsxs)(r.td,{children:["Highly flexible (can route ",(0,l.jsx)(r.code,{children:"/api/"})," to one service, ",(0,l.jsx)(r.code,{children:"/admin/"})," to another)"]})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Examples"})}),(0,l.jsx)(r.td,{children:"HAProxy (TCP mode), AWS NLB"}),(0,l.jsx)(r.td,{children:"NGINX (HTTP mode), AWS ALB, Envoy, Traefik"})]})]})]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.strong,{children:"Layer 4"}),": You\u2019re routing database or chat server traffic (TCP-based)."]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.strong,{children:"Layer 7"}),": You\u2019re routing different API endpoints to different microservices based on URL path."]}),"\n"]}),"\n",(0,l.jsx)(r.h2,{id:"real-deployment-example-using-aws",children:"Real Deployment Example Using AWS"}),"\n",(0,l.jsx)(r.p,{children:"Components:"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"3 EC2 Instances (Web Servers)"}),"\n",(0,l.jsx)(r.li,{children:"Amazon Application Load Balancer (ALB - Layer 7)"}),"\n",(0,l.jsx)(r.li,{children:"Auto Scaling Group"}),"\n",(0,l.jsx)(r.li,{children:"Amazon Route 53 (optional, for domain)"}),"\n"]}),"\n",(0,l.jsx)(r.h3,{id:"diagram",children:"Diagram"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{children:"     User (Browser)\r\n          |\r\n     Route 53 (DNS)\r\n          |\r\n   Application Load Balancer (Layer 7)\r\n          |\r\n   Auto Scaling Group (EC2 Instances)\r\n     /         |         \\\r\n EC2-1     EC2-2     EC2-3 (Web servers)\n"})}),"\n",(0,l.jsx)(r.h4,{id:"flow-explaination",children:"Flow Explaination"}),"\n",(0,l.jsxs)(r.ol,{children:["\n",(0,l.jsxs)(r.li,{children:["User visits ",(0,l.jsx)(r.a,{href:"http://www.example.com",children:"www.example.com"}),"."]}),"\n",(0,l.jsx)(r.li,{children:"Route 53 resolves the domain to ALB IP."}),"\n",(0,l.jsxs)(r.li,{children:["ALB inspects the HTTP request:","\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"If request is /api/, route to Service A"}),"\n",(0,l.jsx)(r.li,{children:"If request is /admin/, route to Service B"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.li,{children:"The ALB sends the request to one of the EC2 instances in the Auto Scaling Group, using Least Connections or Round Robin."}),"\n",(0,l.jsx)(r.li,{children:"If one instance fails, ALB detects it via health checks and reroutes traffic to healthy instances."}),"\n",(0,l.jsx)(r.li,{children:"You can scale up/down the number of EC2s automatically based on CPU or request rate."}),"\n"]}),"\n",(0,l.jsx)(r.h4,{id:"tools-used",children:"Tools Used"}),"\n",(0,l.jsxs)(r.table,{children:[(0,l.jsx)(r.thead,{children:(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.th,{children:"Component"}),(0,l.jsx)(r.th,{children:"AWS Service"})]})}),(0,l.jsxs)(r.tbody,{children:[(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"Load Balancer"}),(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Application Load Balancer (ALB)"})})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"Backend Servers"}),(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"EC2 Auto Scaling Group"})})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"Routing Domain"}),(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Route 53"})})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"Health Monitoring"}),(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"ALB Health Checks"})})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"SSL Support"}),(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"SSL Termination at ALB"})})]})]})]}),"\n",(0,l.jsx)(r.h3,{id:"example-of-load-balancer-1",children:"Example of Load Balancer"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{children:"           Client\r\n             |\r\n      Node.js Load Balancer (custom)\r\n         /         |        \\\r\n   App Server 1  App Server 2  App Server 3\r\n   (Node.js)     (Node.js)     (Node.js)\n"})}),"\n",(0,l.jsx)(r.h4,{id:"custom-load-balancer-in-nodejs-layer-4-style",children:"Custom Load Balancer in Node.js (Layer 4 Style)"}),"\n",(0,l.jsxs)(r.p,{children:["You can create a basic TCP/HTTP round-robin load balancer in Node.js using the ",(0,l.jsx)(r.code,{children:"http"})," and ",(0,l.jsx)(r.code,{children:"http-proxy"})," or ",(0,l.jsx)(r.code,{children:"net"})," modules."]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsxs)(r.strong,{children:["Create Load Balancer (",(0,l.jsx)(r.code,{children:"load-balancer.js"}),"):"]})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-js",children:'const http = require("http");\r\nconst httpProxy = require("http-proxy");\r\n\r\n// Create a proxy server\r\nconst proxy = httpProxy.createProxyServer({});\r\n\r\n// Backend server targets\r\nconst targets = [\r\n  { host: "localhost", port: 3001 },\r\n  { host: "localhost", port: 3002 },\r\n  { host: "localhost", port: 3003 },\r\n];\r\n\r\nlet current = 0;\r\n\r\n// Create the load balancer server\r\nconst server = http.createServer((req, res) => {\r\n  // Round-robin selection\r\n  const target = targets[current];\r\n  current = (current + 1) % targets.length;\r\n\r\n  proxy.web(\r\n    req,\r\n    res,\r\n    { target: `http://${target.host}:${target.port}` },\r\n    (err) => {\r\n      res.writeHead(502);\r\n      res.end("Bad Gateway");\r\n    }\r\n  );\r\n});\r\n\r\nserver.listen(8000, () => {\r\n  console.log("Load balancer listening on http://localhost:8000");\r\n});\n'})}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsxs)(r.strong,{children:["Create Backend App Servers (",(0,l.jsx)(r.code,{children:"app-server.js"}),"):"]})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-js",children:'const http = require("http");\r\n\r\nconst port = process.env.PORT || 3001;\r\n\r\nconst server = http.createServer((req, res) => {\r\n  res.writeHead(200);\r\n  res.end(`Response from server on port ${port}`);\r\n});\r\n\r\nserver.listen(port, () => {\r\n  console.log(`Server running on port ${port}`);\r\n});\n'})}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.strong,{children:"Run Everything:"})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-shell",children:"PORT=3001 node app-server.js\r\nPORT=3002 node app-server.js\r\nPORT=3003 node app-server.js\r\nnode load-balancer.js\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["Now, open ",(0,l.jsx)(r.code,{children:"http://localhost:8000"})," in the browser."]}),"\n",(0,l.jsx)(r.li,{children:"Refresh multiple times \u2014 you'll see responses rotating from each app server."}),"\n"]}),"\n",(0,l.jsx)(r.h4,{id:"production-setup-nodejs-behind-nginx-layer-7-load-balancer",children:"Production Setup: Node.js Behind NGINX (Layer 7 Load Balancer)"}),"\n",(0,l.jsx)(r.p,{children:"Use NGINX to load balance requests across multiple Node.js servers."}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.strong,{children:"File Structure:"})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{children:"project/\r\n\u251c\u2500\u2500 server1.js\r\n\u251c\u2500\u2500 server2.js\r\n\u251c\u2500\u2500 server3.js\r\n\u251c\u2500\u2500 nginx.conf\n"})}),"\n",(0,l.jsxs)(r.p,{children:["Each can be the same as earlier (",(0,l.jsx)(r.code,{children:"serverX.js"}),"):"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-js",children:'// server1.js\r\nconst http = require("http");\r\nconst port = process.env.PORT || 3001;\r\n\r\nconst server = http.createServer((req, res) => {\r\n  res.writeHead(200);\r\n  res.end(`Hello from Node server on port ${port}`);\r\n});\r\n\r\nserver.listen(port, () => console.log(`Server running on port ${port}`));\n'})}),"\n",(0,l.jsx)(r.p,{children:"Launch:"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-shell",children:"PORT=3001 node server1.js\r\nPORT=3002 node server2.js\r\nPORT=3003 node server3.js\n"})}),"\n",(0,l.jsxs)(r.p,{children:["Configure NGINX (",(0,l.jsx)(r.code,{children:"nginx.conf"}),")"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-shell",children:"http {\r\n    upstream node_servers {\r\n        server 127.0.0.1:3001;\r\n        server 127.0.0.1:3002;\r\n        server 127.0.0.1:3003;\r\n    }\r\n\r\n    server {\r\n        listen 8000;\r\n\r\n        location / {\r\n            proxy_pass http://node_servers;\r\n            proxy_http_version 1.1;\r\n            proxy_set_header Upgrade $http_upgrade;\r\n            proxy_set_header Connection 'upgrade';\r\n            proxy_set_header Host $host;\r\n            proxy_cache_bypass $http_upgrade;\r\n        }\r\n    }\r\n}\n"})}),"\n",(0,l.jsx)(r.p,{children:"Reload or restart NGINX:"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-shell",children:"nginx -c /path/to/nginx.conf\r\nnginx -s reload\n"})}),"\n",(0,l.jsxs)(r.p,{children:["Now when you visit ",(0,l.jsx)(r.code,{children:"http://localhost:8000"}),", NGINX will load balance between Node.js servers."]}),"\n",(0,l.jsx)(r.h4,{id:"summary-of-uses",children:"Summary of uses"}),"\n",(0,l.jsxs)(r.table,{children:[(0,l.jsx)(r.thead,{children:(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.th,{children:"Approach"}),(0,l.jsx)(r.th,{children:"Use Case"}),(0,l.jsx)(r.th,{children:"Tools"})]})}),(0,l.jsxs)(r.tbody,{children:[(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"Node.js custom balancer"}),(0,l.jsx)(r.td,{children:"Learning, dev testing"}),(0,l.jsx)(r.td,{children:(0,l.jsx)(r.code,{children:"http-proxy"})})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"NGINX + Node.js"}),(0,l.jsx)(r.td,{children:"Production-grade, static routing"}),(0,l.jsx)(r.td,{children:"NGINX"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"AWS ALB + Node.js"}),(0,l.jsx)(r.td,{children:"Scalable cloud apps"}),(0,l.jsx)(r.td,{children:"EC2, ALB, Route 53"})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:"Kubernetes + Ingress"}),(0,l.jsx)(r.td,{children:"Containerized Node.js apps"}),(0,l.jsx)(r.td,{children:"K8s, Ingress"})]})]})]}),"\n",(0,l.jsx)(r.h2,{id:"how-load-balancer-work",children:"How Load Balancer Work"}),"\n",(0,l.jsx)(r.p,{children:"Imagine you have multiple Node.js servers, each running the same app (like an API or website). A load balancer sits in front of these servers and acts like a traffic controller:"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"It accepts incoming requests from users."}),"\n",(0,l.jsx)(r.li,{children:"It decides which server should handle each request (based on a strategy like round robin or least connections)."}),"\n",(0,l.jsx)(r.li,{children:"It forwards the request to that chosen server."}),"\n",(0,l.jsx)(r.li,{children:"The chosen server sends the response back, and the load balancer relays it to the user."}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:"Let\u2019s say you have this setup:"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"3 Node.js servers on ports 3001, 3002, and 3003"}),"\n",(0,l.jsxs)(r.li,{children:["1 Load balancer on port 8000 (either NGINX or a custom one with ",(0,l.jsx)(r.code,{children:"http-proxy"}),")"]}),"\n"]}),"\n",(0,l.jsx)(r.h3,{id:"1-client-sends-request",children:"1. Client Sends Request"}),"\n",(0,l.jsx)(r.p,{children:"User opens a browser and visits:"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-shell",children:"http://localhost:8000/api/products\n"})}),"\n",(0,l.jsx)(r.p,{children:"This request hits the load balancer, not the app servers directly."}),"\n",(0,l.jsx)(r.h3,{id:"2-load-balancer-receives-request",children:"2. Load Balancer Receives Request"}),"\n",(0,l.jsx)(r.p,{children:"The load balancer server (Node.js or NGINX) listens on port 8000."}),"\n",(0,l.jsx)(r.p,{children:"It receives the request like this:"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-shell",children:"GET /api/products HTTP/1.1\r\nHost: localhost:8000\n"})}),"\n",(0,l.jsx)(r.h3,{id:"3-load-balancer-chooses-a-backend-server",children:"3. Load Balancer Chooses a Backend Server"}),"\n",(0,l.jsx)(r.p,{children:"It uses a load balancing algorithm such as:"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"Round robin: rotates through the server list."}),"\n",(0,l.jsx)(r.li,{children:"Least connections: chooses the least busy server."}),"\n",(0,l.jsx)(r.li,{children:"IP hash: chooses based on the user\u2019s IP.\r\nLet\u2019s say it's round robin and the current turn is:"}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-js",children:'target = { host: "localhost", port: 3002 };\n'})}),"\n",(0,l.jsx)(r.h3,{id:"4-request-is-forwarded",children:"4. Request Is Forwarded"}),"\n",(0,l.jsxs)(r.p,{children:["Using a proxy (like ",(0,l.jsx)(r.code,{children:"http-proxy"})," in Node.js or ",(0,l.jsx)(r.code,{children:"proxy_pass"})," in NGINX), the load balancer forwards the original HTTP request to the selected server:"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-shell",children:"GET /api/products HTTP/1.1\r\nHost: localhost:3002\n"})}),"\n",(0,l.jsx)(r.h3,{id:"5-backend-server-handles-it",children:"5. Backend Server Handles It"}),"\n",(0,l.jsx)(r.p,{children:"Node.js server on port 3002 receives the request and runs the handler:"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-js",children:'res.end("Product list from server 3002");\n'})}),"\n",(0,l.jsx)(r.h3,{id:"6-response-is-sent-back-to-client",children:"6. Response Is Sent Back to Client"}),"\n",(0,l.jsx)(r.p,{children:"The response travels:"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-js",children:"Node.js server \u2192 Load Balancer \u2192 Client\n"})}),"\n",(0,l.jsx)(r.p,{children:"The user sees:"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-js",children:"Product list from server 3002\n"})}),"\n",(0,l.jsx)(r.p,{children:"Even though the client sent the request to port 8000, the load balancer internally managed all the routing."}),"\n",(0,l.jsx)(r.h3,{id:"behind-the-scene",children:"Behind the scene"}),"\n",(0,l.jsxs)(r.table,{children:[(0,l.jsx)(r.thead,{children:(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.th,{children:"Layer"}),(0,l.jsx)(r.th,{children:"Role"})]})}),(0,l.jsxs)(r.tbody,{children:[(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Layer 4"})}),(0,l.jsx)(r.td,{children:"If using TCP/UDP only, load balancer just reroutes IP + port (doesn't inspect HTTP data)."})]}),(0,l.jsxs)(r.tr,{children:[(0,l.jsx)(r.td,{children:(0,l.jsx)(r.strong,{children:"Layer 7"})}),(0,l.jsxs)(r.td,{children:["Load balancer looks inside HTTP headers and URLs, enabling smart routing (e.g., send ",(0,l.jsx)(r.code,{children:"/admin"})," to different backend)."]})]})]})]}),"\n",(0,l.jsx)(r.h3,{id:"real-example-with-nodejs-proxy",children:"Real Example with Node.js Proxy"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-js",children:"proxy.web(req, res, {\r\n  target: `http://${target.host}:${target.port}`,\r\n});\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"proxy.web()"})," forwards the HTTP request to the chosen backend."]}),"\n",(0,l.jsx)(r.li,{children:"It streams data in real-time, handling headers, body, and response."}),"\n",(0,l.jsx)(r.li,{children:"It also listens for errors and falls back if one server is down."}),"\n"]}),"\n",(0,l.jsx)(r.h3,{id:"health-check",children:"Health Check"}),"\n",(0,l.jsxs)(r.p,{children:["A good load balancer (like NGINX, HAProxy, or AWS ALB) periodically checks if each server is healthy by sending a small test request (",(0,l.jsx)(r.code,{children:"GET /healthz"}),").\r\nIf a server is down:"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"It\u2019s removed from the rotation automatically."}),"\n",(0,l.jsx)(r.li,{children:"Traffic continues flowing to the healthy servers."}),"\n"]}),"\n",(0,l.jsx)(r.h3,{id:"workflow-of-load-balancer",children:"Workflow of Load Balancer"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{children:"[Client Request]\r\n      \u2193\r\n[Load Balancer]\r\n      \u2193 (decides which backend to use)\r\n[Forwarded to Node.js Server]\r\n      \u2193\r\n[Node.js Server Response]\r\n      \u2193\r\n[Load Balancer relays response]\r\n      \u2193\r\n[Client gets the result]\n"})})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,l.jsx)(r,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}}}]);