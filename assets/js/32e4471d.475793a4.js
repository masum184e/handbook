"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[91943],{28453(n,e,s){s.d(e,{R:()=>t,x:()=>o});var a=s(96540);const r={},c=a.createContext(r);function t(n){const e=a.useContext(c);return a.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:t(n.components),a.createElement(c.Provider,{value:e},n.children)}},53058(n,e,s){s.r(e),s.d(e,{assets:()=>i,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"mysql/Transaction","title":"Transaction","description":"A transaction in MySQL is a sequence of one or more SQL statements that are executed as a single unit of work.","source":"@site/docs/mysql/16. Transaction.md","sourceDirName":"mysql","slug":"/mysql/Transaction","permalink":"/handbook/docs/mysql/Transaction","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":17,"frontMatter":{"sidebar_position":17},"sidebar":"mysqlSidebar","previous":{"title":"Events","permalink":"/handbook/docs/mysql/Events"},"next":{"title":"ACID Properties","permalink":"/handbook/docs/mysql/ACID Properties"}}');var r=s(74848),c=s(28453);const t={sidebar_position:17},o=void 0,i={},l=[{value:"Basic Transaction Commands",id:"basic-transaction-commands",level:2},{value:"Bank Transfer (Atomic Transaction)",id:"bank-transfer-atomic-transaction",level:2},{value:"Using <code>ROLLBACK</code>",id:"using-rollback",level:2},{value:"Using <code>SAVEPOINT</code>",id:"using-savepoint",level:2},{value:"Key Notes on Transaction",id:"key-notes-on-transaction",level:2}];function d(n){const e={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.p,{children:"A transaction in MySQL is a sequence of one or more SQL statements that are executed as a single unit of work.\r\nIt ensures that either all operations succeed, or none of them do."}),"\n",(0,r.jsx)(e.p,{children:"Transactions follow the ACID properties:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Atomicity"})," \u2192 All statements in a transaction succeed or fail together."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Consistency"})," \u2192 Data must remain valid before and after the transaction."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Isolation"})," \u2192 Multiple transactions do not interfere with each other."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Durability"})," \u2192 Once a transaction is committed, changes are permanent."]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"When Do We Use Transactions?"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Banking systems (transfer money from one account to another)."}),"\n",(0,r.jsx)(e.li,{children:"Booking systems (seat reservation)."}),"\n",(0,r.jsx)(e.li,{children:"Inventory management (stock adjustments)."}),"\n",(0,r.jsx)(e.li,{children:"Any scenario where data integrity is critical."}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"basic-transaction-commands",children:"Basic Transaction Commands"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"START TRANSACTION"}),"; \u2192 Begins a new transaction.\r\n(or ",(0,r.jsx)(e.code,{children:"BEGIN"}),"; as a shortcut)"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"COMMIT;"})," \u2192 Saves all changes permanently."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"ROLLBACK;"})," \u2192 Cancels the transaction and restores the data to its state before ",(0,r.jsx)(e.code,{children:"START TRANSACTION"}),"."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"SAVEPOINT name;"})," \u2192 Sets a savepoint within a transaction."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"ROLLBACK TO name;"})," \u2192 Rolls back only up to the specified savepoint."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"SET AUTOCOMMIT = 0;"})," \u2192 Turns off automatic commit (MySQL normally commits after every statement by default)."]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"bank-transfer-atomic-transaction",children:"Bank Transfer (Atomic Transaction)"}),"\n",(0,r.jsxs)(e.p,{children:["Imagine you are transferring 1000 BDT from ",(0,r.jsx)(e.code,{children:"Account A"})," to ",(0,r.jsx)(e.code,{children:"Account B"}),"."]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Table"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE accounts (\r\n    account_id INT PRIMARY KEY,\r\n    name VARCHAR(50),\r\n    balance DECIMAL(10,2)\r\n);\r\n\r\nINSERT INTO accounts VALUES\r\n(1, 'Alice', 5000.00),\r\n(2, 'Bob', 3000.00);\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Transaction"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"START TRANSACTION;\r\n\r\n-- Step 1: Deduct 1000 from Alice\r\nUPDATE accounts\r\nSET balance = balance - 1000\r\nWHERE account_id = 1;\r\n\r\n-- Step 2: Add 1000 to Bob\r\nUPDATE accounts\r\nSET balance = balance + 1000\r\nWHERE account_id = 2;\r\n\r\n-- Commit if both succeed\r\nCOMMIT;\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"If both updates succeed \u2192 Changes are saved."}),"\n",(0,r.jsxs)(e.li,{children:["If any step fails (e.g., system crash after deduction but before deposit) \u2192 You can ",(0,r.jsx)(e.code,{children:"ROLLBACK"}),"; to undo changes."]}),"\n"]}),"\n",(0,r.jsxs)(e.h2,{id:"using-rollback",children:["Using ",(0,r.jsx)(e.code,{children:"ROLLBACK"})]}),"\n",(0,r.jsx)(e.p,{children:"Suppose Alice tries to transfer 6000 BDT (but she only has 5000)."}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"START TRANSACTION;\r\n\r\nUPDATE accounts\r\nSET balance = balance - 6000\r\nWHERE account_id = 1;\r\n\r\nUPDATE accounts\r\nSET balance = balance + 6000\r\nWHERE account_id = 2;\r\n\r\n-- Now check Alice\u2019s balance\r\nSELECT balance FROM accounts WHERE account_id = 1;\r\n\r\n-- If balance < 0, rollback\r\nROLLBACK;\n"})}),"\n",(0,r.jsx)(e.p,{children:"Result \u2192 No money transferred, balances remain unchanged."}),"\n",(0,r.jsxs)(e.h2,{id:"using-savepoint",children:["Using ",(0,r.jsx)(e.code,{children:"SAVEPOINT"})]}),"\n",(0,r.jsx)(e.p,{children:"You can partially undo operations."}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"START TRANSACTION;\r\n\r\n-- Deduct from Alice\r\nUPDATE accounts SET balance = balance - 500 WHERE account_id = 1;\r\nSAVEPOINT after_deduct;\r\n\r\n-- Add to Bob\r\nUPDATE accounts SET balance = balance + 500 WHERE account_id = 2;\r\n\r\n-- Oops, wrong account! Roll back only the second step\r\nROLLBACK TO after_deduct;\r\n\r\n-- Commit only Alice\u2019s deduction\r\nCOMMIT;\n"})}),"\n",(0,r.jsx)(e.p,{children:"Alice\u2019s balance is reduced by 500, but Bob didn\u2019t get credited because we rolled back."}),"\n",(0,r.jsx)(e.h2,{id:"key-notes-on-transaction",children:"Key Notes on Transaction"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Transactions only work on transactional storage engines like InnoDB (not MyISAM)."}),"\n",(0,r.jsxs)(e.li,{children:["Always check if autocommit is ON (default in MySQL). If it is, use ",(0,r.jsx)(e.code,{children:"SET AUTOCOMMIT=0;"}),"."]}),"\n",(0,r.jsx)(e.li,{children:"Use transactions in critical data operations where partial updates would cause inconsistencies."}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}}}]);