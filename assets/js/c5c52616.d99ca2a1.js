"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[3774],{24747(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>x,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"redis/Monitoring","title":"Monitoring","description":"Redis MONITOR \u2014 Real-Time Command Inspection","source":"@site/docs/redis/17. Monitoring.md","sourceDirName":"redis","slug":"/redis/Monitoring","permalink":"/handbook/docs/redis/Monitoring","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":17,"frontMatter":{"sidebar_position":17},"sidebar":"redisApiSidebar","previous":{"title":"Connection Pooling","permalink":"/handbook/docs/redis/Connection Pooling"},"next":{"title":"Log Analysis","permalink":"/handbook/docs/redis/Log Analysis"}}');var d=s(74848),r=s(28453);const l={sidebar_position:17},t=void 0,c={},o=[{value:"Redis MONITOR \u2014 Real-Time Command Inspection",id:"redis-monitor--real-time-command-inspection",level:2},{value:"Redis INFO \u2014 Health, Stats, and System Overview",id:"redis-info--health-stats-and-system-overview",level:2},{value:"Redis SLOWLOG \u2014 Detect Slow Commands",id:"redis-slowlog--detect-slow-commands",level:2},{value:"How to configure Slow Log",id:"how-to-configure-slow-log",level:3},{value:"Adding a Slow Command",id:"adding-a-slow-command",level:3},{value:"Viewing the Slow Log",id:"viewing-the-slow-log",level:3},{value:"Memory Usage Inspection",id:"memory-usage-inspection",level:2}];function h(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.h2,{id:"redis-monitor--real-time-command-inspection",children:"Redis MONITOR \u2014 Real-Time Command Inspection"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"MONITOR"})," streams every command that Redis processes in real time."]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"What it shows:"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Every Redis command executed"}),"\n",(0,d.jsx)(n.li,{children:"The exact arguments"}),"\n",(0,d.jsx)(n.li,{children:"The client issuing it"}),"\n",(0,d.jsx)(n.li,{children:"Millisecond timestamps"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"When to use:"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Debugging application behavior"}),"\n",(0,d.jsx)(n.li,{children:"Detecting unexpected commands"}),"\n",(0,d.jsx)(n.li,{children:"Real-time auditing"}),"\n",(0,d.jsx)(n.li,{children:"Checking if clients are overloading Redis with unnecessary calls"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Caution:"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"MONITOR"})," is slow and CPU-heavy because it logs every operation."]}),"\n",(0,d.jsx)(n.li,{children:"Use on development or temporary debugging, not production long-term."}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Output Example:"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'1617043000.123456 [0 127.0.0.1:51726] "SET" "user:1" "Alice"\r\n1617043000.123789 [0 127.0.0.1:51726] "INCR" "visits"\r\n1617043000.124001 [0 127.0.0.1:51726] "LPUSH" "tasks" "task1"\n'})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Timestamp: ",(0,d.jsx)(n.code,{children:"1617043000.123456"})]}),"\n",(0,d.jsxs)(n.li,{children:["DB index: ",(0,d.jsx)(n.code,{children:"[0"})]}),"\n",(0,d.jsxs)(n.li,{children:["Client IP: ",(0,d.jsx)(n.code,{children:"127.0.0.1"})]}),"\n",(0,d.jsxs)(n.li,{children:["Command: ",(0,d.jsx)(n.code,{children:'"SET"'}),", ",(0,d.jsx)(n.code,{children:'"INCR"'}),", ",(0,d.jsx)(n.code,{children:'"LPUSH"'})]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"redis-info--health-stats-and-system-overview",children:"Redis INFO \u2014 Health, Stats, and System Overview"}),"\n",(0,d.jsx)(n.p,{children:"INFO gives a complete snapshot of Redis server status."}),"\n",(0,d.jsx)(n.p,{children:"It has many sections, including:"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Section"}),(0,d.jsx)(n.th,{children:"Shows"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"server"})}),(0,d.jsx)(n.td,{children:"Redis version, uptime"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"clients"})}),(0,d.jsx)(n.td,{children:"Connected clients, blocked clients"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"memory"})}),(0,d.jsx)(n.td,{children:"RAM usage, fragmentation"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"persistence"})}),(0,d.jsx)(n.td,{children:"RDB/AOF status"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"stats"})}),(0,d.jsx)(n.td,{children:"Command statistics"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"replication"})}),(0,d.jsx)(n.td,{children:"Master/slave info"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"cpu"})}),(0,d.jsx)(n.td,{children:"CPU usage"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"cluster"})}),(0,d.jsx)(n.td,{children:"Cluster status"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"keyspace"})}),(0,d.jsx)(n.td,{children:"Key counts, expirations"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Output Example:"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"# Server\r\nredis_version:7.0.0\r\nuptime_in_seconds:3600\r\n\r\n# Clients\r\nconnected_clients:42\r\nblocked_clients:1\r\n\r\n# Memory\r\nused_memory:25600000\r\nused_memory_peak:30000000\r\nmem_fragmentation_ratio:1.12\r\n\r\n# Stats\r\ntotal_commands_processed:105000\r\ninstantaneous_ops_per_sec:1200\r\n\r\n# Keyspace\r\ndb0:keys=5000,expires=2000,avg_ttl=60000\n"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Server section","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Redis has been running for 1 hour"}),"\n",(0,d.jsx)(n.li,{children:"Version: 7.0.0"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Clients","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"42 active connections"}),"\n",(0,d.jsx)(n.li,{children:"1 blocked client (likely due to BRPOP or Lua script)"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Memory","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"used_memory: ~25 MB"}),"\n",(0,d.jsx)(n.li,{children:"mem_fragmentation_ratio: 1.12 (healthy)"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Stats","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"105,000 commands processed overall"}),"\n",(0,d.jsx)(n.li,{children:"Throughput: 1200 ops/sec"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Keyspace","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Database db0 has 5,000 keys"}),"\n",(0,d.jsx)(n.li,{children:"2,000 of them have TTLs"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Useful options"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Get only memory info: ",(0,d.jsx)(n.code,{children:"INFO memory"})]}),"\n",(0,d.jsxs)(n.li,{children:["Get only clients info: ",(0,d.jsx)(n.code,{children:"INFO clients"})]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"redis-slowlog--detect-slow-commands",children:"Redis SLOWLOG \u2014 Detect Slow Commands"}),"\n",(0,d.jsx)(n.p,{children:"SLOWLOG records Redis commands that exceed a configured execution time threshold."}),"\n",(0,d.jsx)(n.p,{children:"Redis is fast, so anything > 1 millisecond is often suspicious."}),"\n",(0,d.jsx)(n.h3,{id:"how-to-configure-slow-log",children:"How to configure Slow Log"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Set threshold to 1000 microseconds (1ms): ",(0,d.jsx)(n.code,{children:"CONFIG SET slowlog-log-slower-than 1000"})]}),"\n",(0,d.jsxs)(n.li,{children:["Set number of entries stored: ",(0,d.jsx)(n.code,{children:"CONFIG SET slowlog-max-len 128"})]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"adding-a-slow-command",children:"Adding a Slow Command"}),"\n",(0,d.jsx)(n.p,{children:"If your application runs:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"LRANGE huge_list 0 -1\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u2026on a list with millions of items, it may take >1ms."}),"\n",(0,d.jsx)(n.p,{children:"Redis will record it in the slow log."}),"\n",(0,d.jsx)(n.h3,{id:"viewing-the-slow-log",children:"Viewing the Slow Log"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"SLOWLOG GET 5\n"})}),"\n",(0,d.jsx)(n.p,{children:"Example output:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'1) 1) (integer) 15\r\n   2) (integer) 1617043400\r\n   3) (integer) 1200\r\n   4) 1) "LRANGE"\r\n      2) "biglist"\r\n      3) "0"\r\n      4) "-1"\r\n   5) "127.0.0.1:51726"\n'})}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Field"}),(0,d.jsx)(n.th,{children:"Meaning"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"(integer) 15"})}),(0,d.jsx)(n.td,{children:"Slowlog entry ID"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"1617043400"})}),(0,d.jsx)(n.td,{children:"Unix timestamp"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"1200"})}),(0,d.jsx)(n.td,{children:"Execution time in microseconds (1.2ms)"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:'"LRANGE" "biglist" "0" "-1"'})}),(0,d.jsx)(n.td,{children:"Command that was slow"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:'"127.0.0.1:51726"'})}),(0,d.jsx)(n.td,{children:"Client that executed it"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"Redis caught a slow command."}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Get slowlog length: ",(0,d.jsx)(n.code,{children:"SLOWLOG LEN"})]}),"\n",(0,d.jsxs)(n.li,{children:["Reset slowlog: ",(0,d.jsx)(n.code,{children:"SLOWLOG RESET"})]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"memory-usage-inspection",children:"Memory Usage Inspection"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Command"}),(0,d.jsx)(n.th,{children:"Purpose"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"INFO memory"}),(0,d.jsx)(n.td,{children:"High-level memory stats"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"MEMORY USAGE key"}),(0,d.jsx)(n.td,{children:"Inspect single key memory"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"MEMORY STATS"}),(0,d.jsx)(n.td,{children:"Deep memory metrics"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"MEMORY DOCTOR"}),(0,d.jsx)(n.td,{children:"Automated advice"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"MEMORY MALLOC-STATS"}),(0,d.jsx)(n.td,{children:"Allocator-level stats"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"MEMORY PURGE"}),(0,d.jsx)(n.td,{children:"Defrag attempt"})]})]})]})]})}function x(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(h,{...e})}):h(e)}},28453(e,n,s){s.d(n,{R:()=>l,x:()=>t});var i=s(96540);const d={},r=i.createContext(d);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);