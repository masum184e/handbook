"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[68348],{28453(n,e,s){s.d(e,{R:()=>l,x:()=>d});var i=s(96540);const t={},r=i.createContext(t);function l(n){const e=i.useContext(r);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:l(n.components),i.createElement(r.Provider,{value:e},n.children)}},88572(n,e,s){s.r(e),s.d(e,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"nginx/Logging/Stub Status","title":"Stub Status","description":"stub_status is a built-in NGINX module that exposes real-time internal metrics about how NGINX is handling connections and requests.","source":"@site/docs/nginx/22. Logging/4. Stub Status.md","sourceDirName":"nginx/22. Logging","slug":"/nginx/Logging/Stub Status","permalink":"/handbook/docs/nginx/Logging/Stub Status","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{},"sidebar":"nginxApiSidebar","previous":{"title":"Log Rotation","permalink":"/handbook/docs/nginx/Logging/Log Rotation"},"next":{"title":"Monitoring Tools","permalink":"/handbook/docs/nginx/Logging/Monitoring Tools"}}');var t=s(74848),r=s(28453);const l={},d=void 0,c={},o=[{value:"What stub_status Is Not",id:"what-stub_status-is-not",level:2},{value:"How stub_status Works Internally",id:"how-stub_status-works-internally",level:2},{value:"Enabling stub_status",id:"enabling-stub_status",level:2},{value:"Check if Module Is Available",id:"check-if-module-is-available",level:3},{value:"Basic Configuration",id:"basic-configuration",level:3},{value:"Example Output of stub_status",id:"example-output-of-stub_status",level:2},{value:"Understanding Each Metric (Very Important)",id:"understanding-each-metric-very-important",level:2},{value:"Active Connections",id:"active-connections",level:3},{value:"Accepts / Handled / Requests",id:"accepts--handled--requests",level:3},{value:"Reading / Writing / Waiting",id:"reading--writing--waiting",level:3},{value:"Monitoring Use Cases",id:"monitoring-use-cases",level:2},{value:"Detecting Traffic Spikes / DDoS",id:"detecting-traffic-spikes--ddos",level:3},{value:"Capacity Planning",id:"capacity-planning",level:3},{value:"Securing stub_status (Very Important)",id:"securing-stub_status-very-important",level:2},{value:"Using <code>stub_status</code> with Monitoring Systems",id:"using-stub_status-with-monitoring-systems",level:2},{value:"Container / Kubernetes Setup",id:"container--kubernetes-setup",level:2},{value:"Common Mistakes",id:"common-mistakes",level:2},{value:"Comparing <code>stub_status</code> vs NGINX Plus",id:"comparing-stub_status-vs-nginx-plus",level:2},{value:"Recommended Production Configuration",id:"recommended-production-configuration",level:2}];function a(n){const e={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:"stub_status"})," is a built-in NGINX module that exposes real-time internal metrics about how NGINX is handling connections and requests."]}),"\n",(0,t.jsx)(e.p,{children:"It is mainly used for:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Health monitoring"}),"\n",(0,t.jsx)(e.li,{children:"Traffic analysis"}),"\n",(0,t.jsx)(e.li,{children:"Capacity planning"}),"\n",(0,t.jsx)(e.li,{children:"Detecting DoS / traffic spikes"}),"\n",(0,t.jsx)(e.li,{children:"Feeding monitoring systems (Prometheus, Zabbix, Datadog, etc.)"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"It does not log data \u2014 it exposes live status metrics."}),"\n",(0,t.jsx)(e.h2,{id:"what-stub_status-is-not",children:"What stub_status Is Not"}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Not a replacement for"}),(0,t.jsx)(e.th,{children:"Reason"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Access logs"}),(0,t.jsx)(e.td,{children:"No per-request data"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Error logs"}),(0,t.jsx)(e.td,{children:"No error details"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"APM tools"}),(0,t.jsx)(e.td,{children:"No application metrics"})]})]})]}),"\n",(0,t.jsx)(e.p,{children:"It answers \u201chow busy is NGINX right now?\u201d"}),"\n",(0,t.jsx)(e.h2,{id:"how-stub_status-works-internally",children:"How stub_status Works Internally"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["NGINX maintains internal counters for:","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Connections"}),"\n",(0,t.jsx)(e.li,{children:"Requests"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["When /nginx_status is accessed:","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"NGINX prints current counter values"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["Metrics reset only when:","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"NGINX restarts"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"Extremely lightweight, Near-zero performance impact"}),"\n",(0,t.jsx)(e.h2,{id:"enabling-stub_status",children:"Enabling stub_status"}),"\n",(0,t.jsx)(e.h3,{id:"check-if-module-is-available",children:"Check if Module Is Available"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"nginx -V 2>&1 | grep stub_status\n"})}),"\n",(0,t.jsx)(e.p,{children:"Most distributions include it by default."}),"\n",(0,t.jsx)(e.h3,{id:"basic-configuration",children:"Basic Configuration"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"server {\r\n    listen 127.0.0.1:8080;\r\n\r\n    location /nginx_status {\r\n        stub_status;\r\n        allow 127.0.0.1;\r\n        deny all;\r\n    }\r\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"example-output-of-stub_status",children:"Example Output of stub_status"}),"\n",(0,t.jsxs)(e.p,{children:["Accessing: ",(0,t.jsx)(e.code,{children:"curl http://127.0.0.1:8080/nginx_status"})]}),"\n",(0,t.jsx)(e.p,{children:"Output:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"Active connections: 291\r\nserver accepts handled requests\r\n 10234567 10234567 20456789\r\nReading: 2 Writing: 5 Waiting: 284\n"})}),"\n",(0,t.jsx)(e.h2,{id:"understanding-each-metric-very-important",children:"Understanding Each Metric (Very Important)"}),"\n",(0,t.jsx)(e.h3,{id:"active-connections",children:"Active Connections"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"Active connections: 291\n"})}),"\n",(0,t.jsx)(e.p,{children:"Total current open connections, including:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Reading"}),"\n",(0,t.jsx)(e.li,{children:"Writing"}),"\n",(0,t.jsx)(e.li,{children:"Waiting (keep-alive)"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"accepts--handled--requests",children:"Accepts / Handled / Requests"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"server accepts handled requests\r\n 10234567 10234567 20456789\n"})}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Not a replacement for"}),(0,t.jsx)(e.th,{children:"Reason"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Access logs"}),(0,t.jsx)(e.td,{children:"No per-request data"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Error logs"}),(0,t.jsx)(e.td,{children:"No error details"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"APM tools"}),(0,t.jsx)(e.td,{children:"No application metrics"})]})]})]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:"requests"})," can be higher than ",(0,t.jsx)(e.code,{children:"handled"})," (keep-alive)."]}),"\n",(0,t.jsx)(e.h3,{id:"reading--writing--waiting",children:"Reading / Writing / Waiting"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"Reading: 2 Writing: 5 Waiting: 284\n"})}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Metric"}),(0,t.jsx)(e.th,{children:"Meaning"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"accepts"})}),(0,t.jsx)(e.td,{children:"TCP connections accepted"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"handled"})}),(0,t.jsx)(e.td,{children:"Connections successfully handled"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:"requests"})}),(0,t.jsx)(e.td,{children:"Total HTTP requests served"})]})]})]}),"\n",(0,t.jsxs)(e.p,{children:["High ",(0,t.jsx)(e.code,{children:"Waiting"})," is normal on busy sites."]}),"\n",(0,t.jsx)(e.h2,{id:"monitoring-use-cases",children:"Monitoring Use Cases"}),"\n",(0,t.jsx)(e.h3,{id:"detecting-traffic-spikes--ddos",children:"Detecting Traffic Spikes / DDoS"}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Symptom"}),(0,t.jsx)(e.th,{children:"Interpretation"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Sudden spike in Active connections"}),(0,t.jsx)(e.td,{children:"Possible flood"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"High Reading"}),(0,t.jsx)(e.td,{children:"Slowloris attack"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"High Writing"}),(0,t.jsx)(e.td,{children:"Backend slow"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Growing Waiting"}),(0,t.jsx)(e.td,{children:"Too many keep-alive clients"})]})]})]}),"\n",(0,t.jsx)(e.h3,{id:"capacity-planning",children:"Capacity Planning"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Compare:","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.code,{children:"Active connections"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.code,{children:"worker_connections"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.li,{children:"Helps decide when to scale"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"securing-stub_status-very-important",children:"Securing stub_status (Very Important)"}),"\n",(0,t.jsx)(e.p,{children:"Never expose publicly, Restrict access"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"location /nginx_status {\r\n   stub_status;\r\n   allow 127.0.0.1;\r\n   allow 10.0.0.0/8;\r\n   deny all;\r\n}\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Prevents information leakage"}),"\n",(0,t.jsx)(e.li,{children:"Blocks attackers from learning capacity"}),"\n"]}),"\n",(0,t.jsxs)(e.h2,{id:"using-stub_status-with-monitoring-systems",children:["Using ",(0,t.jsx)(e.code,{children:"stub_status"})," with Monitoring Systems"]}),"\n",(0,t.jsx)(e.p,{children:"Example: Prometheus (via exporter)"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["NGINX \u2192 ",(0,t.jsx)(e.code,{children:"/nginx_status"})]}),"\n",(0,t.jsx)(e.li,{children:"Exporter scrapes metrics"}),"\n",(0,t.jsx)(e.li,{children:"Prometheus stores data"}),"\n",(0,t.jsx)(e.li,{children:"Grafana visualizes"}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:"stub_status"})," is the foundation for most NGINX monitoring stacks."]}),"\n",(0,t.jsx)(e.h2,{id:"container--kubernetes-setup",children:"Container / Kubernetes Setup"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"location /nginx_status {\r\n    stub_status;\r\n    access_log off;\r\n    allow 127.0.0.1;\r\n    deny all;\r\n}\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Disable access logs (no noise)"}),"\n",(0,t.jsx)(e.li,{children:"Scraped internally"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"common-mistakes",children:"Common Mistakes"}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Symptom"}),(0,t.jsx)(e.th,{children:"Interpretation"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Sudden spike in Active connections"}),(0,t.jsx)(e.td,{children:"Possible flood"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"High Reading"}),(0,t.jsx)(e.td,{children:"Slowloris attack"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"High Writing"}),(0,t.jsx)(e.td,{children:"Backend slow"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Growing Waiting"}),(0,t.jsx)(e.td,{children:"Too many keep-alive clients"})]})]})]}),"\n",(0,t.jsxs)(e.h2,{id:"comparing-stub_status-vs-nginx-plus",children:["Comparing ",(0,t.jsx)(e.code,{children:"stub_status"})," vs NGINX Plus"]}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Symptom"}),(0,t.jsx)(e.th,{children:"Interpretation"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Sudden spike in Active connections"}),(0,t.jsx)(e.td,{children:"Possible flood"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"High Reading"}),(0,t.jsx)(e.td,{children:"Slowloris attack"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"High Writing"}),(0,t.jsx)(e.td,{children:"Backend slow"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Growing Waiting"}),(0,t.jsx)(e.td,{children:"Too many keep-alive clients"})]})]})]}),"\n",(0,t.jsx)(e.h2,{id:"recommended-production-configuration",children:"Recommended Production Configuration"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"    server {\r\n    listen 127.0.0.1:8080;\r\n\r\n        location /nginx_status {\r\n            stub_status;\r\n            access_log off;\r\n\r\n            allow 127.0.0.1;\r\n            allow 10.0.0.0/8;\r\n            deny all;\r\n        }\r\n\r\n    }\n"})})]})}function h(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(a,{...n})}):a(n)}}}]);