"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[41227],{28453(e,n,r){r.d(n,{R:()=>l,x:()=>c});var i=r(96540);const s={},o=i.createContext(s);function l(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(o.Provider,{value:n},e.children)}},36364(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"nodejs/Asynchronouse Operation","title":"Asynchronouse Operation","description":"util.promisify","source":"@site/docs/nodejs/8. Asynchronouse Operation.md","sourceDirName":"nodejs","slug":"/nodejs/Asynchronouse Operation","permalink":"/handbook/docs/nodejs/Asynchronouse Operation","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":8,"frontMatter":{},"sidebar":"nodejsApiSidebar","previous":{"title":"Package Management","permalink":"/handbook/docs/nodejs/Package Management"},"next":{"title":"Static Files","permalink":"/handbook/docs/nodejs/Static Files"}}');var s=r(74848),o=r(28453);const l={},c=void 0,a={},t=[{value:"<code>util.promisify</code>",id:"utilpromisify",level:2},{value:"Converting <code>fs.readFile</code> (callback) to Promise",id:"converting-fsreadfile-callback-to-promise",level:3},{value:"Callback Version (Old Style)",id:"callback-version-old-style",level:4},{value:"Promisified Version with <code>util.promisify</code>",id:"promisified-version-with-utilpromisify",level:4},{value:"Using <code>async/await</code> with <code>promisify</code>",id:"using-asyncawait-with-promisify",level:3},{value:"Promisifying Your Own Callback Functions",id:"promisifying-your-own-callback-functions",level:2}];function d(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"utilpromisify",children:(0,s.jsx)(n.code,{children:"util.promisify"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"util.promisify"})," converts a function that uses an error-first callback into a function that returns a Promise."]}),"\n",(0,s.jsx)(n.p,{children:"Benefits:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Enables ",(0,s.jsx)(n.code,{children:"async/await"})," usage on older callback APIs."]}),"\n",(0,s.jsx)(n.li,{children:"Makes code cleaner and easier to read."}),"\n",(0,s.jsx)(n.li,{children:"Avoids manually wrapping callbacks in new Promises."}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"converting-fsreadfile-callback-to-promise",children:["Converting ",(0,s.jsx)(n.code,{children:"fs.readFile"})," (callback) to Promise"]}),"\n",(0,s.jsx)(n.h4,{id:"callback-version-old-style",children:"Callback Version (Old Style)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const fs = require('fs');\r\n\r\nfs.readFile('example.txt', 'utf-8', (err, data) => {\r\n  if (err) {\r\n    console.error(\"Error reading file:\", err);\r\n  } else {\r\n    console.log(\"File content:\", data);\r\n  }\r\n});\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Here, ",(0,s.jsx)(n.code,{children:"readFile"})," is callback-based."]}),"\n",(0,s.jsx)(n.li,{children:"Error handling is done inside the callback."}),"\n",(0,s.jsx)(n.li,{children:"Harder to chain with multiple async operations."}),"\n"]}),"\n",(0,s.jsxs)(n.h4,{id:"promisified-version-with-utilpromisify",children:["Promisified Version with ",(0,s.jsx)(n.code,{children:"util.promisify"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const fs = require('fs');\r\nconst util = require('util');\r\n\r\n// Convert callback-based readFile into a Promise-based version\r\nconst readFileAsync = util.promisify(fs.readFile);\r\n\r\nreadFileAsync('example.txt', 'utf-8')\r\n  .then(data => console.log(\"File content:\", data))\r\n  .catch(err => console.error(\"Error reading file:\", err));\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"util.promisify(fs.readFile)"})," returns a Promise-based function ",(0,s.jsx)(n.code,{children:"readFileAsync"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:".then()"})," handles success, ",(0,s.jsx)(n.code,{children:".catch()"})," handles errors."]}),"\n",(0,s.jsxs)(n.li,{children:["Can now easily use ",(0,s.jsx)(n.code,{children:"async/await"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"using-asyncawait-with-promisify",children:["Using ",(0,s.jsx)(n.code,{children:"async/await"})," with ",(0,s.jsx)(n.code,{children:"promisify"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const fs = require('fs');\r\nconst util = require('util');\r\n\r\nconst readFileAsync = util.promisify(fs.readFile);\r\n\r\nasync function readMyFile() {\r\n  try {\r\n    const data = await readFileAsync('example.txt', 'utf-8');\r\n    console.log(\"File content:\", data);\r\n  } catch (err) {\r\n    console.error(\"Error reading file:\", err);\r\n  }\r\n}\r\n\r\nreadMyFile();\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Cleaner and easier to read than nested callbacks."}),"\n",(0,s.jsxs)(n.li,{children:["Error handling is straightforward with ",(0,s.jsx)(n.code,{children:"try...catch"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"promisifying-your-own-callback-functions",children:"Promisifying Your Own Callback Functions"}),"\n",(0,s.jsx)(n.p,{children:"You can promisify your own functions too:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'const util = require(\'util\');\r\n\r\nfunction doTask(x, callback) {\r\n  setTimeout(() => {\r\n    if (x < 0) callback(new Error("Negative value"));\r\n    else callback(null, x * 2);\r\n  }, 500);\r\n}\r\n\r\nconst doTaskAsync = util.promisify(doTask);\r\n\r\nasync function runTask() {\r\n  try {\r\n    const result = await doTaskAsync(5);\r\n    console.log("Result:", result); // 10\r\n  } catch (err) {\r\n    console.error("Error:", err.message);\r\n  }\r\n}\r\n\r\nrunTask();\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Original ",(0,s.jsx)(n.code,{children:"doTask"})," uses a Node-style callback ",(0,s.jsx)(n.code,{children:"(err, result)"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"util.promisify(doTask)"})," creates ",(0,s.jsx)(n.code,{children:"doTaskAsync"}),", which returns a Promise."]}),"\n",(0,s.jsxs)(n.li,{children:["Can now use ",(0,s.jsx)(n.code,{children:"async/await"})," cleanly."]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);