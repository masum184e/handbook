"use strict";(globalThis.webpackChunkhandbook=globalThis.webpackChunkhandbook||[]).push([[464],{14215(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"rest-api-design/OAuth","title":"OAuth","description":"OAuth 2.0 is a delegation protocol \u2014 it lets users authorize applications to act on their behalf, granting access to resources via access tokens.","source":"@site/docs/rest-api-design/14. OAuth.md","sourceDirName":"rest-api-design","slug":"/rest-api-design/OAuth","permalink":"/handbook/docs/rest-api-design/OAuth","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":16,"frontMatter":{"title":"OAuth","sidebar_position":16},"sidebar":"restApiSidebar","previous":{"title":"API Specification","permalink":"/handbook/docs/rest-api-design/API Specification"},"next":{"title":"Max Retry","permalink":"/handbook/docs/rest-api-design/Max Retry"}}');var t=s(74848),i=s(28453);const c={title:"OAuth",sidebar_position:16},o=void 0,l={},d=[{value:"Core Roles",id:"core-roles",level:2},{value:"Authorization Flows (Grant Types)",id:"authorization-flows-grant-types",level:2},{value:"Steps of OAuth",id:"steps-of-oauth",level:2},{value:"1. App Redirects User to Authorization Server",id:"1-app-redirects-user-to-authorization-server",level:3},{value:"2. Authorization Server Redirects with Code",id:"2-authorization-server-redirects-with-code",level:3},{value:"3. App Requests Token",id:"3-app-requests-token",level:3},{value:"4. App Uses Access Token to Call API",id:"4-app-uses-access-token-to-call-api",level:3},{value:"5. Refresh Access Token (When expired)",id:"5-refresh-access-token-when-expired",level:3},{value:"OpenID Connect",id:"openid-connect",level:2},{value:"How OIDC Works",id:"how-oidc-works",level:3},{value:"OIDC Flow",id:"oidc-flow",level:3},{value:"OAuth 2.0 vs OIDC",id:"oauth-20-vs-oidc",level:3},{value:"JSON Web Tokens",id:"json-web-tokens",level:2},{value:"JWT Structure",id:"jwt-structure",level:3}];function a(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"OAuth 2.0 is a delegation protocol \u2014 it lets users authorize applications to act on their behalf, granting access to resources via access tokens."}),"\n",(0,t.jsx)(n.p,{children:"Instead of apps storing user credentials, they request access tokens from an authorization server, which are then used to access protected APIs."}),"\n",(0,t.jsx)(n.h2,{id:"core-roles",children:"Core Roles"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Role"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Resource Owner"})}),(0,t.jsx)(n.td,{children:"The user who owns the data (e.g., you)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Client"})}),(0,t.jsx)(n.td,{children:"The third-party app accessing data (e.g., Spotify)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Authorization Server"})}),(0,t.jsx)(n.td,{children:"Issues tokens (e.g., Google, Auth0)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Resource Server"})}),(0,t.jsxs)(n.td,{children:["API that hosts the user\u2019s resources (e.g., ",(0,t.jsx)(n.code,{children:"api.example.com"}),")"]})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"authorization-flows-grant-types",children:"Authorization Flows (Grant Types)"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Grant Type"}),(0,t.jsx)(n.th,{children:"Use Case"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Authorization Code"})}),(0,t.jsx)(n.td,{children:"Web apps with frontend + backend (most secure)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Client Credentials"})}),(0,t.jsx)(n.td,{children:"Machine-to-machine (M2M) apps (no user)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Password Grant"})}),(0,t.jsx)(n.td,{children:"Trusted apps (deprecated for public use)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Implicit Flow"})}),(0,t.jsx)(n.td,{children:"Single-page apps (deprecated in favor of PKCE)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Authorization Code + PKCE"})}),(0,t.jsx)(n.td,{children:"Recommended for mobile/SPAs (secure public clients)"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"steps-of-oauth",children:"Steps of OAuth"}),"\n",(0,t.jsx)(n.h3,{id:"1-app-redirects-user-to-authorization-server",children:"1. App Redirects User to Authorization Server"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"GET https://auth.example.com/oauth/authorize?\r\n    response_type=code\r\n    &client_id=abc123\r\n    &redirect_uri=https://app.example.com/callback\r\n    &scope=email profile\r\n    &state=xyz\n"})}),"\n",(0,t.jsx)(n.p,{children:"User logs in and consents."}),"\n",(0,t.jsx)(n.h3,{id:"2-authorization-server-redirects-with-code",children:"2. Authorization Server Redirects with Code"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"GET https://app.example.com/callback?code=AUTH_CODE&state=xyz\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-app-requests-token",children:"3. App Requests Token"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"POST https://auth.example.com/oauth/token\r\nContent-Type: application/x-www-form-urlencoded\r\n\r\nclient_id=abc123\r\n&client_secret=shhh\r\n&code=AUTH_CODE\r\n&grant_type=authorization_code\r\n&redirect_uri=https://app.example.com/callback\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "access_token": "eyJabc...xyz",\r\n  "refresh_token": "def456...",\r\n  "token_type": "Bearer",\r\n  "expires_in": 3600\r\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"4-app-uses-access-token-to-call-api",children:"4. App Uses Access Token to Call API"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"GET https://api.example.com/user/email\r\nAuthorization: Bearer eyJabc...xyz\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "email": "user@example.com"\r\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"5-refresh-access-token-when-expired",children:"5. Refresh Access Token (When expired)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"POST https://auth.example.com/oauth/token\r\nContent-Type: application/x-www-form-urlencoded\r\n\r\ngrant_type=refresh_token\r\n&refresh_token=def456...\r\n&client_id=abc123\r\n&client_secret=shhh\n"})}),"\n",(0,t.jsx)(n.h2,{id:"openid-connect",children:"OpenID Connect"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"OpenID Connect is an identity layer built on top of OAuth 2.0."}),"\n",(0,t.jsx)(n.li,{children:"It adds authentication \u2014 confirming who the user is."}),"\n",(0,t.jsxs)(n.li,{children:["In addition to ",(0,t.jsx)(n.code,{children:"access_token"}),", OIDC issues an ID Token (a JWT) containing user identity information."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"So:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"OAuth 2.0 = Delegated Authorization (what app can do)"}),"\n",(0,t.jsx)(n.li,{children:"OIDC = Authentication + Authorization (who the user is + what app can do)"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"how-oidc-works",children:"How OIDC Works"}),"\n",(0,t.jsx)(n.p,{children:"OIDC uses the same flows as OAuth 2.0 but adds the id_token."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"ID Token"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"A JWT (JSON Web Token) signed by the Identity Provider."}),"\n",(0,t.jsx)(n.li,{children:"Contains user claims:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "sub": "1234567890",\r\n  "name": "Masum Billah",\r\n  "email": "masum@example.com",\r\n  "iss": "https://auth.example.com/",\r\n  "aud": "abc123",\r\n  "exp": 1694200300\r\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"oidc-flow",children:"OIDC Flow"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Client app redirects user to the Identity Provider with ",(0,t.jsx)(n.code,{children:"openid"})," scope:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"GET https://auth.example.com/authorize?\r\n    response_type=code&\r\n    client_id=abc123&\r\n    redirect_uri=https://myapp.com/callback&\r\n    scope=openid profile email\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"After login & consent \u2192 client exchanges code for tokens:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"POST /oauth/token\r\ngrant_type=authorization_code\r\ncode=xyz789\r\nclient_id=abc123\r\nclient_secret=shhh456\n"})}),"\n",(0,t.jsx)(n.p,{children:"Response:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "access_token": "eyJhbGciOiJIUzI1...",\r\n  "id_token": "eyJhbGciOiJSUzI1NiIsInR5cCI...",\r\n  "expires_in": 3600,\r\n  "token_type": "Bearer"\r\n}\n'})}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsx)(n.li,{children:"The access_token \u2192 used to call APIs. The id_token \u2192 used to authenticate the user (who they are)."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"oauth-20-vs-oidc",children:"OAuth 2.0 vs OIDC"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Feature"}),(0,t.jsx)(n.th,{children:"OAuth 2.0"}),(0,t.jsx)(n.th,{children:"OpenID Connect (OIDC)"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Purpose"}),(0,t.jsx)(n.td,{children:"Authorization (what app can do)"}),(0,t.jsx)(n.td,{children:"Authentication + Authorization"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Tokens Returned"}),(0,t.jsx)(n.td,{children:"Access Token (and Refresh Token)"}),(0,t.jsxs)(n.td,{children:["Access Token + ",(0,t.jsx)(n.strong,{children:"ID Token"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Identity Info"}),(0,t.jsx)(n.td,{children:"\u274c Not included"}),(0,t.jsx)(n.td,{children:"\u2705 Provided in ID Token"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Example Use Case"}),(0,t.jsx)(n.td,{children:"Allow app to access Google Drive"}),(0,t.jsx)(n.td,{children:"Login with Google"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"json-web-tokens",children:"JSON Web Tokens"}),"\n",(0,t.jsx)(n.p,{children:"A JWT (JSON Web Token) is a compact, URL-safe token format used to securely transmit information between a client and server."}),"\n",(0,t.jsxs)(n.p,{children:["It\u2019s a string with 3 parts (separated by dots ",(0,t.jsx)(n.code,{children:"."}),"):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"header.payload.signature\n"})}),"\n",(0,t.jsx)(n.p,{children:"It\u2019s often used as a Bearer Token in REST APIs for authentication & authorization."}),"\n",(0,t.jsx)(n.h3,{id:"jwt-structure",children:"JWT Structure"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-nginx",children:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9\r\n.\r\neyJzdWIiOiIxMjM0NTYiLCJuYW1lIjoiTWFzdW0gQmlsbGFoIiwiYWRtaW4iOnRydWV9\r\n.\r\nhTDiVfVhS5jqCmyFfXqS-H6vIbiV9TnQ7s02jjCddJY\n"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Header"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Defines metadata: algorithm & type. (Base64 encoded JSON)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "alg": "HS256",\r\n  "typ": "JWT"\r\n}\n'})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"Payload"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Contains claims (the actual data). (Base64 encoded JSON)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "sub": "123456",\r\n  "name": "Masum Billah",\r\n  "admin": true,\r\n  "exp": 1736790400\r\n}\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"sub"}),": Subject (user ID)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"exp"}),": Expiry time (Unix timestamp)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"name"}),", admin: Custom claims"]}),"\n"]}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:"Signature"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Ensures the token isn\u2019t tampered with."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'HMACSHA256( base64UrlEncode(header) + "." + base64UrlEncode(payload), secret )\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Best Practices"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Keep JWTs short-lived (",(0,t.jsx)(n.code,{children:"exp"})," claim)."]}),"\n",(0,t.jsx)(n.li,{children:"Use refresh tokens for long sessions."}),"\n",(0,t.jsxs)(n.li,{children:["Always send via ",(0,t.jsx)(n.code,{children:"Authorization: Bearer"})," header (not query params)."]}),"\n",(0,t.jsx)(n.li,{children:"Sign with strong algorithms (HS256, RS256)."}),"\n",(0,t.jsxs)(n.li,{children:["Validate issuer (",(0,t.jsx)(n.code,{children:"iss"}),"), audience (",(0,t.jsx)(n.code,{children:"aud"}),"), and expiry (",(0,t.jsx)(n.code,{children:"exp"}),")."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},28453(e,n,s){s.d(n,{R:()=>c,x:()=>o});var r=s(96540);const t={},i=r.createContext(t);function c(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);