---
title: Router
sidebar_position: 7
---

## `pages` Router

The Pages Router in Next.js defines the application’s routes and rendering behavior using the file system. Each file inside `pages/` automatically becomes a route.

- File-based routing: Each file in `pages/` is a route.
- Client Components by default: Unlike the App Router (`app/`) which defaults to Server Components.
- Data fetching: `getStaticProps`, `getServerSideProps`, `getStaticPaths`.
- Uses special files (`_app.tsx`, `_document.tsx`, `_error.tsx`, `404.tsx`) for global layouts, document structure, and error handling.
- API routes: Inside `pages/api/`, served as serverless functions.

### Folder Structure

- Each file inside `pages/` represents a route, and its default export is rendered as the page. The default export from that file must be a React component.
- Supports Client Components by default (unlike `app/` which defaults to Server Components).

| File/Folder      | Purpose                                                           |
| ---------------- | ----------------------------------------------------------------- |
| `index.tsx`      | Root route (`/`).                                                 |
| `about.tsx`      | Static route (`/about`).                                          |
| `[id].tsx`       | Dynamic route (e.g., `/blog/123`).                                |
| `[...slug].tsx`  | Catch-all route (`/docs/intro/getting-started`).                  |
| `_app.tsx`       | Wraps all pages (global layout, providers, styles).               |
| `_document.tsx`  | Customize HTML `<html>` and `<body>` (meta, lang, preload links). |
| `_error.tsx`     | Custom error page.                                                |
| `404.tsx`        | Custom 404 page.                                                  |
| `pages/api/*.ts` | API endpoints (serverless functions).                             |

**Example Structure:**

```
my-next-app/
│── .next/                        # Auto-generated build output
│── node_modules/                 # Dependencies
│── public/                       # Static assets (served from /)
│   ├── favicon.ico
│   ├── images/
│   └── robots.txt
│
│── src/                          # Source code (recommended structure)
│   ├── pages/                    # Next.js Pages Router
│   │   ├── index.tsx             # Home page (route: /)
│   │   ├── about.tsx             # Example route (route: /about)
│   │   ├── blog/                 # Nested routes
│   │   │   ├── index.tsx         # Blog listing (route: /blog)
│   │   │   └── [id].tsx          # Dynamic blog route (route: /blog/123)
│   │   ├── api/                  # API routes (serverless functions)
│   │   │   └── hello.ts          # API endpoint (route: /api/hello)
│   │   ├── _app.tsx              # Custom App component (global layout/providers)
│   │   ├── _document.tsx         # Custom Document (HTML structure, lang, meta)
│   │   ├── _error.tsx            # Custom error page (fallback errors)
│   │   └── 404.tsx               # Custom 404 page
│   │
│   ├── components/               # Reusable UI components
│   │   ├── ui/                   # Generic UI elements (buttons, cards, etc.)
│   │   │   └── Button.tsx
│   │   ├── layout/               # Layout-specific components
│   │   │   ├── Navbar.tsx
│   │   │   └── Footer.tsx
│   │   └── shared/               # Reusable feature components
│   │       └── LoadingSpinner.tsx
│   │
│   ├── features/                 # Feature-based modules
│   │   ├── auth/
│   │   │   ├── hooks/            # Auth-specific hooks
│   │   │   │   └── useAuth.ts
│   │   │   ├── types.ts          # Auth-specific types
│   │   │   └── AuthProvider.tsx
│   │   ├── products/
│   │   │   ├── ProductCard.tsx
│   │   │   ├── utils.ts
│   │   │   └── types.ts
│   │   └── users/
│   │       ├── UserCard.tsx
│   │       └── types.ts
│   │
│   ├── lib/                      # Helpers & utility functions
│   │   ├── fetcher.ts
│   │   └── constants.ts
│   │
│   ├── hooks/                    # Global reusable hooks
│   │   └── useMediaQuery.ts
│   │
│   ├── context/                  # Global React Contexts
│   │   └── ThemeContext.tsx
│   │
│   ├── types/                    # Centralized global types/interfaces
│   │   ├── api.ts                # API response/request types
│   │   ├── user.ts               # Shared user types
│   │   ├── product.ts            # Shared product types
│   │   └── index.d.ts            # Global ambient types (extends Window, etc.)
│   │
│   ├── styles/                   # Styles
│   │   ├── globals.css
│   │   ├── variables.css
│   │   └── tailwind.css
│   │
│   └── tests/                    # Unit & integration tests
│       ├── components/
│       └── features/
│
│── .eslintrc.json                # ESLint config
│── .gitignore                    # Git ignore rules
│── next.config.js                # Next.js config
│── package.json                   # Dependencies & scripts
│── postcss.config.js             # PostCSS config (Tailwind, etc.)
│── tailwind.config.js            # Tailwind config
│── tsconfig.json                 # TypeScript config
```

### Routing

- Static route → `pages/about.tsx` → `/about`
- Dynamic route → `pages/blog/[id].tsx` → `/blog/123`
- Catch-all route → `pages/docs/[...slug].tsx` → `/docs/intro/getting-started`

### Data Fetching

1. CSR via `useEffect` → Client-Side Rendering
   - Data fetching happens entirely in the browser.
   - No pre-rendering; the page loads first, then fetches data via API.
2. `getStaticProps` → Static Site Generation (SSG)
   - Runs at build time.
   - Pre-renders HTML + JSON for each page.
   - Best for content that doesn’t change often.
   - Visiting `/static` will always show the same pre-rendered content until the site is rebuilt.
3. `getStaticPaths` (with `getStaticProps`) → Dynamic SSG
   - Used with dynamic routes (e.g., `[id].tsx`).
   - Pre-renders a set of paths at build time.
   - Supports three fallback modes:
     - `false` → Only pre-rendered paths exist; others return 404.
     - `true` → Not-prebuilt paths generate on-demand with a loading state.
     - `"blocking"` → Not-prebuilt paths generate on-demand server-side (no loading state).
4. ISR via `revalidate` → Incremental Static Regeneration
   - Hybrid between SSG and dynamic updates.
   - Runs `getStaticProps` at build time (like SSG).
   - Adds a `revalidate` property → defines how often the page should update.
   - After `N` seconds, the next request triggers regeneration in the background.
   - Users see the cached page until regeneration finishes, then future users get the fresh page.
5. `getServerSideProps` → Server-Side Rendering (SSR)
   - Runs on every request (on Node.js server or Vercel Function).
   - Fetches fresh data each time before sending the HTML.
   - Visiting `/server` always returns the latest data.
6. `getInitialProps` (Legacy)
   - Runs on both server and client.
   - Can cause larger JavaScript bundles and worse performance.
   - Mostly replaced by `getStaticProps` and `getServerSideProps`.
   - Still useful in some libraries like NextAuth.js (for session handling).

**Summary:**
| Method | When it Runs | Use Case |
| -------------------- | ---------------------- | -------------------------------------------------------------- |
| `getStaticProps` | Build time | Static content (blogs, docs, marketing pages) |
| `getServerSideProps` | On every request | Always-fresh content (dashboards, stock prices) |
| `getStaticPaths` | Build time / On-demand | Dynamic routes (blog posts, products) |
| `getInitialProps` | Server + client | Legacy use, libraries compatibility |
| CSR (`useEffect`) | Client only | User-specific or non-SEO critical content (chat, dashboards) |
| ISR (`revalidate`) | Build + background | Mix of static speed + fresh data (news, product prices, blogs) |

### API Routes

API routes in Next.js allow you to build serverless functions directly inside your app.
They live inside the `pages/api/` directory, and each file automatically becomes an API endpoint.

- They run only on the server (never bundled into client-side JavaScript).
- Can handle `GET`, `POST`, `PUT`, `DELETE` requests.
- Useful for handling forms, authentication, database queries, webhooks, etc.

```tsx
// pages/api/users.ts
export default function handler(req, res) {
  if (req.method === "GET") {
    // Fetch users
    res.status(200).json({ users: ["Alice", "Bob", "Charlie"] });
  } else if (req.method === "POST") {
    // Add a new user (example only)
    const { name } = req.body;
    res.status(201).json({ message: `User ${name} created!` });
  } else {
    res.setHeader("Allow", ["GET", "POST"]);
    res.status(405).end(`Method ${req.method} Not Allowed`);
  }
}
```

### Components

In the Pages Router, unlike the App Router, everything is a Client Component by default:

- Pages and components are rendered in the browser after hydration.
- There is no concept of Server Components (that’s exclusive to the App Router).
- However, you can still perform server-side logic using special data-fetching methods:
  - `getStaticProps` → Static Site Generation (SSG)
  - `getServerSideProps` → Server-Side Rendering (SSR)
  - API Routes → `pages/api/*` for serverless functions

In the Pages Router, components always run in the client, but you can inject server-side logic through Next.js lifecycle functions.

### Rendering Modes

Next.js `pages/` supports four rendering strategies:

1. Static Generation (SSG) → `getStaticProps`
2. Server-Side Rendering (SSR) → `getServerSideProps`
3. Client-Side Rendering (CSR) → Fetching data inside `useEffect` in the browser
4. Incremental Static Regeneration (ISR) → `getStaticProps` + `revalidate`

### Special Files

1. **Custom App Component (`_app.tsx`):**

   - Wraps all pages in your application.
   - Useful for global styles, providers (e.g., Redux, Context, Theme), and persistent layouts.
   - Runs on both client and server.

   ```tsx
   // pages/_app.tsx
   import "../styles/globals.css";

   export default function MyApp({ Component, pageProps }) {
     return <Component {...pageProps} />;
   }
   ```

   Use cases:

   - Import global CSS.
   - Add global state providers (Redux, Context API, React Query, etc.).
   - Implement layouts that persist across pages.

2. **Custom HTML Structure (`_document.tsx`):**

   - Used to modify the overall HTML document structure.
   - Only rendered on the server (never on the client).
   - Useful for `<html>`, `<body>`, meta tags, language attributes, and preload links.
   - Unlike `_app.js`, which handles the React tree, `_document.js` controls the HTML & `<head>` part of your app.
   - This file only runs on the server-side (never in the browser).
   - It’s useful for adding things like:
     - Custom `lang` attribute on `<html>`.
     - Adding global meta tags.
     - Adding external fonts, scripts, or analytics.
     - Setting up custom document structure.

   ```tsx
   // pages/_document.tsx
   import { Html, Head, Main, NextScript } from "next/document";

   export default function Document() {
     return (
       <Html lang="en">
         <Head>
           <meta name="description" content="My Next.js App" />
           <link rel="preconnect" href="https://fonts.googleapis.com" />
         </Head>
         <body>
           <Main />
           <NextScript />
         </body>
       </Html>
     );
   }
   ```

   Use cases:

   - Adding `lang` attribute for accessibility/SEO.
   - Preloading fonts or external resources.
   - Adding global `<meta>` tags.

     **Differences Between `_app.js` and `_document.js`**

   | Feature    | `_app.js` (App Component)         | `_document.js` (Document)             |
   | ---------- | --------------------------------- | ------------------------------------- |
   | Runs on    | Client & Server                   | Server only                           |
   | Controls   | Page rendering & layout           | HTML document structure               |
   | Common use | Layouts, global styles, providers | Meta tags, fonts, `<html>` attributes |
   | Lifecycle  | Per page navigation               | Only on initial page load             |

3. **Custom Error Page (for 404 & 500 errors) (`_error.ts`):**

   - Replaces the default Next.js error screen.

   ```tsx
   // pages/_error.tsx
   export default function ErrorPage({ statusCode }) {
     return (
       <div>
         <h1>{statusCode ? `Error ${statusCode}` : "An error occurred"}</h1>
         <p>Something went wrong. Please try again later.</p>
       </div>
     );
   }
   ```

   Use cases:

   - Show branded error pages.
   - Handle server errors gracefully.

4. **Custom Not Found Page (`404.js`):**
   - Used specifically when a page or route does not exist.
   ```tsx
   // pages/404.tsx
   export default function NotFoundPage() {
     return (
       <div>
         <h1>404 - Page Not Found</h1>
         <p>Sorry, the page you are looking for does not exist.</p>
       </div>
     );
   }
   ```
   Use cases:
   - Friendly 404 messages.
   - Links back to the homepage or search.

## `app` Router

The App Router (`app/` directory) was introduced in Next.js 13 to provide:

- File-based routing (like Pages Router, but more powerful).
- Server Components by default (improves performance).
- Flexible data fetching with `async/await`.
- Layouts, templates, and parallel routes.

### Folder Structure

- Each folder inside `app/` represents a route, and a `page.js` (or `page.tsx`) file inside it is rendered as the page.
- Supports Server Components by default (unlike `pages/` which defaults to Client Components).
- Special files add layouts, error boundaries, loading states, etc.

| File/Folder      | Purpose                                                      |
| ---------------- | ------------------------------------------------------------ |
| `page.tsx`       | Defines a route’s **UI** (like old `pages/` files).          |
| `layout.tsx`     | Shared UI (e.g., navbar, sidebar) that **wraps children**.   |
| `template.tsx`   | Like `layout`, but **recreates on navigation** (not cached). |
| `loading.tsx`    | Displays a fallback UI while the route or data is loading.   |
| `error.tsx`      | Error boundary for a specific route segment.                 |
| `not-found.tsx`  | Custom 404 for a specific segment.                           |
| `head.tsx`       | Define `<head>` metadata (title, meta tags, etc.).           |
| `route.ts`       | Define API routes (replaces `pages/api`).                    |
| `(folder)`       | **Grouping**, does not affect URL.                           |
| `[...]` / `[id]` | Dynamic routes (same as Pages Router).                       |

**Example Structure:**

```
my-next-app/
│── .next/                        # Auto-generated build output
│── node_modules/                 # Dependencies
│── public/                       # Static assets (served from /)
│   ├── favicon.ico
│   ├── images/
│   └── robots.txt
│
│── src/                          # Source code (recommended structure)
│   ├── app/                      # Next.js App Router (v13+)
│   │   ├── layout.tsx            # Root layout (shared UI)
│   │   ├── page.tsx              # Home page
│   │   ├── about/                # Example route
│   │   │   └── page.tsx
│   │   ├── dashboard/            # Nested routes
│   │   │   ├── layout.tsx        # Dashboard layout
│   │   │   ├── page.tsx
│   │   │   └── settings/
│   │   │       └── page.tsx
│   │   └── api/                  # API routes (server functions)
│   │       └── hello/route.ts
│   │
│   ├── components/               # Reusable UI components
│   │   ├── ui/                   # Generic UI elements (buttons, cards, etc.)
│   │   │   └── Button.tsx
│   │   ├── layout/               # Layout-specific components
│   │   │   ├── Navbar.tsx
│   │   │   └── Footer.tsx
│   │   └── shared/               # Reusable feature components
│   │       └── LoadingSpinner.tsx
│   │
│   ├── features/                 # Feature-based modules
│   │   ├── auth/
│   │   │   ├── hooks/            # Auth-specific hooks
│   │   │   │   └── useAuth.ts
│   │   │   ├── types.ts          # Auth-specific types
│   │   │   └── AuthProvider.tsx
│   │   ├── products/
│   │   │   ├── ProductCard.tsx
│   │   │   ├── utils.ts
│   │   │   └── types.ts
│   │   └── users/
│   │       ├── UserCard.tsx
│   │       └── types.ts
│   │
│   ├── lib/                      # Helpers & utility functions
│   │   ├── fetcher.ts
│   │   └── constants.ts
│   │
│   ├── hooks/                    # Global reusable hooks
│   │   └── useMediaQuery.ts
│   │
│   ├── context/                  # Global React Contexts
│   │   └── ThemeContext.tsx
│   │
│   ├── types/                    # Centralized global types/interfaces
│   │   ├── api.ts                # API response/request types
│   │   ├── user.ts               # Shared user types
│   │   ├── product.ts            # Shared product types
│   │   └── index.d.ts            # Global ambient types (extends Window, etc.)
│   │
│   ├── styles/                   # Styles
│   │   ├── globals.css
│   │   ├── variables.css
│   │   └── tailwind.css
│   │
│   └── tests/                    # Unit & integration tests
│       ├── components/
│       └── features/
│
│── .eslintrc.json                # ESLint config
│── .gitignore                    # Git ignore rules
│── next.config.js                 # Next.js config
│── package.json                   # Dependencies & scripts
│── postcss.config.js              # PostCSS config (Tailwind, etc.)
│── tailwind.config.js             # Tailwind config
│── tsconfig.json                  # TypeScript config
```

### Routing

- Static route → `app/about/page.tsx` → `/about`
- Dynamic route → `app/blog/[id]/page.tsx` → `/blog/123`
- Catch-all route → `app/docs/[...slug]/page.tsx` → `/docs/intro/getting-started`
- Route groups → `app/(marketing)/about/page.tsx` → URL is /about but logically grouped.
- Nested routes → Folders create nested segments

### Data Fetching

In App Router, data fetching is built into Server Components (no need for `getStaticProps` / `getServerSideProps`).

- Supports streaming and Suspense for better performance.
- Automatic caching and revalidation with `fetch()`.

1. **Async Server Components (default)**

   - Just make your component `async` and fetch data with `await`.
   - Runs on the server at request/build time.

   ```tsx
   // app/posts/page.tsx
   export default async function PostsPage() {
     const res = await fetch("https://jsonplaceholder.typicode.com/posts");
     const posts = await res.json();

     return (
       <div>
         <h1>Posts</h1>
         <ul>
           {posts.slice(0, 5).map((post: any) => (
             <li key={post.id}>{post.title}</li>
           ))}
         </ul>
       </div>
     );
   }
   ```

2. **`fetch` caching strategies**

   - `fetch(..., { cache: "force-cache" })` → Default (SSG-like, cached at build).
   - `fetch(..., { cache: "no-store" })` → Always fresh (SSR-like).
   - `fetch(..., { next: { revalidate: 60 } })` → ISR (regenerates every 60s).

3. **Client Components**

   - Mark with `"use client"`.
   - Use `useEffect`, `useState`, or client-only libraries.

   ```tsx
   "use client";
   import { useEffect, useState } from "react";

   export default function ClientData() {
     const [time, setTime] = useState("");

     useEffect(() => {
       setTime(new Date().toLocaleTimeString());
     }, []);

     return <p>Client time: {time}</p>;
   }
   ```

4. **API Routes with `route.ts`**

   - Replace `pages/api`.
   - Works like Express-style handlers.

   ```tsx
   // app/api/hello/route.ts
   export async function GET() {
     return Response.json({ message: "Hello from API" });
   }
   ```

### Components

#### Server Components (default)

- Run only on the server (never shipped to client).
- Can fetch data directly (use `fetch`, DB queries).
- Great for performance — smaller JS bundle.

#### Client Components

- Marked with `"use client"`.
- Can use state, hooks, event handlers.
- Cannot fetch data with `await` at the top level (must use client-side fetching like `useEffect`).

#### Rendering

| Mode                        | Trigger                                   | Example                 | Equivalent (Pages Router)           |
| --------------------------- | ----------------------------------------- | ----------------------- | ----------------------------------- |
| **Static Rendering (SSG)**  | `fetch(..., { cache: "force-cache" })`    | Pre-rendered at build   | `getStaticProps`                    |
| **Dynamic Rendering (SSR)** | `fetch(..., { cache: "no-store" })`       | Fresh on every request  | `getServerSideProps`                |
| **ISR (Revalidation)**      | `fetch(..., { next: { revalidate: N } })` | Updates every N seconds | ISR (`getStaticProps + revalidate`) |
| **CSR**                     | `"use client"` + `useEffect` fetch        | Rendered on client only | CSR with hooks                      |

## Catch-All Routes

In Next.js, dynamic routes allow you to create pages that depend on parameters (like `/blog/[id]`).

A catch-all route goes one step further: it matches any number of path segments.

```bash
app/blog/[...slug].ts
```

Here, `[...slug]` is a catch-all segment.
It means:

- `/blog/a` → `slug = ['a']`
- `/blog/a/b` → `slug = ['a', 'b']`
- `/blog/a/b/c` → `slug = ['a', 'b', 'c']`
  So, it "catches all" nested paths under `/blog/`.

```ts
import { useRouter } from "next/router";

export default function BlogPage() {
  const router = useRouter();
  const { slug } = router.query; // slug will be an array

  return (
    <div>
      <h1>Catch-All Blog Route</h1>
      <p>Slug: {JSON.stringify(slug)}</p>
    </div>
  );
}
```

### Optional Catch-All Routes

Sometimes, you want the route to also work without any slug.

For that, you use double brackets:

```ts
app / blog / [[...slug]].ts;
```

Difference:

- `/blog` → `slug = undefined`
- `/blog/hello` → `slug = ["hello"]`
- `/blog/hello/world` → `slug = ["hello", "world"]`

### Practical Use Cases

1. Blog Posts with Categories/Tags
   - `/blog/technology/javascript/nextjs`
   - You can use slug to determine category hierarchy.
2. Docs/Knowledge Base
   - `/docs/getting-started/setup/windows`
   - `slug = ["getting-started", "setup", "windows"]`
3. Dynamic Navigation (like breadcrumbs)
   - You can use the array to generate breadcrumb navigation.
