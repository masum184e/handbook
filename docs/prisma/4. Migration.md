---
sidebar_position: 4
---

## Prisma Migrate

Prisma Migrate is the migration system Prisma provides to safely evolve your database schema in sync with your Prisma Schema (`schema.prisma`). It helps you track schema changes, generate SQL migrations, apply them to your database, and keep everything consistent across environments (dev, staging, production).

### Prisma Migrate Workflow

The Prisma Migrate workflow generally involves four main steps:

1. **Define schema changes**

   - You edit your `schema.prisma` file (e.g., adding a model, changing a field, creating relations, etc.).

2. **Create a new migration**

   ```bash
   npx prisma migrate dev --name <migration-name>
   ```

   - Prisma detects differences between your current schema and the database.
   - Generates a new SQL migration file inside `prisma/migrations/`.
   - Applies the migration immediately to your development database.
   - Updates the Prisma Client (so you can use new types in your code).

3. **Apply migrations to other environments**

   - In production or staging, you don’t use `migrate dev`. Instead, you use:

   ```bash
   npx prisma migrate deploy
   ```

   - Reads all unapplied migrations from `prisma/migrations/`.
   - Applies them in the correct order to the target database.

4. **Track and version migrations**

   - Each migration is a folder with timestamp + name:

   ```bash
   prisma/
     migrations/
       20250925101010_init/
         migration.sql
       20250925103520_add-user-table/
         migration.sql
   ```

   - The database contains a `_prisma_migrations` table that records which migrations have been applied.

## Resetting the database

Resetting means:

1. Drop all tables in the database.
2. Recreate the schema from migrations in `prisma/migrations/`.
3. Re-generate Prisma Client to match the schema.

This is especially useful when:

- You want a clean database while developing.
- You changed schema drastically and just want a fresh start locally.
- You’re preparing for testing with a clean dataset.

The main command is:

```bash
npx prisma migrate reset
```

### How Resetting Works

When you run migrate reset, Prisma does the following:

1. **Confirmation**
   - It asks you to confirm, because it will delete ALL DATA.
   - You can skip confirmation with:
   ```bash
   npx prisma migrate reset --force
   ```
2. **Drops all tables**
   - Completely clears the database schema.
3. **Re-applies all migrations**
   - Prisma runs every migration in your `prisma/migrations/` directory in sequence.
   - This ensures the schema is the same as if you had created the DB from scratch.
4. **Seeds the database (optional)**
   - If you have a `prisma/seed.ts` or `prisma/seed.js` file, Prisma will run it automatically.
   ```bash
   npx prisma migrate reset --skip-seed
   ```
   skips the seeding step.
5. **Regenerates Prisma Client**
   - So your code reflects the new schema.
